 \documentclass[11pt,letterpaper]{amsart}

 %\documentclass[11pt]{amsart}

%\documentclass{amsart}


\usepackage[utf8]{inputenc}  % (or none if Lua/XeLaTeX)
\usepackage{lmodern}
\usepackage[letterpaper]{geometry}
\geometry{
  textwidth=5in,
  textheight=8in,
  centering
}

\usepackage{amsmath,amssymb,mathtools}
\usepackage{mathrsfs} % Ralph Smith’s Formal Script
\usepackage{amsthm}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{algorithm}
\usepackage{algpseudocode} % from algorithmicx
\usepackage[colorlinks=true,linkcolor=blue,citecolor=blue,urlcolor=blue]{hyperref}
\usepackage{listings}          % provides \lstset, \lstlisting, \lstinline
\usepackage[scaled=0.9]{inconsolata} % optional: nicer monospace font
\usepackage{xcolor}           % optional: needed if you add colored syntax
\usepackage{xurl}
\usepackage{needspace}
\usepackage{cleveref}
\usepackage{float}
\usepackage{adjustbox}
%\usepackage{rotating} % for sidewaystable
\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning, automata}
\usepackage[T1]{fontenc}


% in preamble
\usepackage{tabularx} % for automatic column wrapping
\usepackage{xltabular}
\newcolumntype{Y}{>{\raggedright\arraybackslash}X} % ragged-right X



\usepackage{etoolbox}
\AtBeginEnvironment{proof}{\par\noindent\ignorespaces}


\hypersetup{unicode=true}

\pdfstringdefDisableCommands{%
  % math font flattening
  \def\mathrm#1{#1}%
  \def\mathsf#1{#1}%
  \def\mathbf#1{#1}%
  \def\mathcal#1{#1}%
  \def\mathbb#1{#1}%
  \def\mathtt#1{#1}%
  % common math
  \def\dfrac#1#2{#1/#2}%
  % primes & punctuation
  \def\prime{'}%
  \def\colon{:}%
  % drop math delimiters in bookmarks (no arguments!)
  \def\({}%
  \def\){}%
  \def\[{ }%
  \def\]{ }%
}

% helper for math in moving args
\newcommand{\pdfmath}[1]{\texorpdfstring{$#1$}{#1}}


% ---------- theorem styles ----------
\theoremstyle{definition}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}

\theoremstyle{plain}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
\theoremstyle{plain}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{assumption}{Assumption}
%\newtheorem{assumption}[theorem]{Assumption}

\theoremstyle{remark}
\newtheorem*{remark}{Remark}

% ---------- tiny helpers for move symbols ----------
\newcommand{\mvpsi}{\psi}
\newcommand{\mvPsi}{\Psi}
\newcommand{\mvomega}{\omega}
\newcommand{\mvOmega}{\Omega}

% ---------- step-line helper (no nested math in args) ----------
% Args: 1=Step label, 2=x, 3=s (\mathrm{e}/\mathrm{o}), 4=m, 5=j,
%       6=move symb (\psi/\Psi/\omega/\Omega), 7=row tag (e.g. \mathrm{e},0),
%       8=rhs text (e.g. x'=96m+5=5)
\newcommand{\StepLine}[8]{%
  \textit{#1: } $x=#2$; $s={#3}$, $m={#4}$, $j={#5}$\,
  $\overset{#6\ \text{ at }\ (#7)}{\longrightarrow}$\,
  $#8$.\\
}

% =========================
% A lightweight Playbook environment (no extra packages needed)
% =========================
\newenvironment{playbook}[1][]%
{%
  \par\medskip
  \noindent\textbf{Playbook.} \textit{#1}\par
  \vspace{2pt}
  \begingroup
  \leftskip=1em\rightskip=0em
}%
{%
  \par\endgroup\medskip
}


\setlength{\textfloatsep}{10pt plus 4pt minus 2pt}
\setlength{\intextsep}{8pt plus 3pt minus 2pt}
\setcounter{topnumber}{3}
\setcounter{totalnumber}{4}
\renewcommand{\textfraction}{0.1}
\renewcommand{\topfraction}{0.9}
\renewcommand{\floatpagefraction}{0.8}



% In the preamble
\newif\ifobjections
\objectionstrue

\newif\ifidentity
\identitytrue



\raggedbottom

% --- Make math safe in captions/headings ---
% Helper: \capmath{...} typesets as inline math in PDF/print; plain text in bookmarks/LoF
\newcommand{\capmath}[1]{\texorpdfstring{\(#1\)}{#1}}

% Optional: a tiny helper to move long equations out of captions cleanly
\newenvironment{belowcaption}{\par\vspace{-0.5em}\noindent\begin{minipage}{0.96\linewidth}\small}{\end{minipage}\par\vspace{0.25em}}


% ==== Compact layout block (non-destructive; safe with existing packages) ====
\usepackage{microtype}
%\usepackage{enumitem}
\usepackage[font=small,labelfont=bf]{caption}
%\usepackage{etoolbox}

% Compact lists (affects itemize/enumerate/description)
\setlist{itemsep=0.25em, topsep=0.35em, parsep=0.2em, partopsep=0.1em}

% Compact math/display spacing (keep readable)
\setlength{\abovedisplayskip}{7pt}
\setlength{\belowdisplayskip}{7pt}
\setlength{\abovedisplayshortskip}{5pt}
\setlength{\belowdisplayshortskip}{5pt}

% Float spacing
\setlength{\floatsep}{8pt}
\setlength{\textfloatsep}{10pt}
\setlength{\intextsep}{8pt}

% Paragraph spacing/indent
\setlength{\parskip}{0.35em}
\setlength{\parindent}{1.2em}

% Compact tables by default
\setlength{\tabcolsep}{5pt}
\AtBeginEnvironment{tabular}{\small}
\AtBeginEnvironment{tabularx}{\small}

% Slightly tighter line spread for body text
\linespread{0.98}

% (Optional) reduce space before/after theorems if amsthm is used
\makeatletter
\g@addto@macro\thm@space@setup{%
  \thm@preskip=6pt \thm@postskip=6pt
}
\makeatother
% ==== End compact layout block ====

%\title{An Inverse Calculus for the Odd Layer of the Collatz Map}
%\author[Odero]{Agola Kisira Odero}

\title[Inverse Calculus for Collatz]{An Inverse Calculus for the Odd Layer of the Collatz Map}
\author{Agola Kisira Odero}
\thanks{Funding: The author received no external funding for this work.}
\date{\today}

\begin{document}

\begin{abstract}
We present a constructive framework for the inverse dynamics of the Collatz $3x+1$ map on the odd integers. By formalizing the system as a deterministic \textbf{Finite State Automaton (FSA)} acting on a modular network, we transform the reachability problem into a study of symbolic dynamics on a subshift of finite type.

Our approach proceeds in three stages. First, we derive a \textbf{Unified Inverse Calculus}, where a single parameter table and a column-lift mechanism generate certified preimages for all topological configurations. Second, we introduce \textbf{Algebraic Steering}, proving that short ``padding'' sequences can manipulate the affine slope and intercept of a trajectory to satisfy arbitrary divisibility constraints. This culminates in a constructive proof of \textbf{Exact Reachability}: for every odd integer $x$, we provide an explicit algorithm to construct a finite, certified symbolic program (a valid path in the automaton) that connects the root $1$ to $x$.

Finally, we analyze the \textbf{Global Topology and Probabilistic Dynamics} of the resulting network. We establish that the state transition graph is strongly connected with positive topological entropy, and we compute the stationary distribution of the inverse Markov chain. This analysis reveals a mean inverse expansion factor of $\Lambda \approx 3.51$ (Lyapunov exponent $\lambda \approx 1.77$), confirming that while the system is globally expansive, the geometric contraction required for the forward map is confined to specific topological ``chutes.''
\end{abstract}

\maketitle
\setcounter{tocdepth}{1} % sections only; raise to 2 to include subsections
\tableofcontents

% =============================================================================
% PART I: THE MACHINE (DEFINITIONS & MECHANICS)
% Goal: Define the arithmetic, the table, and the single-step validity.
% =============================================================================
\part{The Inverse Machine: Definitions and Mechanics}


\section{Introduction and Related Work}
\label{sec:introduction}

The Collatz conjecture asserts that the dynamics of the $3x+1$ map on positive integers eventually reaches the cycle $1 \to 4 \to 2 \to 1$. In this paper, we focus on the \emph{odd layer} of the dynamics, governed by the accelerated map:
\[
U(y) = \frac{3y+1}{2^{\nu_2(3y+1)}},
\]
where $\nu_2(n)$ is the 2-adic valuation of $n$. Our approach develops a finite--state, word--based framework for the inverse of this map. By establishing a unified table of inverse operations (``rows'') and a calculus of their composition (``words''), we transform the problem of reachability into a deterministic procedure of solving linear congruences.

Our framework rests on three novel components: a \emph{unified inverse table} that generates certified preimages $U(x')=x$; a \emph{column-lift parameter} $p$ that scales the 2-adic slope while preserving modular routing; and \emph{explicit steering gadgets} that manipulate the affine parameters of a word to ensure 2-adic congruences are always solvable.

\subsection{Relation to Prior Techniques}

Our approach—finite word semantics on the odd layer, certified one–step inverses, and congruence–based “steering” to lift residues from $M_K=3\cdot 2^K$ to $M_{K+1}$—sits alongside several established techniques in the literature.

\paragraph{Mod-$2^k$ analysis and lifting.}
Garner studied the $3n{+}1$ dynamics modulo powers of two, organizing inverse branches by congruence classes and effectively “lifting” structure from $2^k$ to $2^{k+1}$ \cite{Garner1981}. Our use of the unified rows with a column–lift parameter $p$ (which multiplies the $2$–adic slope by $2^{6p}$) and the residue steering gadgets plays a similar role: we solve linear congruences for $m$ to pass from $M_K$ to $M_{K+1}$ while preserving certified inverses at each step.

\paragraph{Inverse trees and predecessor sets.}
Wirsching’s monograph develops the inverse (predecessor) tree of the $3n{+}1$ function as a dynamical system, with emphasis on structure, measures, and asymptotics on inverse branches \cite{Wirsching1998LNM}. Conceptually, our move alphabet and per–row affine forms are a finite–state presentation of those inverse branches: each token certifies $U(x')=x$ and the composition yields an affine map in the “index” $m$, which we then route by residues $M_K$.

\paragraph{The $2$-adic viewpoint and conjugacies.}
Bernstein and Lagarias constructed a $2$-adic conjugacy map relating the odd–accelerated Collatz dynamics to a Bernoulli-like shift \cite{BernsteinLagarias1996}. Our $p$–lift (multiplying by $2^{6p}$) and the parity/valuation steering reflect this same $2$–adic continuity: column–lifts shift $2$–adic scale, while steering gadgets tune intercept parity to land on prescribed residue classes.

\paragraph{Symmetries and autoconjugacy.}
Monks and Yazinski analyzed autoconjugacies of the $3x{+}1$ function and their implications for orbit structure \cite{MonksYazinski2004}. While our framework is more combinatorial/affine, the way we keep the family pattern fixed and exploit same–family padding resonates with their use of structural symmetries.

\paragraph{Surveys and context.}
For broad background and additional modular/density insights, see \cite{Lagarias2010survey,Terras1976,Terras1979}; for $2$–adic heuristics and continuity themes, see \cite{Gouvea1997,Nathanson1996}. These perspectives motivate our use of $2$–adic “padding” and linear congruences as lifting mechanisms.

\subsection{Contributions}

The main contribution of this work is a unified, certified inverse--word calculus on the odd layer together with explicit steering gadgets that turn residue targeting into solvable congruences. Specifically:

\begin{itemize}
\item \textbf{One-table, word-driven inverse calculus.}
  We give a unified \(p{=}0\) row table with closed forms \(x'=6F(0,m)+\delta\) indexed only by \((s,j,m)\).
  Once a token and \((s,j)\) are fixed, the step is fully determined and the forward identity
  \(3x'+1=2^{\alpha}x\) holds by construction.

\item \textbf{Column-lift \(p\).}
  The parameter \(p\) multiplies the slope by \(2^{6p}\) without changing the token type or output family, yielding a single mechanism that subsumes whole towers of congruence tables.

\item \textbf{CRT tag for transparent indexing.}
  The tag \(t=(x-1)/2\) (equivalently \((3x+1-4)/6\)) makes family detection and indices
  \((s,j,m)\) linear in \(t\), simplifying routing proofs.

\item \textbf{Steering gadgets.}
  Short same-family words provably boost the slope’s \(2\)-adic valuation and toggle the affine intercept \(B\bmod 2\) (and \(B \bmod 3\)), ensuring solvability of the lifting congruence at each modulus.

\item \textbf{From small witnesses to exact integers.}
  Starting at \(M_3{=}24\), we give a deterministic induction \(M_K\to M_{K+1}\)
  that reaches every odd residue with certified steps, and then a \(2\)-adic refinement to hit any prescribed odd integer exactly.

\item \textbf{Executable certificates.}
  A reference implementation emits step traces and verifies \(U(x')=x\) at each step, making all claims reproducible.

\item \textbf{Topological and Probabilistic Analysis.}
  We formalize the network as a Finite State Automaton and compute the stationary distribution of the resulting Markov chain. This yields a precise Lyapunov exponent for the inverse map ($\Lambda \approx 3.51$), explaining the difficulty of the problem as a competition between global expansion and topologically constrained contraction channels.

\end{itemize}

\subsection{Main Claim and Method}

Our main claim (Theorem~\ref{thm:exact-reachability}) is that every odd \(x\equiv 1,5\pmod 6\) reaches \(1\) in finitely many accelerated odd Collatz steps. The method is modular:
(i) certify row-level inverses \(U(x')=x\);
(ii) show any admissible word yields an affine form in \(m\) with controlled terminal family;
(iii) furnish base witnesses modulo \(24\);
(iv) use same-family \emph{steering gadgets} to raise \(v_2(A)\) and control \(B\bmod 2\) and \(B\bmod 3\);
(v) lift residues \(M_K\to M_{K+1}\); and
(vi) pass from residues to exact integers by \(2\)-adic refinement.

\section{Preliminaries: Notation and Indices}
\label{sec:preliminaries}

We enumerate the ambient assumptions and notation used throughout. All variables are integers unless noted. We work exclusively on the \emph{odd layer}: inputs $x$ are always positive odd integers.

\subsection{The Accelerated Odd Map}
We use the accelerated odd Collatz map $U(y)$, standard in the literature \cite{Lagarias2010survey}:
\[
U(y) \;=\; \frac{3y+1}{2^{\nu_2(3y+1)}},
\]
where $\nu_2(n)$ denotes the 2-adic valuation of $n$. Since $3y+1$ is always even for odd $y$, $U(y)$ returns an odd integer.
Furthermore, for any odd $y$, $3y+1 \equiv 4 \pmod 6$. Dividing by powers of 2 (which are $\equiv 2, 4 \pmod 6$) yields an output $U(y)$ congruent to either $1$ or $5$ modulo $6$. Thus, the residue class $3 \pmod 6$ never appears in the image of $U$.

\subsection{Families and Indices}
We classify odd integers $x \not\equiv 3 \pmod 6$ into two families:
\begin{equation}
s(x) \;=\;
\begin{cases}
\mathrm{e}, & \text{if } x \equiv 1 \pmod 6, \\
\mathrm{o}, & \text{if } x \equiv 5 \pmod 6.
\end{cases}
\end{equation}
To enable a finite-state calculus, we decompose $x$ into three hierarchical indices:
\begin{enumerate}
    \item The \textbf{Coarse Index} $r$:
    \[ r = \Big\lfloor\frac{x}{6}\Big\rfloor. \]
    \item The \textbf{Router} $j$ (determines the next table row):
    \[ j = r \bmod 3 \in \{0, 1, 2\}. \]
    \item The \textbf{Internal Index} $m$ (the operand for the affine form):
    \[ m = \Big\lfloor\frac{x}{18}\Big\rfloor. \]
\end{enumerate}
From these, $x$ can be uniquely reconstructed as:
\[
x \;=\; 18m + 6j + p_6, \qquad \text{where } p_6 \in \{1, 5\} \text{ is determined by } s(x).
\]

\subsection{The CRT Tag and Re-indexing}
\label{sec:crt-tag}
To simplify the arithmetic of families and indices, we introduce the \textbf{CRT Tag} $t(x)$.

\begin{lemma}[CRT tag]
\label{lem:crt-tag}
For odd $x$, the quantity
\[
t \;=\; \frac{x-1}{2}
\]
is an integer. The map $x \mapsto t$ is a bijection between odd integers $x \ge 1$ and non-negative integers $t \ge 0$.
\end{lemma}

The tag $t$ linearizes the family and index calculations, avoiding nested floors in many proofs.

\begin{corollary}[Indices from tag]
\label{cor:tag-indices}
The indices $s(x)$, $j$, and $m$ are determined by $t$ modulo $3$ and $9$:
\begin{align*}
x \bmod 6 \;&=\; 2(t \bmod 3) + 1, \\
m \;&=\; \Big\lfloor\frac{t}{9}\Big\rfloor, \\
j \;&=\; \Big\lfloor\frac{t}{3}\Big\rfloor \bmod 3.
\end{align*}
Specifically, if $t \equiv 0 \pmod 3$, then $x \in \mathrm{e}$; if $t \equiv 2 \pmod 3$, then $x \in \mathrm{o}$. The case $t \equiv 1 \pmod 3$ corresponds to $x \equiv 3 \pmod 6$, which is excluded from the odd layer.
\end{corollary}

\subsection{Move Alphabet}
We define a set of tokens $\mathcal{A} = \{\Psi, \psi, \omega, \Omega\}$ representing the valid transitions between families:
\begin{itemize}
    \item $\Psi$ (type \texttt{ee}): Maps family $\mathrm{e} \to \mathrm{e}$.
    \item $\psi$ (type \texttt{eo}): Maps family $\mathrm{e} \to \mathrm{o}$.
    \item $\omega$ (type \texttt{oe}): Maps family $\mathrm{o} \to \mathrm{e}$.
    \item $\Omega$ (type \texttt{oo}): Maps family $\mathrm{o} \to \mathrm{o}$.
\end{itemize}
A sequence of these tokens is called a \emph{word} $W$.

\subsection{Summary of Notation (Quick Reference)}
To aid the reader, we summarize the hierarchy of indices used to classify odd integers in the inverse map.

\begin{table}[H]
\centering
\caption{Nomenclature and Variable Hierarchy.}
\label{tab:nomenclature}
\renewcommand{\arraystretch}{1.3}
\begin{tabularx}{\linewidth}{@{}l l X@{}}
\toprule
\textbf{Symbol} & \textbf{Definition} & \textbf{Role / Intuition} \\
\midrule
$x$ & $x \in 2\mathbb{Z}+1$ & The \textbf{Odd Integer} (the value itself). \\
$t$ & $(x-1)/2$ & The \textbf{CRT Tag}. A continuous index $0,1,2\dots$ that linearizes the geometry. \\
$\rho$ & $t \bmod 9$ & The \textbf{Topological Node}. Determines the parameter family and network role (e.g., Attractor, Heart). \\
$m$ & $\lfloor t/9 \rfloor$ & The \textbf{Internal Index}. The operand for the affine map $x' = A m + B$. \\
$j$ & $\lfloor t/3 \rfloor \bmod 3$ & The \textbf{Router}. Determines the "next-hop" admissibility modulo 3. \\
$s(x)$ & $x \bmod 6$ & The \textbf{Parity Family}. $\mathrm{e}$ (if $x \equiv 1$) or $\mathrm{o}$ (if $x \equiv 5$). \\
$p$ & $p \ge 0$ & The \textbf{Column Lift}. Scales the step size (multiplies slope by $64^p$). \\
$\alpha$ & Table constant & The \textbf{Base Valuation}. The minimal power of 2 removed in a forward step. \\
\bottomrule
\end{tabularx}
\end{table}

We use the symbol $\sigma$ for a $2$-adic valuation exponent; its precise meaning (e.g. $\sigma=v_2(A_W)$, $\sigma=v_2(3x'+1)$ or $\sigma = \alpha + 6p$) will be specified locally when used.


\section{The Unified Inverse Table}
\label{sec:unified-table}

To unify all Collatz inverse orbits, we parametrize every possible step using a fixed set of row parameters \((\alpha,\beta,c,\delta)\) and a dynamic column--lift \(p\in\mathbb{Z}_{\ge 0}\). This allows us to treat the inverse map as a table lookup determined solely by the indices \(s(x)\) and \(j\).

\subsection{The Parameter Table}
Table~\ref{tab:parameters-abc} lists the twelve canonical rows derived from the constraints above. The \texttt{type} indicates the transition from input family to output family (e.g., \texttt{eo} means input \(\mathrm{e}\), output \(\mathrm{o}\)).

\begin{table}[!htbp]
\centering
\caption{Row parameters \((\alpha,\beta,c,\delta)\). Keys: \(\mathrm{ee}j\leftrightarrow \Psi_j\), \(\mathrm{eo}j\leftrightarrow \psi_j\), \(\mathrm{oe}j\leftrightarrow \omega_j\), \(\mathrm{oo}j\leftrightarrow \Omega_j\).}
\label{tab:parameters-abc}
\begin{tabular}{@{}c c c c c c@{}}
\toprule
Row & $(s,j)$ & Type & $\alpha$ & $\beta$ & $c$ \ ( $\delta$)\\\midrule
$\Psi_0$ & $(\mathrm e,0)$ & \texttt{ee} & $2$ & $2$   & $-2$ \ (1)\\
$\Psi_1$ & $(\mathrm e,1)$ & \texttt{ee} & $4$ & $56$  & $-2$ \ (1)\\
$\Psi_2$ & $(\mathrm e,2)$ & \texttt{ee} & $6$ & $416$ & $-2$ \ (1)\\
$\omega_0$ & $(\mathrm o,0)$ & \texttt{oe} & $3$ & $20$  & $-2$ \ (1)\\
$\omega_1$ & $(\mathrm o,1)$ & \texttt{oe} & $1$ & $11$  & $-2$ \ (1)\\
$\omega_2$ & $(\mathrm o,2)$ & \texttt{oe} & $5$ & $272$ & $-2$ \ (1)\\
\midrule
$\psi_0$ & $(\mathrm e,0)$ & \texttt{eo} & $4$ & $8$   & $-8$ \ (5)\\
$\psi_1$ & $(\mathrm e,1)$ & \texttt{eo} & $6$ & $224$ & $-8$ \ (5)\\
$\psi_2$ & $(\mathrm e,2)$ & \texttt{eo} & $2$ & $26$  & $-8$ \ (5)\\
$\Omega_0$ & $(\mathrm o,0)$ & \texttt{oo} & $5$ & $80$  & $-8$ \ (5)\\
$\Omega_1$ & $(\mathrm o,1)$ & \texttt{oo} & $3$ & $44$  & $-8$ \ (5)\\
$\Omega_2$ & $(\mathrm o,2)$ & \texttt{oo} & $1$ & $17$  & $-8$ \ (5)\\
\bottomrule
\end{tabular}
\end{table}

\subsection{The Unified \texorpdfstring{$p$}{p}-Lifted Form}
To reach arbitrarily high powers of 2, we extend the base table with a column--lift parameter \(p \ge 0\). This parameter scales the 2-adic slope by \(2^{6p}\) while preserving the routing logic.

For any row in Table~\ref{tab:parameters-abc}, define the lifted transform:
\begin{equation}
\label{eq:unified-F-def}
F(p,m) \;:=\; \frac{(9m\,2^{\alpha}+\beta)\,64^{\,p}+c}{9},
\qquad
x' \;:=\; 6\,F(p,m)+\delta.
\end{equation}
\begin{remark}[Integrality]
Since \(64 \equiv 1 \pmod 9\), we have \(\beta\,64^p + c \equiv \beta+c \pmod 9\). Since \(\beta+c\) is divisible by 9 for all valid rows, \(F(p,m)\) is always an integer.
\end{remark}

\subsection{The Base \texorpdfstring{$p=0$}{p=0} Table (Straight Substitution)}
At \(p=0\), the formula simplifies to the affine forms shown in Table~\ref{tab:unified-F0-straight-xprime}. These are the fundamental building blocks of the inverse calculus.

\begin{table}[!htbp]
\centering
\caption{Unified $p=0$ forms with $x'(m)=6F(0,m)+\delta$.}
\label{tab:unified-F0-straight-xprime}
\begin{tabular}{@{}ccc l@{}}
\toprule
$(s,j)$ & Type & Token & $x'(m)$ \\ \midrule
$(\mathrm{e},0)$ & \texttt{ee} & $\Psi_{0}$   & $24m + 1$ \\
$(\mathrm{e},1)$ & \texttt{ee} & $\Psi_{1}$   & $96m + 37$ \\
$(\mathrm{e},2)$ & \texttt{ee} & $\Psi_{2}$   & $384m + 277$ \\
$(\mathrm{o},0)$ & \texttt{oe} & $\omega_{0}$ & $48m + 13$ \\
$(\mathrm{o},1)$ & \texttt{oe} & $\omega_{1}$ & $12m + 7$ \\
$(\mathrm{o},2)$ & \texttt{oe} & $\omega_{2}$ & $192m + 181$ \\
\midrule
$(\mathrm{e},0)$ & \texttt{eo} & $\psi_{0}$   & $96m + 5$ \\
$(\mathrm{e},1)$ & \texttt{eo} & $\psi_{1}$   & $384m + 149$ \\
$(\mathrm{e},2)$ & \texttt{eo} & $\psi_{2}$   & $24m + 17$ \\
$(\mathrm{o},0)$ & \texttt{oo} & $\Omega_{0}$ & $192m + 53$ \\
$(\mathrm{o},1)$ & \texttt{oo} & $\Omega_{1}$ & $48m + 29$ \\
$(\mathrm{o},2)$ & \texttt{oo} & $\Omega_{2}$ & $12m + 11$ \\
\bottomrule
\end{tabular}
\end{table}

\section{Row Correctness and Drift}
\label{sec:row-correctness}

Having defined the unified parameter table and the lifted transform, we now verify two fundamental properties:
\begin{enumerate}
    \item \textbf{Correctness:} Every step \(x \mapsto x'\) produced by the table is a valid inverse of the accelerated Collatz map \(U\).
    \item \textbf{Linearity:} The change in the CRT tag (the ``drift'') is a linear function of the coarse index \(r\).
\end{enumerate}

\subsection{The Forward Identity}
\label{subsec:forward-identity}

We first prove that the row design constraints derived in Section~\ref{sec:unified-table} guarantee the forward identity \(3x'+1 = 2^{\sigma} x\) for all \(p \ge 0\) where \(\sigma:=\alpha+6p\).

\begin{lemma}[Row Correctness]
\label{lem:row-correctness}
Fix any admissible row with parameters \((\alpha,\beta,c,\delta)\) and a column--lift \(p \ge 0\). Let \(x = 18m + 6j + \delta_{6}\) be an admissible input. Let \(x' = 6F(p,m) + \delta\) be the value generated by the unified table. Then:
\begin{equation}
3x' + 1 \;=\; 2^{\alpha+6p}\,x.
\end{equation}
Consequently, \(\nu_2(3x'+1) = \alpha+6p\) and \(U(x') = x\).
\end{lemma}

\begin{proof}
Substitute the definition of \(x'\) and \(F(p,m)\):
\[
3x' + 1 \;=\; 3\left( 6 \left[ \frac{(9m\,2^\alpha + \beta)64^p + c}{9} \right] + \delta \right) + 1
\;=\; 2\left( (9m\,2^\alpha + \beta)64^p + c \right) + 3\delta + 1.
\]
Expanding terms:
\[
3x' + 1 \;=\; 18m\,2^\alpha\,64^p + 2\beta\,64^p + (2c + 3\delta + 1).
\]
Recall the row design constraint \(c = -(3\delta+1)/2\), which implies \(2c + 3\delta + 1 = 0\). The constant term vanishes, leaving:
\[
3x' + 1 \;=\; 18m\,2^{\alpha+6p} + 2\beta\,2^{6p}.
\]
Substitute \(\beta = 2^{\alpha-1}(6j+\delta_{6})\):
\begin{align*}
3x' + 1 \;&=\; 18m\,2^{\alpha+6p} + 2(2^{\alpha-1}(6j+\delta_{6}))2^{6p} \\
&=\; 18m\,2^{\alpha+6p} + 2^{\alpha}(6j+\delta_{6})2^{6p} \\
&=\; 2^{\alpha+6p} (18m + 6j + \delta_{6}) \\
&=\; 2^{\alpha+6p}\,x.
\end{align*}
Since \(x\) is odd, the valuation is exactly \(\alpha+6p\).
\end{proof}

\begin{example}[Verification of $\omega_1$ at $p=0$]
Consider the row $\omega_1$ (family $\mathrm{o}$, $j=1$). Parameters are $\alpha=1, \beta=11, c=-2, \delta=1$.
Let $x=29$.
\begin{itemize}
    \item \textbf{Input Analysis:} $x \equiv 5 \pmod 6$ (family $\mathrm{o}$), $r=\lfloor 29/6 \rfloor = 4$, $j = 4 \bmod 3 = 1$. The row is admissible. $m = \lfloor 29/18 \rfloor = 1$.
    \item \textbf{Calculate $x'$:} $F(0,1) = (9(1)2^1 + 11 - 2)/9 = (18+9)/9 = 3$.
    \[ x' = 6(3) + 1 = 19. \]
    \item \textbf{Check Identity:} $3(19)+1 = 58$.
    The formula predicts $2^{\alpha}x = 2^1(29) = 58$. It matches.
    \item \textbf{Forward Map:} $U(19) = (57+1)/2^1 = 29 = x$. Verified.
\end{itemize}
\end{example}
\begin{lemma}[Completeness of the row table for non-ghost inverses]
\label{lem:row-table-nonghost-completeness}
Let $U:\mathbb Z_{>0}^{\mathrm{odd}}\to\mathbb Z_{>0}^{\mathrm{odd}}$ be the accelerated Collatz map
\[
U(x') \;=\; \frac{3x'+1}{2^{\nu_2(3x'+1)}}.
\]
Fix an \emph{active} odd target $x\not\equiv 0\pmod 3$, and write
\[
x \;=\; 18m + 6j + \delta_{6},
\qquad m\in\mathbb Z_{\ge 0},\; j\in\{0,1,2\},\; \delta_{6}\in\{1,5\},
\]
so $\delta_{6}=1$ corresponds to $s=\mathrm e$ (i.e.\ $x\equiv 1\!\!\pmod 6$) and $\delta_{6}=5$ corresponds to $s=\mathrm o$ (i.e.\ $x\equiv 5\!\!\pmod 6$).

For each integer $A\ge 1$ with $2^A x\equiv 1\pmod 3$, define the (formal) inverse
\[
x_A \;:=\; \frac{2^A x - 1}{3}.
\]
Call $x_A$ a \emph{ghost inverse} if $x_A\equiv 0\pmod 3$ (equivalently, $x_A$ is an inactive predecessor), and a \emph{non-ghost inverse} otherwise.

Then the following hold.

\medskip
\noindent\textbf{(i) Unique forbidden class modulo $6$.}
For fixed $(s,j)$, among the admissible residue classes $A\bmod 6$
\[
A\bmod 6 \in
\begin{cases}
\{0,2,4\}, & s=\mathrm e,\\
\{1,3,5\}, & s=\mathrm o,
\end{cases}
\]
there is a \emph{unique} residue class $a_{\mathrm{bad}}(s,j)$ such that
$x_A$ is ghost iff $A\equiv a_{\mathrm{bad}}(s,j)\pmod 6$.

\medskip
\noindent\textbf{(ii) The row table selects exactly the two non-ghost classes.}
Let $\mathcal A(s,j)$ be the pair of $\alpha$-values appearing in
Table~\ref{tab:parameters-abc} for the two rows with key $(s,j)$
(e.g.\ for $(\mathrm e,0)$ the rows are $\Psi_0$ and $\psi_0$, etc.)
Interpreting $\alpha=6$ as $\alpha\equiv 0\pmod 6$, the set $\mathcal A(s,j)$
is precisely the set of admissible classes \emph{excluding} $a_{\mathrm{bad}}(s,j)$.
Equivalently, for each $(s,j)$ the table contains exactly the two classes
$A\bmod 6$ yielding non-ghost inverses.

\medskip
\noindent\textbf{(iii) Surjectivity onto non-ghost inverses.}
For every non-ghost inverse $x_A$ (i.e.\ $x_A\not\equiv 0\pmod 3$),
there exists a unique choice of row in Table~\ref{tab:parameters-abc}
with key $(s,j)$ and $\alpha\in\mathcal A(s,j)$, together with
\[
p \;=\; \frac{A-\alpha}{6}\in\mathbb Z_{\ge 0},
\]
such that the unified lifted form \eqref{eq:unified-F-def} produces exactly $x_A$:
\[
x' \;=\; 6F(p,m)+\delta \;=\; x_A.
\]
Conversely, every value produced by \eqref{eq:unified-F-def} is a non-ghost inverse.
\end{lemma}

\begin{proof}
We use two elementary congruences.

\smallskip
\noindent\emph{Step 1: ghost condition is a single class $A\bmod 6$.}
By definition,
\[
x_A\equiv 0\pmod 3
\quad\Longleftrightarrow\quad
\frac{2^A x-1}{3}\equiv 0\pmod 3
\quad\Longleftrightarrow\quad
2^A x \equiv 1\pmod 9.
\]
Since $2^A\bmod 9$ has period $6$, the congruence $2^A x\equiv 1\pmod 9$,
for fixed $x\bmod 9$, determines a unique residue class $A\bmod 6$.
Moreover, because $x\not\equiv 0\pmod 3$, admissibility $2^A x\equiv 1\pmod 3$
forces $A$ to have the parity dictated by $x\bmod 3$, i.e.\ $A$ even for $s=\mathrm e$
and $A$ odd for $s=\mathrm o$. This proves (i).

\smallskip
\noindent\emph{Step 2: identify the forbidden class and match the table.}
From $x=18m+6j+\delta_{6}$ we have $x\equiv 6j+\delta_{6}\pmod 9$.
A short check gives:

\begin{center}
\begin{tabular}{c|ccc}
 & $j=0$ & $j=1$ & $j=2$\\\hline
$s=\mathrm e$ ($\delta_{6}=1$): $x\bmod 9$ & $1$ & $7$ & $4$\\
$a_{\mathrm{bad}}$ in $\{0,2,4\}$ & $0$ & $2$ & $4$\\\hline
$s=\mathrm o$ ($\delta_{6}=5$): $x\bmod 9$ & $5$ & $2$ & $8$\\
$a_{\mathrm{bad}}$ in $\{1,3,5\}$ & $1$ & $5$ & $3$
\end{tabular}
\end{center}

Indeed, for example when $s=\mathrm e,j=1$ we have $x\equiv 7\pmod 9$, and among
$a\in\{0,2,4\}$ the unique solution to $2^a\cdot 7\equiv 1\pmod 9$ is $a=2$
(since $2^2\equiv 4$ and $4\cdot 7\equiv 1\pmod 9$). The other entries are similar.

Now compare with Table~\ref{tab:parameters-abc}:
for each fixed $(s,j)$ the table lists exactly two $\alpha$ values,
which (reducing $\alpha=6$ to $0$ modulo $6$) are precisely the two admissible
classes \emph{different} from $a_{\mathrm{bad}}(s,j)$. This proves (ii).

\smallskip
\noindent\emph{Step 3: surjectivity onto non-ghost inverses.}
Let $x_A$ be a non-ghost inverse. Then $A\bmod 6$ is admissible and not equal
to $a_{\mathrm{bad}}(s,j)$, hence by (ii) there is a unique $\alpha\in\mathcal A(s,j)$
with $\alpha\equiv A\pmod 6$. Set $p=(A-\alpha)/6\ge 0$.

Choose the corresponding row parameters $(\alpha,\beta,c,\delta)$ from
Table~\ref{tab:parameters-abc} and form $x'=6F(p,m)+\delta$ as in \eqref{eq:unified-F-def}.
By the Row Correctness Lemma (Lemma~\ref{lem:row-correctness}),
\[
3x'+1 \;=\; 2^{\alpha+6p}\,x \;=\; 2^A x,
\]
hence $x'=(2^A x-1)/3=x_A$. Since $x_A$ was assumed non-ghost, we also have
$x'\not\equiv 0\pmod 3$, so the produced inverse is non-ghost.

Conversely, any $x'$ produced by \eqref{eq:unified-F-def} satisfies
$3x'+1=2^{\alpha+6p}x$, so it is an inverse with exponent $A=\alpha+6p$; and by (ii)
the row table never selects the forbidden class $a_{\mathrm{bad}}(s,j)$, hence
$2^A x\not\equiv 1\pmod 9$ and $x'\not\equiv 0\pmod 3$. This completes (iii).
\end{proof}



\subsection{The Drift Equation}
\label{subsec:drift}

While the map \(U^{-1}\) appears complex on the integers, it simplifies significantly when viewed through the lens of the CRT tag \(t(x) = (x-1)/2\).

\begin{definition}[Drift]
For a single inverse step \(x \xrightarrow{U^{-1}} x'\), the \textbf{Drift} \(d\) is the change in the tag potential:
\[
d \;:=\; t(x') - t(x) \;=\; \frac{x' - x}{2}.
\]
\end{definition}

The drift measures the "velocity" of the orbit. Positive drift implies the orbit moves upward (\(x' > x\)); negative drift implies descent (\(x' < x\)).

\begin{proposition}[The Drift Equation]
\label{prop:drift-equation}
Let \(x = 6r + \varepsilon\) with \(\varepsilon \in \{1, 5\}\). For any row in the unified table at column \(p\), the drift is linear in the coarse index \(r\):
\begin{equation}
d(r, p) \;=\; r \cdot K + \Delta_\varepsilon,
\end{equation}
where the slope \(K\) depends on the total exponent \(A = \alpha+6p\):
\[
K = 2^A - 3, \qquad \Delta_\varepsilon = \frac{\varepsilon(2^A - 3) - 1}{6}.
\]
\end{proposition}

\begin{proof}
From Lemma~\ref{lem:row-correctness}, \(x' = \frac{2^{A}x - 1}{3}\).
Substitute \(x = 6r + \varepsilon\):
\[
x' - x \;=\; \frac{2^{A}(6r+\varepsilon)-1}{3} - (6r+\varepsilon)
\;=\; 2r(2^{A}-3) + \frac{\varepsilon(2^{A}-3) - 1}{3}.
\]
Dividing by 2 gives the drift \(d\).
\end{proof}

\begin{example}[Drift Calculation for $\omega_1$]
Using $x=29$ ($r=4, \varepsilon=5$) and $\alpha=1, p=0$ ($A=1$).
\begin{itemize}
    \item \textbf{Tags:} $t(29) = 14$, $t(19) = 9$. Actual Drift $d = 9-14 = -5$.
    \item \textbf{Formula:} $K = 2^1 - 3 = -1$.
    Offset $\Delta_5 = (5(-1) - 1)/6 = -1$.
    Predicted $d = 4(-1) + (-1) = -5$. Matches.
\end{itemize}
\end{example}

\begin{corollary}[Drift Bounds]
\label{cor:drift-bounds}
\begin{itemize}
    \item For family \(\mathrm{e}\) (\(\varepsilon=1\)), the drift is always non-negative (\(d \ge 0\)).
    \item For family \(\mathrm{o}\) (\(\varepsilon=5\)), the drift is negative (\(d < 0\)) if and only if \(p=0\)  and the token is either $\omega_{1}$ or $\Omega_{2}$.
    \item For \(p \ge 1\), \(K\) grows exponentially ($K \approx 2^{6p}$), making the map strongly expansive.
\end{itemize}
\end{corollary}

\begin{example}[High-Lift Expansiveness]
Consider $\Psi_0$ at $p=1$ applied to $x=1$.
\begin{itemize}
    \item \textbf{Parameters:} $\alpha=2, p=1 \implies A = 2 + 6 = 8$.
    \item \textbf{Step:} $x=1 \implies m=0$. $F(1,0) = (0 + 2(64) - 2)/9 = 14$.
    $x' = 6(14) + 1 = 85$.
    \item \textbf{Drift:} $t(1)=0, t(85)=42$. $d = 42$.
    \item \textbf{Formula:} $r=0$. $K = 2^8 - 3 = 253$.
    $\Delta_1 = (1(253)-1)/6 = 42$. Matches.
\end{itemize}
A single step at $p=1$ multiplied the value by roughly $2^8/3 \approx 85$.
\end{example}


\section{Lifted control summaries for $p\ge 0$}
\label{sec:lifted-control-tables}

Row correctness shows that each branch row admits the affine form
\[
x' \equiv 6F(p,u) + \delta \pmod{M_K},\qquad M_K=3\cdot 2^K,
\]
with $F(p,u)$ linear in the free index $u$.  For control arguments it is convenient to reorganize the row parameters
into derived quantities that depend on the lift level $p\ge 0$ and directly govern pinning and solvability.

\paragraph{Lifted affine form.}
For a fixed row with parameters $(\alpha,\beta,c,\delta)$ define
\[
\alpha_p := \alpha + 6p,
\qquad
k^{(p)} := \frac{\beta\,64^p + c}{9}\in\mathbb Z.
\]
Using $64^p=2^{6p}$, the row map can be written as
\begin{equation}
\label{eq:lifted-affine-form}
x' \equiv 6\bigl(2^{\alpha_p}u + k^{(p)}\bigr)+\delta \pmod{M_K}.
\end{equation}
Thus pinning and solving depend only on the comparison of $\alpha_p$ with $K$, and the constant term $k^{(p)}$.

\paragraph{Router transitions are $p$-invariant.}
Reducing \eqref{eq:lifted-affine-form} modulo $3$ shows that the router transition triple $j'(r=0,1,2)$ depends only on the base row,
not on $p$: since $64^p\equiv 1\pmod 3$ and $6p$ is even, both $k^{(p)}\bmod 3$ and $2^{\alpha_p}\bmod 3$ are independent of $p$.

Table~\ref{tab:control-transitions-general-p} records, for each input state $(s,j)$, the two available choices $s'=e$ or $s'=o$
together with the lifted parameters needed in the last-step congruence.
In practice, we use Table~\ref{tab:control-transitions-general-p} to select a branch consistent with the desired output family $s'$
(and, in the solving regime, solvability), and then apply the one-shot inversion procedure to compute a compatible input class.





% =============================================================================
% PART II: THE CONTROL LOGIC (STEERING & ROUTING)
% Goal: Show how to string tokens together to control the slope and intercept.
% =============================================================================
\part{The Control Logic: Steering and Routing}


\section{Affine Word Forms and Index Evolution}
\label{sec:affine-forms}

We now lift the single-step row calculus to sequences of tokens (words). We show that any admissible word \(W\) induces a strictly affine map on the internal index \(m\), and we derive the exact recurrence relation that governs the evolution of \(m_t\) along the trajectory.

\subsection{The Affine Word Form}
Let \(W = T_1 T_2 \dots T_n\) be a sequence of \(n\) tokens, where the \(t\)-th token uses column-lift \(p_t\). Let \((\alpha_t, \beta_t, c_t, \delta_t)\) be the parameters of the row selected at step \(t\).

Recall the single-step update from Section~\ref{sec:unified-table}:
\[
x_t \;=\; 6\bigl(2^{\alpha_t+6p_t} m_{t-1} + k^{(p_t)}_t\bigr) + \delta_t,
\]
where \(k^{(p)}_t = (\beta_t 64^{p_t} + c_t)/9\).

By composing these linear maps, the action of the entire word \(W\) on the initial index \(m_0\) takes a unified affine form.

\begin{lemma}[Affine Word Form]
\label{lem:affine-word}
For any admissible word \(W\) of length \(n\), there exist constants \(A_W > 0\) and \(B_W \in \mathbb{Z}\) such that the terminal value \(x_n\) is given by:
\begin{equation}
x_W(m_0) \;=\; 6\bigl(A_W\,m_0 + B_W\bigr) + \delta_W,
\end{equation}
where:
\begin{itemize}
    \item \(A_W = \prod_{t=1}^n 2^{\alpha_t + 6p_t} = 3 \cdot 2^{\alpha(W)}\) (if normalized to the standard Collatz slope).
    \item \(B_W\) is an integer constant determined by the sequence of accumulated shifts.
    \item \(\delta_W\) is the offset \(\delta\) of the \emph{last} token \(T_n\).
\end{itemize}
\end{lemma}

\begin{proof}
By induction on \(n\). For \(n=1\), the form matches the row definition with \(A_W = 2^{\alpha+6p}\) and \(B_W = k^{(p)}\).
For the inductive step, assume \(x_{n-1} = 6(A_{n-1} m_0 + B_{n-1}) + \delta_{n-1}\).
The next index is \(m_{n-1} = \lfloor x_{n-1}/18 \rfloor\).
Substituting this into the linear form for step \(n\) preserves the affine structure (see Index Evolution below for the exact coefficients).
\end{proof}

\subsection{Index Evolution and the Router}
\label{subsec:index-evolution}

The non-linearity of the Collatz map enters solely through the floor function \(m_t = \lfloor x_t / 18 \rfloor\). We can resolve this floor exactly by tracking the \textbf{router remainders}.

\begin{proposition}[The Index Recurrence]
Let \(a_t = 2^{\alpha_t+6p_t}\) be the slope of step \(t\). The internal index evolves according to:
\begin{equation}
m_t \;=\; \frac{a_t\,m_{t-1} + k^{(p)}_t - j_t}{3},
\end{equation}
where \(j_t = (a_t m_{t-1} + k^{(p)}_t) \bmod 3\) is the \textbf{router index} required for the \emph{next} step to be admissible.
\end{proposition}

\begin{proof}
Recall \(x_t = 6(a_t m_{t-1} + k_t) + \delta_t\). Dividing by 18:
\[
\frac{x_t}{18} \;=\; \frac{6(a_t m_{t-1} + k_t) + \delta_t}{18} \;=\; \frac{a_t m_{t-1} + k_t}{3} + \frac{\delta_t}{18}.
\]
Let \(N = a_t m_{t-1} + k_t\). We can write \(N = 3q + r\), where \(r \in \{0,1,2\}\).
Then:
\[
m_t \;=\; \Big\lfloor \frac{x_t}{18} \Big\rfloor \;=\; \Big\lfloor q + \frac{r}{3} + \frac{\delta_t}{18} \Big\rfloor.
\]
Since \(r \le 2\) and \(\delta_t \le 5\), the fractional part is \(\frac{r}{3} + \frac{\delta_t}{18} \le \frac{2}{3} + \frac{5}{18} = \frac{17}{18} < 1\).
Thus the floor is exactly \(q\).
Solving \(N = 3m_t + r\) for \(m_t\) yields \(m_t = (N - r)/3\).
In our notation, the remainder \(r\) is exactly the router index \(j_t\) for the subsequent step.
\end{proof}

\begin{remark}[Closed form for the index update and the router remainder]
In the proof of Proposition~(The Index Recurrence), we set
\[
N \;:=\; a_t m_{t-1} + k_t,
\qquad\text{so that}\qquad
N = 3q + r,\;\; r\in\{0,1,2\}.
\]
By Euclidean division, the quotient is
\[
q \;=\; \left\lfloor \frac{N}{3}\right\rfloor,
\]
and we identify this quotient with the next index \(m_t\), i.e. \(m_t=q\).
Writing the remainder as the router output
\[
j_t \;:=\; N \bmod 3 \in \{0,1,2\},
\]
we obtain the floor-free index recurrence
\[
m_t \;=\; \frac{N-j_t}{3}
\;=\; \frac{a_t m_{t-1} + k_t - j_t}{3}.
\]

In our parameterization,
\[
a_t = 2^{\alpha_t+6p_t},
\qquad
k_t = \frac{\beta_t\,2^{6p_t}+c_t}{9}
     = \frac{\beta_t\,64^{p_t}+c_t}{9},
\]
so equivalently
\[
m_t
=\frac{9\bigl(2^{\alpha_t+6p_t}m_{t-1}-j_t\bigr) + \bigl(\beta_t\,64^{p_t}+c_t\bigr)}{27}
=\frac{2^{\alpha_t+6p_t}m_{t-1}-j_t}{3}
+\underbrace{\frac{\beta_t\,64^{p_t}+c_t}{27}}_{=:G_t(p_t)}.
\]
Here \(G_t(p):=(\beta_t\,64^{p}+c_t)/27\) collects the \(p\)-dependence of the affine offset,
while the router remainder \(j_t\) is chosen so that \(a_t m_{t-1}+k_t-j_t\) is divisible by \(3\).
\end{remark}

\begin{remark}[Index update and complementary \(\tfrac13\)-fractions (router)]
Fix a step \(t\) and let
\[
N \;:=\; a_t m_{t-1}+k^{(p_t)}_t\in\mathbb Z,
\qquad
j_t \;:=\; N \bmod 3 \in\{0,1,2\}.
\]
Then \(N=3m_t+j_t\), hence
\[
m_t \;=\; \left\lfloor \frac{N}{3}\right\rfloor
\;=\; \frac{N-j_t}{3}
\;=\; \frac{a_t m_{t-1}+k^{(p_t)}_t-j_t}{3}.
\]

In our parameterization,
\[
a_t = 2^{\alpha_t+6p_t},
\qquad
k^{(p_t)}_t=\frac{\beta_t\,64^{p_t}+c_t}{9},
\]
so one may also write (split form)
\[
m_t=\frac{a_t m_{t-1}-j_t}{3}+\frac{k^{(p_t)}_t}{3}.
\]
Although \(k^{(p_t)}_t/3\) need not be an integer, it is \emph{complementary} to the first term:
since \(j_t \equiv a_t m_{t-1}+k^{(p_t)}_t \pmod 3\), we have
\[
a_t m_{t-1}-j_t \equiv -\,k^{(p_t)}_t \pmod 3,
\]
so the two summands always carry opposite \(\{0,\tfrac13,\tfrac23\}\)-fractional parts,
and therefore their sum \(m_t\) is an integer.
\end{remark}

\begin{remark}[Complementary \(\tfrac13\)-fractions and a convenient choice of \(h\)]
Let
\[
N \;:=\; a_t m_{t-1}+k^{(p_t)}_t \in \mathbb Z,
\qquad
j_t \;:=\; N \bmod 3 \in \{0,1,2\},
\]
so that \(N=3m_t+j_t\) and therefore
\[
m_t=\frac{a_t m_{t-1}+k^{(p_t)}_t-j_t}{3}\in\mathbb Z.
\]
Define
\[
h_t \;:=\; \left\{\frac{a_t m_{t-1}}{3}\right\}
\;=\; \frac{(a_t m_{t-1})\bmod 3}{3}
\in\left\{0,\tfrac13,\tfrac23\right\},
\]
so that \(\frac{a_t m_{t-1}}{3}-h_t\in\mathbb Z\).  Writing
\[
m_t=\frac{a_t m_{t-1}}{3}+\frac{k^{(p_t)}_t-j_t}{3},
\]
and using \(m_t\in\mathbb Z\), we obtain the complementary integrality relation
\[
\frac{k^{(p_t)}_t-j_t}{3}+h_t\in\mathbb Z.
\]
Equivalently, the two \(/\!3\) terms have opposite fractional parts:
\[
\frac{a_t m_{t-1}}{3}\equiv -\,\frac{k^{(p_t)}_t-j_t}{3}\pmod 1.
\]
\end{remark}


\subsection{Closed Form for \texorpdfstring{$m_n$}{m\_n}}

Unrolling the recurrence yields a summation that describes the trajectory's "history."

\begin{theorem}[Index Evolution Formula]
For a word of length \(n\), the final index \(m_n\) is related to the start \(m_0\) by:
\begin{equation}
m_n \;=\; \frac{A_W\,m_0}{3^n} \;+\; \sum_{t=1}^{n} \frac{P_{n,t}}{3^{n-t+1}} (k^{(p)}_t - j_t),
\end{equation}
where \(P_{n,t} = \prod_{i=t+1}^{n} a_i\) is the product of slopes from step \(t+1\) to \(n\).
\end{theorem}

\begin{remark}[Zero-Start Independence]
If we start from \(x_0=1\) (or any minimal element where \(m_0=0\)), the first term vanishes. The entire trajectory is then determined solely by the structural constants of the word (the \(k\) values) and the routing choices (\(j\)). This confirms that the path from 1 is deterministic and algebraically fixed.
\end{remark}


\section{Steering and Monotone Padding}
\label{sec:steering}

The core of the inverse calculus is the ability to manipulate the affine parameters of a word to satisfy specific modular congruences. We achieve this via \emph{padding}: appending short sequences of tokens to the end of a word.

\subsection{Steering Gadgets}
\begin{definition}[Steering Gadget]
A \textbf{Steering Gadget} is a short admissible word $S$ that begins and ends in the same family $f \in \{\mathrm{e}, \mathrm{o}\}$. Appending $S$ to a prefix $W$ ending in $f$ preserves the terminal family but modifies the affine parameters:
\begin{itemize}
    \item \textbf{Slope Boost:} It multiplies the slope $A_W$ by $2^{\Delta v_2}$, strictly increasing the 2-adic valuation.
    \item \textbf{Intercept Control:} It modifies the intercept $B_W$ modulo 2 (and modulo 3).
\end{itemize}
\end{definition}

Because these gadgets preserve the terminal family, they allow us to "steer" the values of $A$ and $B$ without altering the routing requirements for any subsequent steps.

\subsection{The Finite Steering Menu}
We fix a finite set of canonical gadgets $\mathcal{S}_p$ for each column $p \ge 0$. These are sufficient to generate any required 2-adic lift and parity.

\begin{table}[H]
\centering
\caption{Canonical Steering Gadgets (Base $p=0$).}
\label{tab:steering-menu}
\begin{tabular}{l c c c l}
\toprule
Family & Block & Type Path & $\Delta v_2(A)$ & Effect on $B$ \\ \midrule
\textbf{Family e} & $\Psi_1$ & $\mathrm{e} \to \mathrm{e}$ & $+4$ & Preserves Parity ($k \equiv 0$) \\
& $\Psi_2$ & $\mathrm{e} \to \mathrm{e}$ & $+6$ & Preserves Parity ($k \equiv 0$) \\
& $\psi_2 \circ \omega_1$ & $\mathrm{e} \to \mathrm{o} \to \mathrm{e}$ & $+3$ & \textbf{Toggles Parity} ($k \equiv 1$) \\ \midrule
\textbf{Family o} & $\Omega_1$ & $\mathrm{o} \to \mathrm{o}$ & $+3$ & Preserves Parity ($k \equiv 0$) \\
& $\Omega_0$ & $\mathrm{o} \to \mathrm{o}$ & $+5$ & Preserves Parity ($k \equiv 0$) \\
& $\Omega_2$ & $\mathrm{o} \to \mathrm{o}$ & $+1$ & \textbf{Toggles Parity} ($k \equiv 1$) \\
\bottomrule
\end{tabular}
\end{table}

\begin{remark}[Higher Columns]
For $p \ge 1$, the structure remains identical, but the valuation lift increases by $6p$ per token. The parity effects depend on $k^{(p)} \bmod 2$, which is tabulated in the full reference implementation. The menu above is sufficient for $p=0$.
\end{remark}

\subsection{Mod-3 Steering}
In addition to parity, we must often control $B \pmod 3$ to ensure the final congruence is solvable (removing factors of 3).

\begin{lemma}[Mod-3 Control]
\label{lem:mod3-steering}
For each family $f \in \{\mathrm{e}, \mathrm{o}\}$, the affine maps $B \mapsto 2^\alpha B + k \pmod 3$ induced by the available tokens generate the full affine group $\mathrm{AGL}_1(\mathbb{F}_3)$.
Consequently, from any current state $B_W$, there exists a steering gadget of length $\le 2$ that sets the new intercept $B' \equiv r \pmod 3$ for any target $r \in \{0, 1, 2\}$.
\end{lemma}

\begin{proof}
In family $\mathrm{o}$, $\Omega_1$ maps $B \mapsto 2B+1$ and $\Omega_0$ maps $B \mapsto 2B+2$. These two operations generate all permutations of $\{0,1,2\}$.
In family $\mathrm{e}$, $\Psi_0$ maps $B \mapsto B$ (identity) and $\Psi_2$ maps $B \mapsto B+1$ (shift). Iterating $\Psi_2$ reaches any residue.
\end{proof}

\subsection{The Monotone Padding Lemma}
We combine these results into the primary tool used for inductive lifting.

\begin{lemma}[Monotone Padding]
\label{lem:monotone-padding}
Let $W$ be any admissible word ending in family $f$. For any target valuation $K$ and any target parity $b \in \{0, 1\}$, there exists a padding string $S$ such that the extended word $W' = W \cdot S$ satisfies:
\begin{enumerate}
    \item \textbf{Family Preservation:} $W'$ ends in the same family $f$.
    \item \textbf{Valuation Target:} $v_2(A_{W'}) \ge K$.
    \item \textbf{Parity Control:} $B_{W'} \equiv b \pmod 2$.
\end{enumerate}
\end{lemma}

\begin{proof}
Since every gadget in Table~\ref{tab:steering-menu} has $\Delta v_2 > 0$, we can repeat the "Preserves Parity" gadgets to raise $v_2(A)$ arbitrarily high (Monotone Lift).
If the resulting $B$ has the wrong parity, we append exactly one "Toggle Parity" gadget (e.g., $\Omega_2$ or $\psi_2 \circ \omega_1$). This flips the bit $B \bmod 2$ and adds positive valuation, satisfying all conditions.
\end{proof}

\begin{lemma}[Joint $(\bmod 2,\bmod 3)$ steering with monotone padding]
\label{lem:joint-mod6-steering}
Fix a family $f\in\{\mathrm e,\mathrm o\}$ and let $W$ be any admissible word ending in $f$.
Let $K\ge 1$ and let $r\in\{0,1,2,3,4,5\}$ be any target residue class.

Then there exists an admissible extension $S$ such that the extended word
$W' = W\cdot S$ satisfies:
\begin{enumerate}
\item \textbf{Family preservation:} $W'$ ends in the same family $f$.
\item \textbf{Valuation target:} $v_2(A_{W'}) \ge K$.
\item \textbf{Joint steering:} $B_{W'} \equiv r \pmod 6$.
\end{enumerate}
Moreover, $S$ can be chosen from a bounded-length concatenation of the canonical gadgets
in Table~\ref{tab:steering-menu} (with the appropriate lift index $p$ if used in the paper).
\end{lemma}

\begin{proof}
Step 1 (raise $v_2(A)$ without leaving the family).
By Lemma~\ref{lem:monotone-padding}, for any prescribed parity class $b\in\{0,1\}$,
there exists an admissible padding word $P_b$ such that $W_1 := W\cdot P_b$ ends in family $f$,
satisfies $v_2(A_{W_1})\ge K$, and has
\[
B_{W_1}\equiv b \pmod 2.
\]
In particular, after this step we have achieved the valuation target and fixed $B\bmod 2$.

Step 2 (finite controllability on $B\bmod 6$ inside a fixed family).
Consider the finite directed graph whose vertices are the residue classes
\[
(f,\bar B)\in\{\mathrm e,\mathrm o\}\times(\mathbb Z/6\mathbb Z),
\]
and whose directed edges are induced by appending one canonical gadget from
Table~\ref{tab:steering-menu} (i.e.\ $(f,\bar B)\to(f,\overline{B'})$ if appending that gadget is
admissible from family $f$ and maps $B\mapsto B'$ modulo $6$ according to the paper's token update rules).
Because the gadget set is finite and the state space has size $12$, this is a finite graph.

By the Mod-$3$ control lemma (Lemma~\ref{lem:mod3-steering}), within each family $f$ the available steering
moves act transitively on $B\bmod 3$. Table~\ref{tab:steering-menu} also contains at least one
parity-preserving gadget (effect $B\equiv B'\pmod 2$) and at least one parity-toggling gadget
(effect $B'\equiv B+1\pmod 2$) within each family.
Consequently, the induced move set is transitive on $B\bmod 6$ within each family: from any
$\bar B\in\mathbb Z/6\mathbb Z$ one can reach any other $\bar r\in\mathbb Z/6\mathbb Z$ by a word
of bounded length (bounded by the diameter of this finite graph).

Let $Q$ be such a steering word (a concatenation of canonical gadgets) that sends
$B_{W_1}\bmod 6$ to the desired $r\bmod 6$ while remaining in family $f$.
Set $W' := W_1\cdot Q$. Since all gadgets in $Q$ are admissible and family-preserving, $W'$ ends in family $f$.
Since $v_2(A)$ is nondecreasing under the padding/steering gadgets used in the paper (as recorded in
Table~\ref{tab:steering-menu}), we still have $v_2(A_{W'})\ge K$. Finally, by construction,
$B_{W'}\equiv r\pmod 6$.

The bounded-length claim follows because the steering word length can be chosen $\le 11$ by finiteness
(of a 12-state directed graph), and in practice is much smaller (one can tabulate the shortest paths).
\end{proof}


\section{Routing Compatibility}
\label{sec:routing-compat}

A central challenge in the inverse calculus is that the "Router" $j_t = \lfloor x_t/6 \rfloor \bmod 3$ depends on the floor of the current value. If we adjust the initial input $m$ to satisfy a condition at step $n$, we risk changing a router at step $t < n$, which would invalidate the chosen row sequence (a "branch flip").

We now prove that this can be prevented by imposing a sufficient 2-adic constraint on $m$.

\subsection{The Stability Threshold}
Let $W = T_1 T_2 \dots T_n$ be a fixed prefix. Let $A_t$ denote the cumulative slope up to step $t$:
\[
A_t \;=\; \prod_{i=1}^t 2^{\alpha_i + 6p_i} \;=\; 2^{S_t}, \qquad \text{where } S_t = \sum_{i=1}^t (\alpha_i + 6p_i).
\]
The value $x_t$ depends on $m$ via the term $A_t m$. To stabilize the floor functions, we must control the lower bits of $m$.

\begin{definition}[Stability Threshold]
The \textbf{Stability Threshold} $S^\ast$ for a word $W$ is the maximum accumulated exponent along the path plus one:
\begin{equation}
S^\ast \;:=\; 1 + \max_{0 \le t < n} S_t.
\end{equation}
\end{definition}

\subsection{The Compatibility Lemma}
\begin{lemma}[Routing Compatibility]
\label{lem:routing-compat}
Let $W$ be a fixed admissible prefix with planned routers $j_1, \dots, j_n$.
If we restrict the input index $m$ to a specific congruence class:
\[
m \;\equiv\; m^\ast \pmod{2^{S^\ast}},
\]
(where $m^\ast$ is compatible with the entry family), then the router remainders $r_{t+1}$ computed along the trajectory are invariant for all $m$ in that class.
Specifically, if $m^\ast$ generates the correct routers, then \emph{every} $m \equiv m^\ast \pmod{2^{S^\ast}}$ generates the same routers.
\end{lemma}

\begin{proof}
Recall the index recurrence (Section~\ref{sec:affine-forms}):
\[
m_t \;=\; \frac{A_t m + B_t - r_{t+1}}{3}.
\]
The router $r_{t+1}$ is determined by $(A_t m + B_t) \bmod 3$.
Since $A_t = 2^{S_t}$ is coprime to 3, fixing $m \bmod 3$ fixes the router sequence modulo 3.
However, we must also ensure the integrality of the division (the floor).
If we fix $m \pmod{2^{S^\ast}}$, we fix the lower $S^\ast$ bits of $m$. Since $S_t < S^\ast$, the term $A_t m$ is congruent to $A_t m^\ast \pmod{2^{S^\ast + S_t}}$.
The division by 3 (multiplication by $3^{-1}$ in the 2-adic integers) preserves this 2-adic precision.
Thus, the "decisions" made by the floor function (which depend on lower bits) remain constant.
\end{proof}

\subsection{Application: Freezing the Prefix}
This lemma provides a modular "Locking Mechanism."
\begin{enumerate}
    \item \textbf{Construct a Prefix:} Choose a word $W$ to reach a specific family or intermediate value.
    \item \textbf{Calculate $S^\ast$:} Sum the exponents.
    \item \textbf{Restrict $m$:} Solve the linear congruences for the routers modulo 3, then lift to modulo $2^{S^\ast}$.
\end{enumerate}
Once $m$ is restricted to this class, we can append any number of steering gadgets to the \emph{end} of $W$. As long as the final choice of $m$ respects the constraint $m \equiv m^\ast \pmod{2^{S^\ast}}$, the prefix $W$ will execute exactly as planned, with no branch flips.

% =============================================================================
% PART III: THE CONSTRUCTION (LIFTING & WITNESSES)
% Goal: The Inductive Proof.
% =============================================================================
\part{The Construction: Lifting and Witnesses}


\section{Residue Targeting via Last-Row Congruence}
\label{sec:residue-targeting}

Once a prefix is stabilized via routing compatibility, the task of hitting a specific target residue $x_{\mathrm{tar}} \pmod{M_K}$ (where $M_K = 3 \cdot 2^K$) falls entirely on the \emph{last token} of the word.

We analyze the affine map of a single last token $T$ chosen from column $p$.

\subsection{The Last-Step Congruence}
Let the last token have parameters $(\alpha, \beta, c, \delta)$ and column-lift $p$. Its unified form is:
\[
x' \;=\; 6\bigl(2^{\alpha_p} u + k^{(p)}\bigr) + \delta_T,
\qquad \text{where } \alpha_p = \alpha + 6p, \quad u = \Big\lfloor \frac{x}{18} \Big\rfloor.
\]
We wish to solve $x' \equiv x_{\mathrm{tar}} \pmod{M_K}$.
Rearranging terms, this is equivalent to the linear congruence:
\begin{equation}
\label{eq:last-row-cong}
a^{(p)} u \;\equiv\; r^{(p)} \pmod{M_K},
\end{equation}
where the coefficient is $a^{(p)} = 6 \cdot 2^{\alpha_p} = 3 \cdot 2^{\alpha_p+1}$, and the target remainder is $r^{(p)} = x_{\mathrm{tar}} - (6k^{(p)} + \delta_T)$.

\paragraph{Notation.}
We use $m$ for the global integer input to a word evaluation $x_W(m)=6(A_W m+B_W)+\delta_W$.
In the residue-targeting (last-step) analysis we instead parametrize the current residue class by
\[
u:=\left\lfloor \frac{x}{18}\right\rfloor,
\]
so that fixing the router state $(s,j)$ determines $x$ from $u$ via $x=18u+6j+\delta_s$.
Thus $m$ and $u$ play the same role (a free integer index), but are attached to different stages of the construction.
We retain $k^{(p)}$ for the lifted constant in the last-step unified form to match Table~\ref{tab:parameters-abc}.


\begin{lemma}[Solvability Criterion]
\label{lem:last-row-p}
The congruence \eqref{eq:last-row-cong} is solvable for $u$ if and only if
\[
g^{(p)} \;:=\; \gcd(a^{(p)}, M_K) \;=\; 3 \cdot 2^{\min(\alpha_p+1, K)}
\]
divides the target remainder $r^{(p)}$.
\end{lemma}

\subsection{The Two Regimes: Pinning vs. Solving}
Depending on the magnitude of the 2-adic lift $\alpha_p$ relative to the target precision $K$, the behavior of the last step falls into one of two distinct regimes.

\begin{proposition}[Pinning vs. Solving]
\label{prop:pin-vs-solve}
\begin{enumerate}
    \item \textbf{The Pinning Regime ($\alpha_p + 1 \ge K$):}
    In this case, $M_K$ divides $a^{(p)}$. The term $a^{(p)}u$ vanishes modulo $M_K$
    (Indeed, $2^{\alpha_p+1}\equiv 0\pmod{2^K}$ once $\alpha_p+1\ge K$, cf.\ Lemma~\ref{lem:2adic-pinning}.)
    Consequently, the output residue is \textbf{fixed} (pinned) by the token parameters alone:
    \[
    x' \;\equiv\; 6k^{(p)} + \delta_T \pmod{M_K},
    \]
    independently of the input $u$. This token acts as a "constant function" modulo $M_K$.

    \item \textbf{The Solving Regime ($\alpha_p + 1 < K$):}
    In this case, the coefficient $a^{(p)}$ retains information about $u$. The congruence has a unique solution class for $u$ modulo $2^{K-(\alpha_p+1)}$:
    \[
    u \;\equiv\; \frac{r^{(p)}}{3 \cdot 2^{\alpha_p+1}} \pmod{2^{K-(\alpha_p+1)}}.
    \] This is exactly the $2$-adic cancellation phenomenon (Lemma~\ref{lem:2adic-cancellation}).
\end{enumerate}
\end{proposition}

\begin{remark}[Canonical Choice]
This dichotomy gives us a robust algorithm:
\begin{itemize}
    \item If we want to hit a target $r'$ regardless of the history, we can try to find a \textbf{Pinning} row (high $p$) that hits it naturally.
    \item If we are constrained to a specific family, we use \textbf{Steering} (Section~\ref{sec:steering}) to ensure the divisibility condition holds, then \textbf{Solve} for the required $u$.
\end{itemize}
\end{remark}

\subsection{Examples of Targeting}

We illustrate these regimes with concrete examples from the unified table.

\begin{example}[Pinning at $K=5$ ($M_5=96$)]
Target: $x_{\mathrm{tar}} \equiv 53 \pmod{96}$.
Choose the row $\Omega_0$ (type \texttt{oo}) at $p=0$.
Parameters: $\alpha=5$, $k^{(0)}=8$, $\delta=5$.
Check Pinning Threshold: $\alpha_p + 1 = 5 + 1 = 6 \ge 5$. The condition holds.
The pinned value is:
\[
x' \;\equiv\; 6(8) + 5 \;=\; 53 \pmod{96}.
\]
Thus, $\Omega_0$ pins the target 53 exactly, regardless of the input $u$.
\end{example}

\begin{example}[Solving at $K=10$ ($M_{10}=3072$)]
Target: $x_{\mathrm{tar}} \equiv 3071 \pmod{3072}$.
Choose the row $\Omega_2$ (type \texttt{oo}) at $p=0$.
Parameters: $\alpha=1$, $k^{(0)}=1$, $\delta=5$.
Check Pinning: $\alpha_p + 1 = 2 < 10$. We are in the \textbf{Solving} regime.
We solve for $u$:
\[
6(2^1)u \;\equiv\; 3071 - (6(1)+5) \pmod{3072} \implies 12u \equiv 3060 \pmod{3072}.
\]
Dividing by 12:
\[
u \;\equiv\; \frac{3060}{12} \;=\; 255 \pmod{256}.
\]
Thus, any input $u \equiv 255 \pmod{256}$ will map to the target.
\end{example}

\paragraph{Summary tables (for $p=0$).}
To streamline the control arguments, we summarize the last-step data in two complementary tables.
Table~\ref{tab:j-output-classification} is a branch-by-branch \emph{output classifier} at $p=0$: for each row (i.e.\ inverse branch) it records the parameters $(\alpha,\beta,c,\delta)$, the derived constant $k^{(0)}=(\beta+c)/9$, and the induced output classifiers $(s',j')$ and $m'$ as functions of the residue class $r\equiv m\pmod 3$ (equivalently $u\bmod 3$ in the control normal form).
This makes it immediate, once a branch is chosen, to read off the output family $s'$ (via $\delta$), the router class $j'$, and the next-index update.
Table~\ref{tab:control-transitions-p0} reorganizes the same information by \emph{input state} $(s,j)$: each state offers exactly two branch choices corresponding to $s'=e$ or $s'=o$, and the table lists the associated $(\alpha,q,\delta)$ together with the router transition triple $j'(0,1,2)$.
In practice, Table~\ref{tab:control-transitions-p0} is used first to select a row consistent with the desired output family (and, in the solving regime, modular solvability), while Table~\ref{tab:j-output-classification} is used to record the resulting output classification and index update.


\begin{table}[H]
\centering
\small
\setlength{\tabcolsep}{3pt}
\renewcommand{\arraystretch}{1.10}

\caption{$p=0$ output classification derived from the row parameters. Write $m=3M+r$ with $r\in\{0,1,2\}$, and $k^{(0)}=(\beta+c)/9$, $\kappa = k^{(0)}\bmod 3$. Then
$j'=(r+\kappa)\bmod 3$ and $m'=2^\alpha M + t_r$ with $t_r=\left\lfloor(2^\alpha r+k^{(0)})/3\right\rfloor$.}
\label{tab:j-output-classification}

\begin{adjustbox}{max width=\linewidth}
\begin{tabular}{llccccccccll}
\toprule
Row & $(s,j)$ & Type & $\alpha$ & $\beta$ & $c$ & $\delta$ & $s'$ & $k^{(0)}=(\beta+c)/9$ & $\kappa=k^{(0)}\bmod 3$ & $j'(r=0,1,2)$ & $m' = 2^\alpha M + (t_0,t_1,t_2)$\\
\midrule
$\Psi_{0}$ & $(e,0)$ & ee & 2 & 2   & $-2$ & 1 & $e$ & 0  & 0 & $(0,1,2)$ & $4M + (0,1,2)$ \\
$\Psi_{1}$ & $(e,1)$ & ee & 4 & 56  & $-2$ & 1 & $e$ & 6  & 0 & $(0,1,2)$ & $16M + (2,7,12)$ \\
$\Psi_{2}$ & $(e,2)$ & ee & 6 & 416 & $-2$ & 1 & $e$ & 46 & 1 & $(1,2,0)$ & $64M + (15,36,58)$ \\
$\omega_{0}$ & $(o,0)$ & oe & 3 & 20  & $-2$ & 1 & $e$ & 2  & 2 & $(2,0,1)$ & $8M + (0,3,6)$ \\
$\omega_{1}$ & $(o,1)$ & oe & 1 & 11  & $-2$ & 1 & $e$ & 1  & 1 & $(1,2,0)$ & $2M + (0,1,1)$ \\
$\omega_{2}$ & $(o,2)$ & oe & 5 & 272 & $-2$ & 1 & $e$ & 30 & 0 & $(0,1,2)$ & $32M + (10,20,31)$ \\
$\psi_{0}$ & $(e,0)$ & eo & 4 & 8   & $-8$ & 5 & $o$ & 0  & 0 & $(0,1,2)$ & $16M + (0,5,10)$ \\
$\psi_{1}$ & $(e,1)$ & eo & 6 & 224 & $-8$ & 5 & $o$ & 24 & 0 & $(0,1,2)$ & $64M + (8,29,50)$ \\
$\psi_{2}$ & $(e,2)$ & eo & 2 & 26  & $-8$ & 5 & $o$ & 2  & 2 & $(2,0,1)$ & $4M + (0,2,3)$ \\
$\Omega_{0}$ & $(o,0)$ & oo & 5 & 80  & $-8$ & 5 & $o$ & 8  & 2 & $(2,0,1)$ & $32M + (2,13,24)$ \\
$\Omega_{1}$ & $(o,1)$ & oo & 3 & 44  & $-8$ & 5 & $o$ & 4  & 1 & $(1,2,0)$ & $8M + (1,4,6)$ \\
$\Omega_{2}$ & $(o,2)$ & oo & 1 & 17  & $-8$ & 5 & $o$ & 1  & 1 & $(1,2,0)$ & $2M + (0,1,1)$ \\
\bottomrule
\end{tabular}
\end{adjustbox}

\end{table}


\begin{table}[H]
\centering
\small
\setlength{\tabcolsep}{5pt}
\renewcommand{\arraystretch}{1.12}

\caption{Control transition table at $p=0$, grouped by input state $(s,j)$.
Each input state admits two branch choices: $s'=e$ or $s'=o$ (equivalently Type \texttt{*e} or \texttt{*o}).
For each chosen row, we list $(\alpha,k^{(0)},\delta)$ with $k^{(0)}=(\beta+c)/9$, and the router transition triple
$j'(0,1,2)$, where $r:=u\bmod 3$ and $j'(r)\equiv 2^\alpha u+k^{(0)}\pmod 3$.}
\label{tab:control-transitions-p0}

\begin{tabular}{lllccl}
\toprule
Input $(s,j)$ & Choice & Row & Type & $(\alpha,k^{(0)},\delta)$ & $j'(0,1,2)$ \\
\midrule
$(e,0)$ & $s'=e$ & $\Psi_{0}$ & \texttt{ee} & $(2,0,1)$  & $(0,1,2)$ \\
$(e,0)$ & $s'=o$ & $\psi_{0}$ & \texttt{eo} & $(4,0,5)$  & $(0,1,2)$ \\
\midrule
$(e,1)$ & $s'=e$ & $\Psi_{1}$ & \texttt{ee} & $(4,6,1)$  & $(0,1,2)$ \\
$(e,1)$ & $s'=o$ & $\psi_{1}$ & \texttt{eo} & $(6,24,5)$ & $(0,1,2)$ \\
\midrule
$(e,2)$ & $s'=e$ & $\Psi_{2}$ & \texttt{ee} & $(6,46,1)$ & $(1,2,0)$ \\
$(e,2)$ & $s'=o$ & $\psi_{2}$ & \texttt{eo} & $(2,2,5)$  & $(2,0,1)$ \\
\midrule
$(o,0)$ & $s'=e$ & $\omega_{0}$ & \texttt{oe} & $(3,2,1)$  & $(2,1,0)$ \\
$(o,0)$ & $s'=o$ & $\Omega_{0}$ & \texttt{oo} & $(5,8,5)$  & $(2,1,0)$ \\
\midrule
$(o,1)$ & $s'=e$ & $\omega_{1}$ & \texttt{oe} & $(1,1,1)$  & $(1,0,2)$ \\
$(o,1)$ & $s'=o$ & $\Omega_{1}$ & \texttt{oo} & $(3,4,5)$  & $(1,0,2)$ \\
\midrule
$(o,2)$ & $s'=e$ & $\omega_{2}$ & \texttt{oe} & $(5,30,1)$ & $(0,2,1)$ \\
$(o,2)$ & $s'=o$ & $\Omega_{2}$ & \texttt{oo} & $(1,1,5)$  & $(1,0,2)$ \\
\bottomrule
\end{tabular}
\end{table}

\begin{example}[Solving at $K=5$ ($M_{5}=96$) with row-selection via the control-transition table]
Target: $x_{\mathrm{tar}} \equiv 91 \pmod{96}$.

\smallskip
\noindent\textbf{Step 1 (Infer the required output family $s'$).}
Since $96\equiv 0\pmod 6$, reducing the target modulo $6$ is immediate:
\[
91 \equiv 1 \pmod 6.
\]
Hence the target lies in the $e$--family, so we must have $s'=e$, equivalently $\delta=1$ in the final-step normal form
\[
x' = 6\bigl(2^\alpha u + q\bigr)+\delta.
\]

\smallskip
\noindent\textbf{Step 2 (Use the control-transition table to select a candidate row).}
In the $p=0$ control-transition table, the constraint $s'=e$ means we must choose a row of type \texttt{*e}.
Testing the six \texttt{*e} options, the only row that admits solutions for this target is
\[
\omega_1\quad\text{(type \texttt{oe})},
\]
which occurs under input state $(s,j)=(o,1)$ and has parameters
\[
(\alpha,q,\delta)=(1,1,1).
\]

\smallskip
\noindent\textbf{Step 3 (Pinning vs.\ Solving).}
Here $K=5$ and $\alpha+1=2<5$, so we are in the \textbf{Solving} regime.

\smallskip
\noindent\textbf{Step 4 (Solve the congruence for $u$).}
Impose $x'\equiv 91\pmod{96}$ in the row formula $x'=6(2^\alpha u+k^{(0)})+\delta$:
\[
6(2^1u+1)+1 \equiv 91 \pmod{96}.
\]
Rearranging gives
\[
6(2u+1)\equiv 90 \pmod{96}.
\]
Divide by $6$ (valid since $6\mid 96$):
\[
2u+1 \equiv 15 \pmod{16}
\quad\Longrightarrow\quad
2u \equiv 14 \pmod{16}
\quad\Longrightarrow\quad
u \equiv 7 \pmod{8}.
\]
Thus, any input with $u\equiv 7\pmod 8$ maps to the target residue class.

\smallskip
\noindent\textbf{Step 5 (Extrapolate a compatible starting input $x$).}
The input decomposition is
\[
x = 18u + 6j + \delta_s,
\qquad
\delta_s=\begin{cases}
1,& s=e,\\
5,& s=o.
\end{cases}
\]
From the chosen row we have the required input state $(s,j)=(o,1)$, hence $\delta_s=5$ and $j=1$. Therefore
\[
x = 18u + 6\cdot 1 + 5 = 18u+11.
\]
Taking the smallest solution $u=7$ yields the explicit starting value
\[
x=18\cdot 7 + 11 = 137.
\]
More generally, writing $u=7+8t$ gives the full congruence class
\[
x = 18(7+8t)+11 = 137 + 144t,
\quad\text{i.e.}\quad
x \equiv 137 \pmod{144}.
\]

\smallskip
\noindent\textbf{Step 6 (Verification).}
For row $\omega_1$ at $p=0$ we have
\[
x' = 6(2u+1)+1 = 12u+7.
\]
With $u=7$ this gives $x'=12\cdot 7 + 7 = 91$, and if $u\equiv 7\pmod 8$ then
\[
x' = 12u+7 \equiv 12\cdot 7 + 7 = 91 \pmod{96},
\]
since $12\cdot 8=96$.
\end{example}

\begin{example}[Solving at $K=10$ ($M_{10}=3072$) via the one-shot reduction]
Target: $x_{\mathrm{tar}} \equiv 3071 \pmod{3072}$.
Choose the row $\Omega_2$ (type \texttt{oo}) at $p=0$, with parameters
\[
(\alpha,q,\delta)=(1,1,5),
\qquad k^{(0)}=\frac{\beta+c}{9}.
\]

\smallskip
\noindent\textbf{Step 1 (Consistency and one-shot reduction).}
Since $3071\equiv 5\pmod 6$, the target is compatible with $\delta=5$.
Define the reduced target
\[
T:=\frac{x_{\mathrm{tar}}-\delta}{6}=\frac{3071-5}{6}=511,
\qquad
v:=T-k^{(0)}=511-1=510.
\]
The row congruence
\[
x' \equiv 6(2^\alpha u+k^{(0)})+\delta \pmod{M_{10}}
\]
is equivalent to the single $2$-adic congruence
\[
2^\alpha u \equiv v \pmod{2^{10}},
\qquad\text{i.e.}\qquad
2u \equiv 510 \pmod{1024}.
\]

\smallskip
\noindent\textbf{Step 2 (Solving regime and maximal division).}
Here $\alpha<10$, so we are in the \textbf{Solving} regime.  Since $510$ is divisible by $2^\alpha=2$, we may divide by $2$:
\[
u \equiv 255 \pmod{512}.
\]
To present the \emph{coarser} (but often more convenient) family obtained by dividing the original congruence by the full factor
$6\cdot 2^\alpha=12$, note that the original condition is
\[
6\cdot 2^\alpha u \equiv x_{\mathrm{tar}}-(6q+\delta) \pmod{3\cdot 2^{10}}
\quad\Longleftrightarrow\quad
12u \equiv 3060 \pmod{3072},
\]
and since $\gcd(12,3072)=12$ we can divide by $12$ to obtain
\[
u \equiv 255 \pmod{256}.
\]
Thus, any input $u\equiv 255\pmod{256}$ maps to $x_{\mathrm{tar}}$ modulo $M_{10}$ under this row.

\smallskip
\noindent\textbf{(Optional) Reconstruct a compatible starting input $x$.}
For the row $\Omega_2$ the input state is $(s,j)=(o,2)$, hence
\[
x = 18u + 6j + \delta_s = 18u + 12 + 5 = 18u+17.
\]
Taking the smallest representative $u=255$ gives $x=18\cdot 255+17=4607$, and in general
\[
u\equiv 255\pmod{256}\quad\Longrightarrow\quad x\equiv 4607 \pmod{4608}.
\]
\end{example}

\begin{example}[Pinning at $K=10$ ($M_{10}=3072$) by lifting]
Fix $K=10$, so $M_{10}=3\cdot 2^{10}=3072$.  Choose the row $\Omega_2$ (type \texttt{oo}) and lift to $p=2$.
For this row one has $(\alpha,\beta,c,\delta)=(1,17,-8,5)$, hence
\[
\alpha_p=\alpha+6p = 1+12 = 13 \ge 10,
\qquad
k^{(p)}=\frac{\beta 64^p + c}{9}=\frac{17\cdot 64^2 - 8}{9}=7736.
\]
Therefore we are in the \textbf{Pinning} regime: since $\alpha_p\ge K$, the term $2^{\alpha_p}u$ vanishes modulo $2^K$ and the output is independent of the input index $u$.
Indeed, the lifted row map is
\[
x' \equiv 6\bigl(2^{\alpha_p}u+k^{(p)}\bigr)+\delta \pmod{M_{10}},
\]
and reducing modulo $M_{10}$ gives
\[
x' \equiv 6k^{(p)}+\delta \pmod{3072}.
\]
Substituting $k^{(2)}=7736$ and $\delta=5$ yields
\[
x' \equiv 6\cdot 7736 + 5 = 46421 \equiv 341 \pmod{3072}.
\]
Thus, \emph{every} input in the state $(s,j)=(o,2)$ (i.e.\ every $x=18u+6\cdot 2+5$ with arbitrary $u$) is mapped, under the $(\Omega_2,p=2)$ branch, to the \emph{same} residue class
\[
x' \equiv 341 \pmod{3072}.
\]
In particular, at $K=10$ the branch $\Omega_2$ becomes pinned as soon as $p\ge 2$, since $\alpha+6p\ge K$.
\end{example}



\subsection{One-shot inversion at $p=0$: solving for a compatible input $x$ from a prescribed output $x'$.}
Fix $K\ge 1$ and write
\[
M_K := 3\cdot 2^K.
\]
Assume we are given a target output residue class
\[
x' \equiv x_{\mathrm{tar}} \pmod{M_K},
\]
and we choose a specific row (branch) with parameters $(s,j)$, type $s\to s'$, and
\[
(\alpha,\beta,c,\delta)\qquad\text{(at $p=0$)},
\]
so that $s'$ is determined by $\delta\in\{1,5\}$ and
\[
q := k^{(0)} := \frac{\beta+c}{9}\in\mathbb Z.
\]
In the $p=0$ normal form, this row maps an input index $u$ to an output $x'$ by
\begin{equation}\label{eq:p0-row-map}
x' \equiv 6\bigl(2^\alpha u + q\bigr)+\delta \pmod{M_K}.
\end{equation}
We now describe a direct procedure to compute a compatible input $x$ (if one exists).

\smallskip
\noindent\textbf{Step 1 (Consistency with the output family).}
First check that the target is compatible with the chosen row's output family:
\[
x_{\mathrm{tar}} \equiv \delta \pmod 6.
\]
If not, then \eqref{eq:p0-row-map} has no solutions for this row.

\smallskip
\noindent\textbf{Step 2 (Reduce to a congruence for $u$).}
Define the reduced target
\[
T := \frac{x_{\mathrm{tar}}-\delta}{6}\in\mathbb Z,
\]
and set
\[
v := T-q.
\]
Reducing \eqref{eq:p0-row-map} and dividing by $6$ yields the equivalent congruence
\begin{equation}\label{eq:u-cong}
2^\alpha u \equiv v \pmod{2^K}.
\end{equation}

\smallskip
\noindent\textbf{Step 3 (Pinning vs.\ solving).}
\begin{enumerate}
\item[\emph{(Pinning)}] If $\alpha\ge K$, then $2^\alpha u \equiv 0\pmod{2^K}$ for every $u$, and \eqref{eq:u-cong} is solvable iff
\[
v \equiv 0 \pmod{2^K}.
\]
In this case, \eqref{eq:u-cong} places no restriction on $u$ modulo $2^K$ (any $u$ works).
\item[\emph{(Solving)}] If $\alpha< K$, then \eqref{eq:u-cong} is solvable iff
\[
v \equiv 0 \pmod{2^\alpha}.
\]
When solvable, divide \eqref{eq:u-cong} by $2^\alpha$ to obtain the explicit solution class
\begin{equation}\label{eq:u-solution}
u \equiv \frac{v}{2^\alpha} \pmod{2^{K-\alpha}}.
\end{equation}
\end{enumerate}

\smallskip
\noindent\textbf{Step 4 (Reconstruct the input $x$).}
Once a solution class for $u$ is obtained (either arbitrary $u$ in the pinning case, or the class \eqref{eq:u-solution} in the solving case), reconstruct a compatible input integer $x$ in the chosen input state $(s,j)$ via
\begin{equation}\label{eq:x-from-u}
x \;=\; 18u + 6j + \delta_s,
\qquad
\delta_s :=
\begin{cases}
1,& s=e,\\
5,& s=o.
\end{cases}
\end{equation}
In particular, if \eqref{eq:u-solution} yields $u\equiv u_0 \pmod{2^{K-\alpha}}$, then \eqref{eq:x-from-u} gives the congruence class
\[
x \equiv 18u_0 + 6j + \delta_s \pmod{18\cdot 2^{K-\alpha}}.
\]

\smallskip
\noindent\textbf{Step 5 (Optional: router class of the target).}
Since $\delta$ fixes $s'$, the output router class is read off directly from the target by
\[
j' \equiv \left\lfloor\frac{x'}{6}\right\rfloor \equiv \frac{x_{\mathrm{tar}}-\delta}{6} = T \pmod 3,
\]
so $j'$ can be computed without solving for $u$.

\subsection{One-shot inversion for general $p\ge 0$: solving for a compatible input $x$ from a prescribed output $x'$.}

\begin{table}[H]
\centering
\small
\setlength{\tabcolsep}{4pt}
\renewcommand{\arraystretch}{1.12}

\caption{General $p\ge 0$ control-transition table (lifted parameters).  Each input state $(s,j)$ admits two choices
corresponding to $s'=e$ or $s'=o$ (Type \texttt{*e} or \texttt{*o}).  For each branch (row) we list the lifted exponent
$\alpha_p=\alpha+6p$ and the lifted constant $k^{(p)}=(\beta 64^p + c)/9$ so that
$x'\equiv 6(2^{\alpha_p}u+k^{(p)})+\delta \pmod{M_K}$ with $M_K=3\cdot 2^K$.
The router transition triple $j'(0,1,2)$ (where $r:=u\bmod 3$) is independent of $p$ since $64^p\equiv 1\pmod 3$ and $6p$ is even.}
\label{tab:control-transitions-general-p}

\begin{adjustbox}{max width=\linewidth}
\begin{tabular}{lllccll}
\toprule
Input $(s,j)$ & Choice & Row & Type & $\delta$ & $(\alpha_p,\ k^{(p)})$ & $j'(0,1,2)$ \\
\midrule
$(e,0)$ & $s'=e$ & $\Psi_{0}$ & \texttt{ee} & 1 & $(2+6p,\ (2\cdot 64^p-2)/9)$   & $(0,1,2)$ \\
$(e,0)$ & $s'=o$ & $\psi_{0}$ & \texttt{eo} & 5 & $(4+6p,\ (8\cdot 64^p-8)/9)$   & $(0,1,2)$ \\
\midrule
$(e,1)$ & $s'=e$ & $\Psi_{1}$ & \texttt{ee} & 1 & $(4+6p,\ (56\cdot 64^p-2)/9)$  & $(0,1,2)$ \\
$(e,1)$ & $s'=o$ & $\psi_{1}$ & \texttt{eo} & 5 & $(6+6p,\ (224\cdot 64^p-8)/9)$ & $(0,1,2)$ \\
\midrule
$(e,2)$ & $s'=e$ & $\Psi_{2}$ & \texttt{ee} & 1 & $(6+6p,\ (416\cdot 64^p-2)/9)$ & $(1,2,0)$ \\
$(e,2)$ & $s'=o$ & $\psi_{2}$ & \texttt{eo} & 5 & $(2+6p,\ (26\cdot 64^p-8)/9)$  & $(2,0,1)$ \\
\midrule
$(o,0)$ & $s'=e$ & $\omega_{0}$ & \texttt{oe} & 1 & $(3+6p,\ (20\cdot 64^p-2)/9)$  & $(2,1,0)$ \\
$(o,0)$ & $s'=o$ & $\Omega_{0}$ & \texttt{oo} & 5 & $(5+6p,\ (80\cdot 64^p-8)/9)$  & $(2,1,0)$ \\
\midrule
$(o,1)$ & $s'=e$ & $\omega_{1}$ & \texttt{oe} & 1 & $(1+6p,\ (11\cdot 64^p-2)/9)$  & $(1,0,2)$ \\
$(o,1)$ & $s'=o$ & $\Omega_{1}$ & \texttt{oo} & 5 & $(3+6p,\ (44\cdot 64^p-8)/9)$  & $(1,0,2)$ \\
\midrule
$(o,2)$ & $s'=e$ & $\omega_{2}$ & \texttt{oe} & 1 & $(5+6p,\ (272\cdot 64^p-2)/9)$ & $(0,2,1)$ \\
$(o,2)$ & $s'=o$ & $\Omega_{2}$ & \texttt{oo} & 5 & $(1+6p,\ (17\cdot 64^p-8)/9)$  & $(1,0,2)$ \\
\bottomrule
\end{tabular}
\end{adjustbox}
\end{table}

Fix $K\ge 1$ and set
\[
M_K := 3\cdot 2^K.
\]
Assume we are given a target output residue class
\[
x' \equiv x_{\mathrm{tar}} \pmod{M_K},
\]
and we choose a specific row (branch) with input state $(s,j)$, type $s\to s'$, and parameters
\[
(\alpha,\beta,c,\delta),
\qquad \delta\in\{1,5\}.
\]
For each $p\ge 0$, recall
\[
F(p,u) := \frac{(9u2^\alpha+\beta)\,64^p + c}{9},
\qquad
x' = 6F(p,u)+\delta,
\]
and define
\[
\alpha_p := \alpha + 6p,
\qquad
k^{(p)} := \frac{\beta\,64^p + c}{9}.
\]
(For the rows in the parameter table, $k^{(p)}\in\mathbb Z$ for all $p\ge 0$.)  Using $64^p=2^{6p}$, one has the affine form
\begin{equation}\label{eq:row-map-general-p}
F(p,u)=u\,2^{\alpha_p}+k^{(p)},
\qquad
x' \equiv 6\bigl(u\,2^{\alpha_p}+k^{(p)}\bigr)+\delta \pmod{M_K}.
\end{equation}
We now describe a direct procedure to compute a compatible input $x$ (if one exists), at a fixed choice of $(\text{row},p,K)$.

\smallskip
\noindent\textbf{Step 1 (Consistency with the output family).}
First check that the target is compatible with the chosen row's output family:
\[
x_{\mathrm{tar}} \equiv \delta \pmod 6.
\]
If not, then \eqref{eq:row-map-general-p} has no solutions for this row.

\smallskip
\noindent\textbf{Step 2 (Reduce to a congruence for $u$).}
Define the reduced target
\[
T := \frac{x_{\mathrm{tar}}-\delta}{6}\in\mathbb Z,
\]
and set
\[
v := T-k^{(p)}.
\]
Dividing \eqref{eq:row-map-general-p} by $6$ and reducing modulo $2^K$ yields the equivalent congruence
\begin{equation}\label{eq:u-cong-general-p}
2^{\alpha_p}u \equiv v \pmod{2^K}.
\end{equation}

\smallskip
\noindent\textbf{Step 3 (Pinning vs.\ solving).}
\begin{enumerate}
\item[\emph{(Pinning)}] If $\alpha_p\ge K$, then $2^{\alpha_p}u \equiv 0\pmod{2^K}$ for every $u$, and \eqref{eq:u-cong-general-p} is solvable iff
\[
v \equiv 0 \pmod{2^K}.
\]
In this case, \eqref{eq:u-cong-general-p} places no restriction on $u$ modulo $2^K$ (any $u$ works).
\item[\emph{(Solving)}] If $\alpha_p< K$, then \eqref{eq:u-cong-general-p} is solvable iff
\[
v \equiv 0 \pmod{2^{\alpha_p}}.
\]
When solvable, divide \eqref{eq:u-cong-general-p} by $2^{\alpha_p}$ to obtain the explicit solution class
\begin{equation}\label{eq:u-solution-general-p}
u \equiv \frac{v}{2^{\alpha_p}} \pmod{2^{K-\alpha_p}}.
\end{equation}
\end{enumerate}

\smallskip
\noindent\textbf{Step 4 (Reconstruct the input $x$).}
Once a solution class for $u$ is obtained (either arbitrary $u$ in the pinning case, or the class \eqref{eq:u-solution-general-p} in the solving case), reconstruct a compatible input integer $x$ in the chosen input state $(s,j)$ via
\begin{equation}\label{eq:x-from-u-general-p}
x \;=\; 18u + 6j + \delta_s,
\qquad
\delta_s :=
\begin{cases}
1,& s=e,\\
5,& s=o.
\end{cases}
\end{equation}
In particular, if \eqref{eq:u-solution-general-p} yields $u\equiv u_0 \pmod{2^{K-\alpha_p}}$, then \eqref{eq:x-from-u-general-p} gives the congruence class
\[
x \equiv 18u_0 + 6j + \delta_s \pmod{18\cdot 2^{K-\alpha_p}}.
\]

\smallskip
\noindent\textbf{Step 5 (Optional: router class of the target).}
Since $\delta$ fixes $s'$, the output router class is read off directly from the target by
\[
j' \equiv \left\lfloor\frac{x'}{6}\right\rfloor \equiv \frac{x_{\mathrm{tar}}-\delta}{6} = T \pmod 3,
\]
so $j'$ can be computed without solving for $u$.




\section{Base Witnesses (Mod 24)}
\label{sec:base-witnesses}

To initialize the inductive lifting procedure, we must establish that every odd residue class modulo \(M_3 = 24\) is reachable.

\begin{theorem}[Uniform Base Coverage]
\label{thm:base-coverage}
For each odd residue \(r \in \{1, 5, 7, 11, 13, 17, 19, 23\}\) modulo \(24\), there exists a certified inverse word \(W_r\) and an admissible choice of the internal index \(m\) such that
\[
x_{W_r}(m) \equiv r \pmod{24}.
\]
Moreover, \(W_r\) can be chosen to end in the correct family determined by \(r \bmod 6\): family \(\mathrm{e}\) if \(r \equiv 1 \pmod{6}\), and family \(\mathrm{o}\) if \(r \equiv 5 \pmod{6}\).
\end{theorem}

\subsection{Witnesses from \texorpdfstring{$x_0=1$}{x0=1}}
We demonstrate existence by providing explicit words that generate these residues starting from the seed \(1\) (where \(m_0=0\)). Table~\ref{tab:base-witnesses} lists a specific word \(W_r\) for each target \(r\).

\begin{table}[!htbp]
\centering
\caption{Base witnesses mod 24 from \(x_0=1\). Each step obeys routing and type navigation.}
\label{tab:base-witnesses}
\begin{tabular}{c c l l}
\toprule
Target \(r\) & Family & Word \(W_r\) & Step Trace from 1 \\ \midrule
\(1\) & \(\mathrm{e}\) & \(\Psi\) & \(1\) \\
\(5\) & \(\mathrm{o}\) & \(\psi\) & \(1 \xrightarrow{\psi} 5\) \\
\(13\) & \(\mathrm{e}\) & \(\psi\,\omega\) & \(1 \xrightarrow{\psi} 5 \xrightarrow{\omega} 13\) \\
\(17\) & \(\mathrm{o}\) & \(\Psi\,\psi\,\omega\,\psi\) & \(1 \xrightarrow{\Psi} 1 \xrightarrow{\psi} 5 \xrightarrow{\omega} 13 \xrightarrow{\psi} 17\) \\
\(11\) & \(\mathrm{o}\) & \(\psi\,\omega\,\psi\,\Omega\) & \(1 \xrightarrow{\psi} 5 \xrightarrow{\omega} 13 \xrightarrow{\psi} 17 \xrightarrow{\Omega} 11\) \\
\(7\) & \(\mathrm{e}\) & \(\psi\,\omega\,\psi\,\Omega\,\omega\) & \(1 \to 5 \to 13 \to 17 \to 11 \to 7\) \\
\(19\) & \(\mathrm{e}\) & \(\psi\,\omega\,\psi\,\Omega\,\Omega\,\omega\) & \(1 \to 5 \to 13 \to 17 \to 11 \to 29 \to 19\) \\
\(23\) & \(\mathrm{o}\) & \(\psi\,\Omega\,\Omega\,\Omega\) & \(1 \xrightarrow{\psi} 5 \xrightarrow{\Omega} 53 \xrightarrow{\Omega} 35 \xrightarrow{\Omega} 23\) \\
\bottomrule
\end{tabular}
\end{table}

\begin{proposition}[Verification]
For each row in Table~\ref{tab:base-witnesses}, the step trace is router--admissible at every token, terminates in the stated family, and yields a final value \(x \equiv r \pmod{24}\). Furthermore, the forward check \(U(x_{t+1}) = x_t\) holds for every step.
\end{proposition}

\begin{lemma}[Prefix routing compatibility under joint congruence control]
\label{lem:prefix-compatibility}
Fix a certified program (word) prefix $W=t_1t_2\cdots t_L$ of length $L$.
Let the router at step $\ell$ be
\[
j_\ell(m) \;:=\; (a_\ell m + k_\ell)\bmod 3,
\]
where $a_\ell,k_\ell\in\mathbb Z$ are the (prefix-determined) coefficients appearing
in the index recurrence of the paper, so that $j_\ell$ depends on $m$ only through
$(a_\ell m + k_\ell)\bmod 3$.

Then there exists an integer $S^\ast=S^\ast(W)\ge 0$ such that for any two indices
$m,m'$ satisfying
\[
m \equiv m' \pmod{3\cdot 2^{S^\ast}},
\]
we have
\[
j_\ell(m)=j_\ell(m') \quad\text{for all }1\le \ell\le L.
\]
In particular, the row selections determined by the router sequence are identical
on the first $L$ steps for $m$ and $m'$.
\end{lemma}

\begin{proof}
Fix $\ell\le L$. Since the router depends on $(a_\ell m+k_\ell)\bmod 3$, it suffices to
show $a_\ell(m-m')\equiv 0\pmod 3$.
By hypothesis, $m-m'$ is divisible by $3$, hence $a_\ell(m-m')\equiv 0\pmod 3$ for any
integer $a_\ell$. Therefore $(a_\ell m+k_\ell)\equiv(a_\ell m'+k_\ell)\pmod 3$ and
$j_\ell(m)=j_\ell(m')$.
The $2^{S^\ast}$ factor is included because later steps in the construction impose
$2$-adic integrality/floor constraints; choosing $S^\ast$ large enough to satisfy those
constraints for the prefix $W$ yields the stated joint modulus.
\end{proof}



\section{Inductive Lifting (\texorpdfstring{$M_K \to M_{K+1}$}{MK -> MK+1})}
\label{sec:inductive-lifting}

Having established the base case at $K=3$ (Section~\ref{sec:base-witnesses}), we now prove the inductive step: given full reachability of odd residues modulo $M_K = 3 \cdot 2^K$, we can extend reachability to $M_{K+1} = 3 \cdot 2^{K+1}$.


\subsection{The Lifting Lemma}
The lifting mechanism relies on the fact that any target residue $r' \in M_{K+1}$ projects down to a known residue $r \in M_K$. We use the existing witness for $r$ as a template, then apply steering gadgets to refine the precision.

\begin{lemma}[Lifting $K \to K+1$]
\label{lem:lifting}
Fix $K \ge 3$. Assume the inductive hypothesis that for every odd residue
$r \pmod{M_K}$ there exists a certified word $W$ and an integer input $m$ such that
\[
x_W(m) \equiv r \pmod{M_K}.
\]
Then for every odd target residue $r' \pmod{M_{K+1}}$ there exists a certified word
$W'$ and an integer input $m'$ such that
\[
x_{W'}(m') \equiv r' \pmod{M_{K+1}}.
\]
\end{lemma}

\begin{proof}
Let $r' \in \{0, \dots, M_{K+1}-1\}$ be the target odd residue.
\begin{enumerate}
    \item \textbf{Project Down:} Let $r = r' \bmod M_K$. By the induction hypothesis, there exists a word $W$ (ending in the correct family for $r'$) such that $x_W(m) \equiv r \pmod{M_K}$.

    \item \textbf{Mod-3 Alignment:} The affine form is $x_{W}(m) = 6(A_W m + B_W) + \delta_W$. To ensure the final congruence is solvable, we must remove the factor of 3 from the obstruction.
    Use Lemma~\ref{lem:mod3-steering} to append a short same-family steering gadget so that the new intercept satisfies:
    \[ B_{W'} \;\equiv\; \frac{r'-\delta_W}{6} \pmod 3. \]

    \item \textbf{2-adic Steering:} Use Lemma~\ref{lem:monotone-padding} to append same-family gadgets until $v_2(A_{W'}) \ge K$. Simultaneously, toggle the parity of $B_{W'}$ to ensure that the term $\frac{r'-\delta_W}{6} - B_{W'}$ is divisible by $2^{\min(\alpha_p+1, K)}$.
    This guarantees that the solvability criterion $g^{(p)} \mid r^{(p)}$ from Lemma~\ref{lem:last-row-p} is met.

    \item \textbf{Routing Stability:} Apply Lemma~\ref{lem:routing-compat} to restrict the input $m$ to a class modulo $2^{S^\ast}$ that freezes all prefix routers. This ensures that the steering in steps 2 and 3 does not invalidate the original path $W$.

    \item \textbf{Solve:} With the algebra aligned, the last-row congruence
    \[
    A_{W'} m \;\equiv\; \frac{r'-\delta_W}{6} - B_{W'} \pmod{2^K}
    \]
    is solvable. Choose $m'$ to be the \emph{least nonnegative} solution in its congruence class.
    More precisely, writing $\sigma:=v_2(A_{W'})$ and $A_{W'}=2^\sigma v$ with $v$ odd, the congruence
    determines $m'$ uniquely modulo $2^{K-\sigma}$; take the representative
    \[
    0 \le m' < 2^{K-\sigma}.
    \]
    By Lemma~\ref{lem:prefix-compatibility}, this canonical choice lies in the stable routing
    class ensured by step~4.

\end{enumerate}
Thus, the constructed word and input satisfy $x_{W'}(m') \equiv r' \pmod{M_{K+1}}$.
\end{proof}

\subsection{Global Reachability Theorem}

\begin{theorem}[Reachability for all $K$]
\label{thm:reachability}
Let $M_K := 3\cdot 2^K$ and let
\[
\mathcal R_K := \{\, r \in \mathbb Z/M_K\mathbb Z : r \text{ is odd and } r\not\equiv 0 \pmod 3 \,\}
\]
be the set of \emph{active odd} residue classes modulo $M_K$.
For every $K\ge 3$ and every $r\in \mathcal R_K$, there exists a certified word $W$
and an integer $m\ge 0$ such that
\[
x_W(m)\equiv r \pmod{M_K}.
\]
Moreover, in the terminal solve step one may choose $m$ canonically (least nonnegative
representative in its congruence class), so that if $\sigma:=v_2(A_W)$ then
\[
0\le m < 2^{K-\sigma}.
\]
In addition, when the theorem is applied to a fixed odd target $x$, the inductive
construction may be carried out inside the router class
\[
j(x):=\left\lfloor \frac{x}{6}\right\rfloor \bmod 3,
\]
so that the resulting witness value $y:=x_W(m)$ satisfies
\[
y \equiv x \pmod{M_K},
\qquad
y \bmod 6 = x \bmod 6,
\qquad
\left\lfloor \frac{y}{6}\right\rfloor \bmod 3
=
\left\lfloor \frac{x}{6}\right\rfloor \bmod 3.
\]
\end{theorem}

\begin{proof}
\textbf{Base case ($K=3$).}
By Section~\ref{sec:base-witnesses} (Table~\ref{tab:base-witnesses}), every active odd residue
class modulo $M_3=24$ has an explicit certified witness. This establishes the claim for $K=3$.

\textbf{Inductive step.}
Assume the claim holds for some $K\ge 3$, and fix any $r'\in \mathcal R_{K+1}$.
Let $r$ be the reduction of $r'$ modulo $M_K$.
By the inductive hypothesis there exist a certified word $W$ and $m\ge 0$ such that
\[
x_W(m)\equiv r \pmod{M_K}.
\]
Apply Lemma~\ref{lem:lifting} (the $K\to K{+}1$ lifting lemma) to lift this witness
from modulus $M_K$ to modulus $M_{K+1}$, producing an extended certified word $W'$
(and a terminal input $m'$) such that
\[
x_{W'}(m') \equiv r' \pmod{M_{K+1}}.
\]
When the target is a fixed odd integer $x$, we may execute the lifting step inside the
router class $j(x)=\lfloor x/6\rfloor\bmod 3$ (Lemma~\ref{lem:router-locking}).
In the terminal congruence solve step inside Lemma~\ref{lem:lifting}, choose $m'$ as the
least nonnegative solution in its congruence class. Writing $\sigma:=v_2(A_{W'})$, this yields
the canonical bound $0\le m' < 2^{K+1-\sigma}$.

Thus every $r'\in\mathcal R_{K+1}$ is reachable. By induction, reachability holds for all
$K\ge 3$.
\end{proof}


\begin{example}[Lifting Trace]
Suppose we have a witness for $13 \pmod{24}$ ($K=3$), which is $W=\psi\,\omega$.
To hit $13 \pmod{48}$ ($K=4$):
\begin{enumerate}
    \item Check the current value. If $x_W(m) \equiv 13 \pmod{48}$, we are done.
    \item If $x_W(m) \equiv 13+24 = 37 \pmod{48}$, the value is "off" by the half-modulus.
    \item We append a steering gadget (e.g., $\Psi_1$ at $p=0$, which adds drift $+24$ modulo 48, or a parity toggler) to shift the residue by exactly the required amount.
    \item The new word $W' = \psi\,\omega\,\dots$ hits $13 \pmod{48}$ exactly.
\end{enumerate}
\end{example}

\begin{corollary}[Nested lifting of witnesses]
\label{cor:nested-lifting}
In the inductive construction in the proof of Theorem~\ref{thm:reachability}, the witnesses
may be chosen \emph{nested} in the sense that for each $K\ge 3$ one can select a certified
word $W_K$ and input $m_K$ such that
\[
x_{W_K}(m_K)\equiv r \pmod{M_K},
\]
and the next-stage witness satisfies
\[
W_{K+1} \;=\; W_K \cdot G_K
\]
for some (bounded-length) gadget word $G_K$ produced by the lifting procedure
(Lemma~\ref{lem:lifting}), i.e.\ each witness word is a prefix of the next.
Moreover, the terminal input can be chosen canonically as in Theorem~\ref{thm:reachability}.
\end{corollary}

\begin{proof}
In the inductive step of Theorem~\ref{thm:reachability}, the witness at level $K{+}1$ is
constructed by taking an existing witness word $W_K$ and appending a finite concatenation
of the steering/padding gadgets used in Lemma~\ref{lem:lifting}. Denote this concatenation
by $G_K$. Then the lifted witness word is exactly $W_{K+1}=W_K\cdot G_K$, proving nesting.
The canonical choice of the terminal input is the one specified in the solve step of
Lemma~\ref{lem:lifting} (least nonnegative representative).
\end{proof}

\begin{lemma}[Router-locking within reachability]
\label{lem:router-locking}
Fix $K\ge 3$ and an odd target $x$. Let
\[
\delta_{6} := x\bmod 6 \in\{1,5\},\qquad
j := \left\lfloor \frac{x}{6}\right\rfloor \bmod 3 \in\{0,1,2\}.
\]
Then Theorem~\ref{thm:reachability} can be applied so that the produced witness value
$y=x_W(m)$ satisfies \emph{in addition}:
\[
y \bmod 6 = \delta_{6},
\qquad
\left\lfloor \frac{y}{6}\right\rfloor \bmod 3 = j.
\]
\end{lemma}

\begin{proof}
In the lifting procedure (Lemma~\ref{lem:lifting}), Step~4 enforces \emph{routing stability}:
the lifted word is constructed inside a stable routing class determined by the router digit.
Choosing the stable routing class indexed by $j$ forces the terminal witness value $y$
to lie in the same router class, i.e.\ $\lfloor y/6\rfloor \bmod 3=j$.
Meanwhile $y\equiv x\pmod{M_{K+1}}$ implies $y\equiv x\pmod 6$, hence $y\bmod 6=\delta_{6}$.
\end{proof}




\section{From Residues to Exact Integers}
\label{sec:exact-integers}

The previous sections established that for any $K$, we can find a word $W$ and input $m$ such that $x_W(m) \equiv x_{\mathrm{tar}} \pmod{3 \cdot 2^K}$. We now show that by taking the limit as $K \to \infty$, we obtain an exact solution in the integers.

\subsection{Linear 2-adic Lifting}
The affine form of a word is $x_W(m) = 6(A_W m + B_W) + \delta_W$. Solving $x_W(m) = x_{\mathrm{tar}}$ is equivalent to solving the linear equation:
\begin{equation}
\label{eq:exact-linear}
A_W m \;=\; \frac{x_{\mathrm{tar}} - \delta_W}{6} - B_W.
\end{equation}
Since $A_W = 3 \cdot 2^{\alpha(W)}$, this is a linear equation over the 2-adic integers.

\paragraph{Reusable $2$-adic tools.}
We will repeatedly reduce control and lifting statements to elementary congruences modulo powers of $2$.
For convenience, we isolate three standard facts that will be used throughout without further comment:
Lemma~\ref{lem:2adic-cancellation} formalizes cancellation of an odd factor and yields the resulting solution class modulo a power of two;
Lemma~\ref{lem:2adic-pinning} records the ``pinning'' phenomenon that occurs once the $2$-power exceeds the modulus;
and Lemma~\ref{lem:router-from-target} observes that, once the family digit $\delta\in\{1,5\}$ is fixed, the router digit $j'$
is read off directly from the target output via $\lfloor x'/6\rfloor\bmod 3$.
These lemmas are the basic arithmetic engine behind both the pinning/solving dichotomy and the congruence-class descriptions of solution sets.


\begin{lemma}[2-adic cancellation and classes]
\label{lem:2adic-cancellation}
Let $K\ge 1$, let $\sigma \ge 0$, and write $A=2^{\sigma} v$ with $v$ odd.
For any integers $m,m'$, if $K\ge \sigma$ then
\[
A m \equiv A m' \pmod{2^K}
\quad\Longleftrightarrow\quad
m \equiv m' \pmod{2^{K-\sigma}}.
\]
Equivalently, for fixed $c$ the congruence
\[
A m \equiv A c \pmod{2^K}
\]
has solution set the unique residue class $m\equiv c \pmod{2^{K-\sigma}}$.
\end{lemma}

\begin{proof}
Assume $K\ge \sigma$. From $2^{\sigma} v m \equiv 2^{\sigma} v m' \pmod{2^K}$ we may cancel $2^{\sigma}$ to get
$v m \equiv v m' \pmod{2^{K-\sigma}}$.
Since $v$ is odd, it is invertible modulo $2^{K-\sigma}$, hence $m\equiv m' \pmod{2^{K-\sigma}}$.
The converse is immediate by multiplying a congruence $m\equiv m' \pmod{2^{K-\sigma}}$ by $2^{\sigma} v$.
\end{proof}


\begin{lemma}[2-adic pinning]
\label{lem:2adic-pinning}
Let $K\ge 1$ and $\sigma\ge K$.  Then for every integer $m$,
\[
2^{\sigma} m \equiv 0 \pmod{2^K}.
\]
More generally, if $A=2^{\sigma} v$ with $v$ odd and $\sigma\ge K$, then $A m \equiv 0 \pmod{2^K}$ for all $m$.
\end{lemma}

\begin{proof}
If $\sigma\ge K$ then $2^K \mid 2^{\sigma}$, hence $2^K\mid 2^{\sigma} m$ for all $m$.
The general case follows since $v$ is an integer.
\end{proof}


\begin{lemma}[Router digit from the target]
\label{lem:router-from-target}
Let $\delta\in\{1,5\}$ and let $x'$ be an integer with $x'\equiv \delta\pmod 6$.
Define
\[
F:=\frac{x'-\delta}{6}\in\mathbb Z.
\]
Then the router digit of $x'$ satisfies
\[
\left\lfloor\frac{x'}{6}\right\rfloor \equiv F \pmod 3.
\]
In particular, the router class $j'=\left\lfloor x'/6\right\rfloor\bmod 3$ is determined by $x'\bmod 18$ once $\delta$ is fixed.
\end{lemma}

\begin{proof}
Since $x'=6F+\delta$ with $0<\delta<6$, we have $\lfloor x'/6\rfloor = F$. Reducing modulo $3$ gives the claim.
\end{proof}




\begin{lemma}[2-adic Completeness]
\label{lem:linear-hensel}
Let $W$ be a fixed certified word, with affine evaluation
\[
x_W(m)=6\bigl(A_W m + B_W\bigr)+\delta_W,
\]
where $A_W,B_W\in\mathbb Z$ and $\delta_W\in\{1,5\}$ are fixed by $W$.
Fix an integer target $x_{\mathrm{tar}}$.

Assume that for every $K\ge K_0$ there exists an integer $m_K$ such that
\[
x_W(m_K)\equiv x_{\mathrm{tar}}\pmod{3\cdot 2^K}.
\]
Equivalently (after dividing by $6$ and using that the resulting right-hand side is
an integer in the application), there is a fixed integer $\mathrm{RHS}$ such that
\begin{equation}
\label{eq:AW-congruence}
A_W\, m_K \equiv \mathrm{RHS}\pmod{2^K}\qquad\text{for all }K\ge K_0.
\end{equation}
Let $\sigma:=v_2(A_W)$ and write $A_W=2^\sigma v$ with $v$ odd.

If the solutions are chosen compatibly, i.e.
\[
m_{K+1}\equiv m_K \pmod{2^{K-\sigma}}\qquad (K\ge \max\{K_0,\sigma+1\}),
\]
then $(m_K)_K$ is a Cauchy sequence in $\mathbb Z_2$ and converges to a unique
$m\in\mathbb Z_2$ satisfying $A_W m=\mathrm{RHS}$ in $\mathbb Z_2$, hence
$x_W(m)=x_{\mathrm{tar}}$ in $\mathbb Z_2$.

Moreover, if $u$ divides $\mathrm{RHS}/2^{\sigma}$ as an ordinary integer (in particular,
if $u=1$, i.e.\ $A_W$ is a power of two), then $m\in\mathbb Z$ and the equality is exact in
$\mathbb Z$: $x_W(m)=x_{\mathrm{tar}}$.
\end{lemma}

\begin{proof}
From \eqref{eq:AW-congruence} and $v_2(A_W)=\sigma$, it follows that for each $K>\sigma$ the
congruence class of $m_K$ is unique modulo $2^{K-\sigma}$: if $A_W m\equiv A_W m'\pmod{2^K}$,
then $2^\sigma v(m-m')\equiv 0\pmod{2^K}$ and since $v$ is odd (hence invertible modulo $2^{K-\sigma}$),
we get $m\equiv m'\pmod{2^{K-\sigma}}$.
Thus compatibility means precisely that each $m_{K+1}$ refines $m_K$ modulo $2^{K-\sigma}$,
so $(m_K)_K$ defines an element of the inverse limit $\varprojlim \mathbb Z/2^n\mathbb Z=\mathbb Z_2$.
Hence $(m_K)_K$ is Cauchy and converges to some $m\in\mathbb Z_2$.

Passing to the limit in \eqref{eq:AW-congruence} (multiplication by the fixed integer $A_W$
is continuous in the $2$-adic metric) yields $A_W m=\mathrm{RHS}$ in $\mathbb Z_2$.
Therefore $x_W(m)=x_{\mathrm{tar}}$ in $\mathbb Z_2$.

To obtain an ordinary integer, reduce \eqref{eq:AW-congruence} modulo $2^{\sigma}$.
Since $A_W m_K\equiv 0\pmod{2^\sigma}$ for every $K$, we obtain $\mathrm{RHS}\equiv 0\pmod{2^{\sigma}}$,
so $\mathrm{RHS}=2^{\sigma} r$ for some $r\in\mathbb Z$.
Then the $2$-adic equation becomes
\[
u\,m=r \qquad\text{in }\mathbb Z_2,
\]
which has the unique solution $m=u^{-1}r\in\mathbb Z_2$.
If in addition $u\mid r$ in $\mathbb Z$ (in particular if $u=1$), then $m=r/u\in\mathbb Z$,
and substituting back into $x_W(m)$ gives $x_W(m)=x_{\mathrm{tar}}$ as an equality of integers.
\end{proof}


\begin{lemma}[Power-of-two linear lifting yields an integer solution]
\label{lem:pow2-integer}
Let $\sigma\ge 0$ and let $\mathrm{RHS}\in\mathbb Z$. If there exists $m\in\mathbb Z_2$ such that
\[
2^{\sigma} m \equiv \mathrm{RHS}\pmod{2^K}\quad\text{for all }K>\sigma,
\]
then $v_2(\mathrm{RHS})\ge \sigma$ and $m=\mathrm{RHS}/2^{\sigma}\in\mathbb Z$.
\end{lemma}

\begin{proof}
Reducing the congruence modulo $2^{\sigma}$ gives $\mathrm{RHS}\equiv 0\pmod{2^{\sigma}}$, hence
$v_2(\mathrm{RHS})\ge \sigma$. In $\mathbb Z_2$, division by $2^[\sigma]$ is well-defined, so
$m=\mathrm{RHS}/2^{\sigma}$. Since $\mathrm{RHS}$ is an integer divisible by $2^{\sigma}$, the quotient
$\mathrm{RHS}/2^{\sigma}$ is an ordinary integer.
\end{proof}

\begin{lemma}[Finite hit from canonical representatives]
\label{lem:finite-hit}
Fix $x\in\mathbb N$. Choose $K$ so that $M_K=3\cdot 2^K > x$.
Assume the reachability procedure returns a certified witness $(W_K,m_K)$ such that
$x_{W_K}(m_K)\equiv x \pmod{M_K}$ and $0\le x_{W_K}(m_K) < M_K$.
Then $x_{W_K}(m_K)=x$.
\end{lemma}

\begin{proof}
Since $0\le x_{W_K}(m_K),x<M_K$ and $x_{W_K}(m_K)\equiv x\pmod{M_K}$, we must have
$x_{W_K}(m_K)=x$.
\end{proof}

\begin{lemma}[Finite hit in the quotient coordinate]
\label{lem:finite-hit-quotient}
Let $m\in\mathbb Z_{\ge 0}$ be fixed. Suppose that for each $K\ge 1$ there exists
an integer $m_K$ such that
\begin{enumerate}
\item $m_K \equiv m \pmod{2^K}$,
\item $0\le m_K < 2^K$ \quad (canonical representative modulo $2^K$).
\end{enumerate}
Then there exists a \emph{finite} $K_0$ such that for all $K\ge K_0$,
\[
m_K = m.
\]
In fact one may take
\[
K_0 \;=\; \min\{K\ge 1:\ 2^K>m\} \;=\; \left\lceil \log_2(m+1)\right\rceil .
\]
\end{lemma}

\begin{proof}
Choose $K_0$ such that $2^{K_0}>m$. For any $K\ge K_0$ we have $0\le m<2^K$, and by
assumption also $0\le m_K<2^K$. Since $m_K\equiv m\pmod{2^K}$ and both integers lie in
$[0,2^K)$, it follows that $m_K=m$.
\end{proof}

\begin{corollary}[Finite hit for $x$ once $(\delta_{6},j)$ are fixed]
\label{cor:finite-hit-x}
Let $x$ be an odd integer, and define
\[
\delta_{6} := x \bmod 6 \in \{1,5\},\qquad
j := \left\lfloor \frac{x}{6}\right\rfloor \bmod 3 \in \{0,1,2\},\qquad
m := \left\lfloor \frac{x}{18}\right\rfloor \in \mathbb Z_{\ge 0}.
\]
Suppose that for each $K\ge 1$ this construction produces an odd integer of the form
\[
x_K \;:=\; 18m_K + 6j + \delta_{6},
\]
where $(m_K)_{K\ge 1}$ satisfies the hypotheses of Lemma~\ref{lem:finite-hit-quotient}.
Then there exists a finite $K_0$ such that for all $K\ge K_0$,
\[
x_K = x.
\]
\end{corollary}

\begin{proof}
By Lemma~\ref{lem:finite-hit-quotient}, there is $K_0$ such that $m_K=m$ for all $K\ge K_0$.
Substituting into $x_K=18m_K+6j+\delta_{6}$ yields $x_K=18m+6j+\delta_{6}=x$ for all $K\ge K_0$.
\end{proof}

\begin{lemma}[Quotient congruence extraction]
\label{lem:quotient-congruence}
Let $x$ and $y$ be odd integers with the same
\[
\delta_{6} := x\bmod 6 = y\bmod 6 \in\{1,5\},
\qquad
j := \left\lfloor \frac{x}{6}\right\rfloor \bmod 3
= \left\lfloor \frac{y}{6}\right\rfloor \bmod 3 \in\{0,1,2\}.
\]
Write
\[
x = 18m + 6j + \delta_{6},\qquad y = 18m' + 6j + \delta_{6},
\]
with $m,m'\in\mathbb Z_{\ge 0}$. Then for every $K\ge 1$,
\[
y \equiv x \pmod{3\cdot 2^{K+1}}
\quad\Longrightarrow\quad
m' \equiv m \pmod{2^K}.
\]
\end{lemma}

\begin{proof}
If $y \equiv x \pmod{3\cdot 2^{K+1}}$, then $3\cdot 2^{K+1}$ divides $y-x=18(m'-m)$.
Dividing by $18=3\cdot 2\cdot 3$ gives $2^K \mid (m'-m)$, i.e.\ $m'\equiv m \pmod{2^K}$.
\end{proof}



\subsection{The Global Existence Theorem}
We can now state the final result of the constructive calculus. By combining the topological reachability of residues (Theorem~\ref{thm:reachability}) with the algebraic completeness of the 2-adic integers (Lemma~\ref{lem:linear-hensel}), we obtain a result for exact integers.

\begin{theorem}[Exact Reachability]
\label{thm:exact-reachability}
For every odd integer $x \ge 1$, there exists a finite certified word $W$
and an integer $m\in\mathbb Z_{\ge 0}$ such that
\[
x_W(m)=x.
\]
Consequently, the forward orbit of $x$ under the accelerated map $U$
traverses the path $W$ in reverse and terminates at $1$.
\end{theorem}

\begin{proof}
Fix an odd $x\ge 1$ and define
\[
\delta_{6} := x \bmod 6 \in \{1,5\},\qquad
j := \left\lfloor \frac{x}{6}\right\rfloor \bmod 3 \in \{0,1,2\},\qquad
m := \left\lfloor \frac{x}{18}\right\rfloor \in \mathbb Z_{\ge 0}.
\]
Choose $K_0$ such that $2^{K_0}>m$.

Apply Theorem~\ref{thm:reachability} at some precision $K\ge K_0+1$ together with
Lemma~\ref{lem:router-locking} to obtain a certified witness (word and input)
producing an odd integer $x_K$ such that
\[
x_K \equiv x \pmod{M_K},
\qquad
x_K \bmod 6 = \delta_{6},
\qquad
\left\lfloor \frac{x_K}{6}\right\rfloor \bmod 3 = j.
\]
Write
\[
x_K = 18m_K + 6j + \delta_{6}
\]
for the (necessarily integral) quotient $m_K\in\mathbb Z_{\ge 0}$.

Let $\sigma:=v_2(A_W)$ for the witness word $W$ producing $x_K$. By the canonical choice in
the terminal solve step (Lemma~\ref{lem:lifting}, Step~5), $m_K$ is determined modulo
$2^{K-\sigma}$ and we may choose it as the least nonnegative representative, so that
\[
0 \le m_K < 2^{K-\sigma}.
\]
Choose $K$ large enough so that $K-\sigma \ge K_0$ (equivalently $2^{K-\sigma}\ge 2^{K_0}$).
Then the congruence $x_K\equiv x\pmod{M_K}$ implies $x_K\equiv x\pmod{M_{K_0+1}}$, and
Lemma~\ref{lem:quotient-congruence} (with $y=x_K$ and $K-1=K_0$) yields
\[
m_K \equiv m \pmod{2^{K_0}}.
\]

Now replace $m_K$ by its reduction modulo $2^{K_0}$ (which does not change $x_K$ modulo
$M_{K_0+1}$ and preserves the router class): namely, set
\[
\widetilde m_K := m_K \bmod 2^{K_0},\qquad 0\le \widetilde m_K < 2^{K_0}.
\]
Then $\widetilde m_K \equiv m_K \equiv m \pmod{2^{K_0}}$, and since also $0\le m<2^{K_0}$
(by $2^{K_0}>m$), Lemma~\ref{lem:finite-hit-quotient} gives $\widetilde m_K=m$.
Substituting into $x_K=18\widetilde m_K+6j+\delta_{6}$ yields $x_K=18m+6j+\delta_{6}=x$.

Therefore the corresponding witness word $W$ and input $m$ satisfy $x_W(m)=x$ exactly.
Certification of $W$ implies the reverse traversal property, hence $U^{|W|}(x)=1$.
\end{proof}




\begin{corollary}[Exclusion of Disconnected Cycles]
\label{cor:no-disconnected-cycles}
Since every odd integer $x$ is the root of a finite inverse chain terminating at 1, no integer can belong to a disconnected cycle (a cycle that does not contain 1). Furthermore, no integer can belong to a divergent trajectory that does not eventually enter the tree of 1. The Collatz graph on the odd integers is therefore a single connected tree rooted at 1.
\end{corollary}

\begin{example}[Execution of Exact Reachability for $x=497$]
To target $x=497$, the algorithm constructs a certified program $W$.
\begin{itemize}
    \item \textbf{Targeting:} $497 \equiv 17 \pmod{24}$. We start with the base witness for 17.
    \item \textbf{Lifting:} We append steering tokens to satisfy the 2-adic linear constraints.
    \item \textbf{Resulting Program:} The certified path is $W = (\psi, \Omega, \Omega, \omega, \psi)$.
    \item \textbf{Instantiation:} The template equation $A_W m + B_W = (497-\delta)/6$ yields the unique integer solution $m=1$.
    \item \textbf{Verification:} $x_W(1) = 497$. The forward orbit traverses the path in reverse: $497 \to 373 \to 35 \to 53 \to 5 \to 1$.
\end{itemize}
\end{example}


% =============================================================================
% PART IV: ANALYSIS AND DYNAMICS
% Goal: Theoretical implications (Why it works).
% =============================================================================
\part{Analysis and Dynamics}


\section{Parameter Geometry}
\label{sec:param-geometry}

The row/lift primitives induce affine maps on the odd layer. We formalize a layered geometry: an \emph{analytic operator layer} where each step acts as an affine map over the rationals, and a \emph{discrete routing layer} that carries the residue constraints.

\subsection{Operator Projection and Coordinates}
\label{subsec:op-projection}

Let $\Theta=(\alpha,\beta,c,\delta,p,m;\varepsilon)$ be an admissible parameter tuple for a single odd step.
We define the derived constants:
\[
K \;:=\; (2^{\alpha+6p}-3)\,4^p, \qquad q_p \;:=\; \frac{4^p-1}{3}.
\]
The family-specific offsets are:
\[
B^{(1)} := 4q_p-\frac{K}{3}, \qquad B^{(5)} := 10q_p-2-\frac{5K}{3}.
\]
The induced single-step action on odd $x$ admits an \emph{exact} affine-plus-carry decomposition.
More precisely, for each admissible step parameter tuple $\Theta$ and each odd input $x$,
there exists an integer $\eta_\Theta(x)$ (the \emph{carry error}) such that
\[
T_\Theta(x) \;=\; A x + B_\varepsilon \;+\; \eta_\Theta(x),
\]
and $\eta_\Theta(x)$ is completely determined by the discrete routing data (equivalently, the
carry update). In particular, $|\eta_\Theta(x)|$ is uniformly bounded (independently of $x$)
for fixed admissible $\Theta$.

\begin{lemma}[Uniform carry bound]
\label{lem:uniform-carry-bound}
For any admissible step parameter tuple $\Theta$ and any odd input $x$, the carry error
$\eta_\Theta(x)$ satisfies $|\eta_\Theta(x)|\le \eta_{\max}(\Theta)$ for some constant
$\eta_{\max}(\Theta)$ depending only on $\Theta$ (not on $x$).
\end{lemma}

\begin{proof}
For fixed admissible $\Theta$, the routing rule partitions odd inputs into finitely many
cases determined by the router state (equivalently by $x\bmod N(\Theta)$ for some modulus
$N(\Theta)$ fixed by $\Theta$). In each case $\eta_\Theta(x)$ is a fixed integer.
Hence the image set $\{\eta_\Theta(x): x \text{ odd}\}$ is finite, so
$\eta_{\max}(\Theta):=\max\{|\eta_\Theta(x)|: x \text{ odd}\}$ exists and
$|\eta_\Theta(x)|\le \eta_{\max}(\Theta)$ for all odd $x$.
\end{proof}



\begin{definition}[Operator Projection]
\label{def:phi}
Let $\mathcal{P}$ be the set of admissible parameter tuples. We define the projection map $\Phi$ into the group of affine transformations over $\mathbb{Q}$:
\[
\Phi:\ \mathcal{P} \longrightarrow \mathrm{Aff}^+(\mathbb{Q}), \qquad \Theta \mapsto (A, B_\varepsilon),
\]
where $A = 1 + K/3$ and $B_\varepsilon$ is the offset for the entry family.
We introduce the \textbf{Operator Coordinates} $(u, v)$:
\[
u \;:=\; \log A \quad \text{(Gain)}, \qquad v \;:=\; \frac{B_\varepsilon}{A-1} \quad \text{(Geometric Fixed Point)}.
\]
\end{definition}

\begin{remark}[Semigroup Law]
\label{rem:uv-law-2}
In $(u, v)$ coordinates, the composition of two steps $(u_1, v_1)$ followed by $(u_2, v_2)$ obeys a semidirect product law:
\[
(u, v)_{\mathrm{net}} \;=\; (u_1 + u_2, \ v_2 + e^{-u_2} v_1).
\]
Thus, gain is additive, while the fixed points transport linearly.
\end{remark}

\subsection{The Arithmetic Fiber (Vertical Clustering)}
The geometry reveals a striking structural invariant of the Collatz map.

\begin{lemma}[Vertical Fibers]
\label{lem:continuity-clusters}
For a fixed machine setting $(\alpha, p)$, the gain $u$ is constant. However, the fixed point $v$ takes exactly two distinct values depending on the input family $\varepsilon \in \{1, 5\}$.
Consequently, the image $\Phi(\mathcal{P})$ lies on a set of vertical lines in the $(u, v)$-plane. Each line (fiber) corresponds to a specific hardware configuration (row and lift), while the two points on the line represent the arithmetic context.
\end{lemma}


\subsection{Operator Metrics and Bounds}
To quantify the stability of the map, we define a metric on the operator space.

\begin{definition}[Operator Metric]
For two affine maps $T(x)=Ax+B$ and $S(x)=A'x+B'$, the distance over a bounded interval $[1, X]$ is:
\[
d_X(T, S) \;:=\; \sup_{x \in [1, X]} |T(x) - S(x)| \;\le\; |A-A'|X + |B-B'|.
\]
\end{definition}

\begin{lemma}[Sensitivity]
If two steps share the same parameters $(\alpha, p)$, then $A=A'$ and the distance is determined solely by the family offset $|B-B'|$. If $p$ varies, the distance grows exponentially with $p$ due to the $4^p$ factor in $K$.
\end{lemma}


\section{Dynamical Implications}
\label{sec:dynamics}

While the preceding sections established the \emph{reachability} of residue classes (constructive existence), the geometric parameters \((u,v)\) and the CRT tag calculus provide powerful tools for analyzing the \emph{global dynamics} of the odd layer. Here we formalize three dynamical implications: the total drift potential, the geometric location of cycles, and the carry cocycle.

\subsection{Total Drift Potential and Descent Criteria}
Recall from Section~\ref{sec:row-correctness} that the CRT tag \(t(x) = (x-1)/2\) acts as a linear potential. For a single step \(x \xrightarrow{U} x'\), the drift is \(d = rK + \Delta_\varepsilon\). We extend this to an arbitrary word \(W\).

\begin{definition}[Total Drift]
Let \(W\) be an admissible word of length \(n\). The \emph{total drift} \(\mathcal{D}_W(x)\) is the change in tag value along the trajectory:
\[
\mathcal{D}_W(x) \;:=\; t(x_n) - t(x_0) \;=\; \sum_{k=0}^{n-1} \left( r_k K_k + \Delta_{\varepsilon_k} \right).
\]
\end{definition}

\begin{remark}[Descent criterion]
\label{rem:drift-descent}
The identity
\[
\mathcal{D}_W(x) \;=\; \sum_{k=0}^{n-1}\bigl(r_k K_k + \Delta_{\varepsilon_k}\bigr)
\]
is \emph{exact}. In particular, if $\mathcal{D}_W(x)<0$ then $t(x_n)<t(x_0)$, hence $x_n<x_0$.
Thus negative total drift is a rigorous descent certificate.

A sufficient condition may be stated using bounds on the coarse indices: if one has
$0\le r_k \le R$ along the word, then
\[
\sum_{k=0}^{n-1}\bigl(R K_k + \Delta_{\varepsilon_k}\bigr) < 0
\quad\Longrightarrow\quad
\mathcal{D}_W(x)<0.
\]
\end{remark}


\subsection{Geometric Center of Repulsion}
In Section~\ref{sec:param-geometry}, we defined the operator fixed point \(v = B/(A-1)\). This quantity constrains the location of any integer cycles.

Consider a hypothetical cycle of period $n$ corresponding to the word $W$.
Rather than treating the inverse map as purely affine, we use the exact
affine-plus-carry decomposition along $W$:
\[
x_{k+1} \;=\; A_k x_k + B_k + \eta_k,\qquad \eta_k\in\mathbb Z,
\]
where $(A_k,B_k)$ are the operator-layer parameters of the $k$th step and $\eta_k$
is the associated carry error.
(cf.\ the affine-plus-carry decomposition in Section~\ref{sec:param-geometry})
Composing these relations yields
\[
x_n \;=\; A_W x_0 + B_W + \sum_{k=0}^{n-1}\eta_k\prod_{\ell=k+1}^{n-1}A_\ell,
\]
where $A_W=\prod_{k=0}^{n-1}A_k$ and $B_W$ is the usual affine word offset.
If the trajectory is a cycle ($x_n=x_0$), then
\[
(A_W-1)x_0 \;=\; -B_W - \sum_{k=0}^{n-1}\eta_k\prod_{\ell=k+1}^{n-1}A_\ell.
\]
Thus the operator-layer fixed point
\[
-v_W \;:=\; -\frac{B_W}{A_W-1}
\]
is the center of the affine skeleton, and the true cycle point $x_0$ differs from $-v_W$
by an explicit carry-controlled amount. In particular, Theorem~\ref{thm:cycle-location-explicit}
gives the bound
\[
\left|x_0-(-v_W)\right| \;\le\; \frac{E_W}{A_W-1}.
\]

\begin{theorem}[Cycle Location Bound with explicit carry error]
\label{thm:cycle-location-explicit}
Let $W$ be an admissible word of length $n$. Write the true stepwise dynamics along $W$ as
\[
x_{k+1} \;=\; A_k x_k + B_k + \eta_k,
\qquad k=0,\dots,n-1,
\]
where each $\eta_k\in\mathbb Z$ is the carry error of the $k$th step (as in the affine-plus-carry
decomposition), and let
\[
A_W := \prod_{k=0}^{n-1} A_k,\qquad
B_W := \text{(the usual affine word offset)},\qquad
v_W := \frac{B_W}{A_W-1}.
\]
Define the accumulated carry error
\[
E_W \;:=\; \sum_{k=0}^{n-1} \left|\eta_k\right|\cdot \prod_{\ell=k+1}^{n-1} A_\ell.
\]
If an odd integer $x$ belongs to a non-trivial cycle whose inverse itinerary is $W$
(i.e.\ $x_n=x_0=x$), then
\[
\left| x - (-v_W) \right|
\;\le\;
\frac{E_W}{A_W-1}.
\]
In particular, if $|\eta_k|\le \eta_{\max}$ for all $k$, then
\[
\left| x - (-v_W) \right|
\;\le\;
\frac{\eta_{\max}}{A_W-1}\sum_{k=0}^{n-1}\prod_{\ell=k+1}^{n-1} A_\ell.
\]
\end{theorem}

\begin{proof}
Compose the step relations to obtain
\[
x_n \;=\; A_W x_0 + B_W + \sum_{k=0}^{n-1}\eta_k\prod_{\ell=k+1}^{n-1}A_\ell.
\]
For a cycle $x_n=x_0$, rearrange to
\[
(A_W-1)x_0 \;=\; -B_W - \sum_{k=0}^{n-1}\eta_k\prod_{\ell=k+1}^{n-1}A_\ell.
\]
Subtract $-v_W=-B_W/(A_W-1)$ and bound the remainder by $E_W/(A_W-1)$.
\end{proof}


\begin{remark}[The Geometric Trap]
Since we have proven \(A_W > 1\) (expansivity of the inverse) for all words \(W\) (except the singular \(p=0\) identity cases), the fixed point \(-v_W\) acts as a \emph{center of repulsion} for the inverse map. Conversely, for the forward map \(U\), it acts as a pseudo-attractor.
This result provides a \textbf{Geometric Bounding Box}: if a counter-example (cycle) exists for a specific word \(W\), the integers in that cycle cannot be distributed arbitrarily; they must be clustered near the rational number \(-v_W\).
\end{remark}

\subsection{The Carry Cocycle}
The transition from the continuous geometry \((u,v)\) to the discrete integer dynamics is mediated entirely by the \emph{carry}. Recall that the coarse index evolves as:
\[
r' \;=\; r + c(r, \varepsilon), \qquad \text{where } c(r, \varepsilon) = \left\lfloor \frac{\varepsilon + 2(rK + \Delta_\varepsilon)}{6} \right\rfloor.
\]
We define the \emph{carry sequence} of a trajectory \(x_0 \xrightarrow{W} x_n\) as the sequence of integers \(\gamma = (c_1, c_2, \dots, c_n)\).

\begin{proposition}[Carry cocycle captures the nonlinearity]
\label{prop:carry-cocycle}
Fix an admissible word $W$ (or equivalently its step parameters). Along any trajectory
$x_0 \xrightarrow{} x_1 \xrightarrow{} \cdots \xrightarrow{} x_n$ realizing $W$ in reverse,
the deviation from the operator-layer affine model is entirely carried by the integer
carry errors $\eta_k$:
\[
x_{k+1} \;=\; A_k x_k + B_k + \eta_k,\qquad \eta_k\in\mathbb Z.
\]
Consequently, given the initial value $x_0$ and the carry sequence $(\eta_0,\dots,\eta_{n-1})$,
the entire trajectory $(x_k)_{k=0}^n$ is determined uniquely; conversely the carry sequence is a
deterministic function of the trajectory. In this sense, the carry cocycle is the complete
source of nonlinearity beyond the affine operator projection.
\end{proposition}



\subsection{Visualization and usage}\label{subsec:viz-usage}
A practical picture is the $(\alpha,p)$ grid colored by $u=\log A$ (gain), with two dots per cell at the corresponding $v$ (families).
Routing problems become: \emph{pick a dot in a cell} (choose $\varepsilon$) and \emph{pick a cell} (choose $(\alpha,p)$) to meet a congruence (Lemma~\ref{lem:last-row-p}) and a drift band (Cor.~\ref{cor:drift-bounds}).

\paragraph{Layered workflow.}
(i) Project to $(u,v)$ for composition, bounds, and optimization;
(ii) check the discrete fiber for residue targeting and admissibility;
(iii) assemble $n$ steps via the semidirect sum in $(u,v)$ (Remark~\ref{rem:uv-law-2}) or the affine closure (Lem.~\ref{lem:affine-word}).

\begin{algorithm}
\caption{Generate operator portrait $(u,v)$ over $(\alpha,p)$}\label{alg:param-portrait}
\begin{algorithmic}[1]
  \Require integer ranges $\mathcal{A}$ for $\alpha$, $\mathcal{P}$ for $p$
  \Ensure grid of gains $u=\log A$ and fixed-points $v=B/(A-1)$ for families $\varepsilon\in\{1,5\}$
  \For{$p \in \mathcal{P}$}
    \State $q_p \gets (4^p - 1)/3$
    \For{$\alpha \in \mathcal{A}$}
      \State $K \gets (2^{\alpha+6p} - 3)\,4^p$; \quad $A \gets 1 + K/3$  \Comment{$A>0$ for all admissible $(\alpha,p)$}
      \State $B^{(1)} \gets 4q_p - K/3$;\quad $B^{(5)} \gets 10q_p - 2 - 5K/3$
      \State $u \gets \log A$;\quad $v_1 \gets B^{(1)}/(A-1)$;\quad $v_5 \gets B^{(5)}/(A-1)$
      \State record $(\alpha,p,u,v_1,v_5)$
    \EndFor
  \EndFor
\end{algorithmic}
\end{algorithm}


%\begin{figure}[t]
%\centering
%\includegraphics[width=0.95\linewidth]{param_geometry.png}
%\caption{Operator-layer portrait of the parameter space.
%Heatmap shows $u=\log A$ over the $(\alpha,p)$ grid; in each cell, two markers indicate the two families $\varepsilon\in\{1,5\}$ (circles for $\varepsilon=1$, squares for $\varepsilon=5$), which differ in their fixed-point $v = B/(A-1)$.}
%\label{fig:param-geometry-1}
%\end{figure}
\begin{figure}[H]
  \centering
  % \includegraphics{param_geometry.png}
  \fbox{\includegraphics[width=0.9\linewidth]{figure_operator_geometry.png}}
  \fbox{\parbox{0.9\linewidth}{\centering
  Schematic: gain $u=\log A$ over $(\alpha,p)$; for each cell, two fixed-point values $v$ (families $\varepsilon\in\{1,5\}$).
  }}
  \caption{Operator-layer portrait of the parameter space. Each $(\alpha,p)$ yields a gain $u$ and two fixed points $v$.}
  \label{fig:operator_geometry}
\end{figure}

\begin{figure}[H]
  \centering
  \fbox{\includegraphics[width=0.9\linewidth]{figure_fixedpoint_scatter.png}}
  %\fbox{\parbox{0.9\linewidth}{\centering TODO: Fixed-point scatter $v=B/(A-1)$ for \(\varepsilon=1,5\) over \((\alpha,p)\)}}
  \caption{Fixed points $v$ per family over the $(\alpha,p)$ grid.}
  \label{fig:fixedpoint-scatter}
\end{figure}

\begin{figure}[H]
  \centering
  \fbox{\includegraphics[width=0.9\linewidth]{figure_drift_heatmap.png}}
  %\fbox{\parbox{0.9\linewidth}{\centering TODO: Drift heatmap \(|x'-x|\) over $(r,p)$, panels for \(\alpha\) and families}}
  \caption{Drift magnitude across $(r,p)$ for selected $\alpha$ (e vs o).}
  \label{fig:drift-heatmap}
\end{figure}

\begin{figure}[H]
  \centering
  \fbox{\includegraphics[width=0.9\linewidth]{figure_operator_distance.png}}
  %\fbox{\parbox{0.9\linewidth}{\centering TODO: Operator distance contours $d_X$ over $(\alpha,p)$}}
  \caption{Operator proximity $d_X$ across $(\alpha,p)$ bands.}
  \label{fig:operator-distance}
\end{figure}

\begin{figure}[H]
  \centering
  \fbox{\includegraphics[width=0.9\linewidth]{figure_admissibility_mask.png}}
  %\fbox{\parbox{0.9\linewidth}{\centering TODO: Admissibility mask for $(\alpha,p)$ induced by $(\beta,c,\delta,m)$}}
  \caption{Admissible vs. forbidden parameter cells.}
  \label{fig:admissibility-mask}
\end{figure}

\begin{figure}[H]
  \centering
  \fbox{\includegraphics[width=0.9\linewidth]{figure_carry_diagram.png}}
  %\fbox{\parbox{0.9\linewidth}{\centering TODO: Carry diagram for $c=\lfloor(\varepsilon+2d)/6\rfloor$}}
  \caption{Carry cases driving $(r,\varepsilon)\mapsto(r',\varepsilon')$.}
  \label{fig:carry-diagram}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{drift_plot.png}
    \caption{\textbf{The Drift Equation in Action.} The scatter plot shows the step-wise drift \(d = t(x_{n+1}) - t(x_n)\) versus the coarse index \(r = \lfloor x_n/6 \rfloor\) for the witness trajectory of \(x=3071\) (the inverse orbit from \(1 \to 3071\)). The dashed lines represent the theoretical drift equations \(d = rK + \Delta_\varepsilon\) for key tokens. The exact alignment of the integer trajectory points with these lines confirms that the dynamics are strictly linear in tag-space.}
    \label{fig:drift_plot}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{operator_geometry_v2.png}
    \caption{\textbf{Operator Geometry and Vertical Fibers.} We project the admissible tokens into the continuous \((u,v)\) operator space, where \(u=\ln(A)\) is the logarithmic gain and \(v = B/(A-1)\) is the geometric fixed point. The plot reveals the ``Vertical Fiber'' structure predicted by Lemma~\ref{lem:continuity-clusters}: tokens with the same hardware parameters \((\alpha, p)\) share the same gain \(u\) (same vertical line) but split into two distinct fixed points based on the input family (blue vs.\ red).}
    \label{fig:operator_geometry-v2}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.6\linewidth]{geometric_trap.png}
    \caption{\textbf{The Geometric Trap.} A visualization of the inverse map for the token \(\Psi_0\) (at \(p=0\)), which corresponds to the trivial cycle \(1 \to 1\). The fixed point is at \(x=1\). Since the slope \(A = 4/3 > 1\), the map is expansive. The green arrows illustrate the vector field \(x \mapsto f(x) - x\), showing that any trajectory starting near \(1\) (but not exactly at \(1\)) is repelled away from the fixed point. This geometric repulsion prevents the existence of stable cycles in the inverse map.}
    \label{fig:geometric_trap}
\end{figure}

\newpage

\subsection{Examples of Dynamical Quantities}

\begin{example}[The Center of Repulsion for the \(1\to 1\) cycle]
Consider the trivial cycle \(1 \xrightarrow{U} 1\). The inverse word is \(W=\Psi_0\) (at \(p=0\)).
\begin{itemize}
    \item \textbf{Affine Slope:} \(K = (2^2-3)4^0 = 1\). Thus \(A = 1 + 1/3 = 4/3\).
    \item \textbf{Affine Intercept:} Since \(x' \approx Ax + B\) and \(1 \to 1\), we solve \(1 = (4/3)(1) + B \implies B = -1/3\).
    \item \textbf{Fixed Point:} \(-v_W = - \frac{B}{A-1} = - \frac{-1/3}{4/3 - 1} = - \frac{-1/3}{1/3} = 1\).
\end{itemize}
The geometric fixed point is exactly \(1\). The cycle lies precisely on the center of repulsion.
\end{example}

\begin{example}[A Non-Trivial Carry Sequence: \(209 \to 185\)]
Consider the path \(209 \xrightarrow{\omega_1} 139 \xrightarrow{\psi_2} 185\).
\begin{itemize}
    \item \textbf{Step 1:} \(x=209\) (\(r=34\)). \(\omega_1\) has \(K=-1\).
    Drift \(d_1 \approx rK = -34\).
    Carry \(c_1 = \lfloor \frac{5 + 2(-35)}{6} \rfloor = -11\).
    \item \textbf{Step 2:} \(x=139\) (\(r=23\)). \(\psi_2\) has \(K=1\).
    Drift \(d_2 \approx rK = 23\).
    Carry \(c_2 = \lfloor \frac{1 + 2(23)}{6} \rfloor = 7\).
\end{itemize}
The sequence \(\gamma = (-11, 7)\) characterizes the "turbulence" of this trajectory.
\end{example}

% =========================================================================
% NEW PART V: GLOBAL NETWORK TOPOLOGY
% =========================================================================

\part{Global Network Topology}
\label{part:network-topology}

While the operator geometry (Part IV) analyzes the map as an affine transformation over $\mathbb{Q}$, the discrete modular constraints form a rigid topological network. In this part, we analyze the inverse map as a directed graph modulo 9, establishing that the system is strongly connected, ergodic, and possesses a unique topological mechanism for geometric contraction.

\section{The Modulo-9 Partition}

Recall the CRT tag $t = (x-1)/2$ and the internal index $m = \lfloor t/9 \rfloor$. The parameter selection is strictly determined by the residue $\rho = t \bmod 9$. Although there are 12 parameter families, they partition into 6 active equivalence classes based on $\rho$, alongside 3 forbidden classes.

\begin{lemma}[The Ghost Residues]
The residues $\rho \in \{1, 4, 7\}$ correspond to integers $x$ divisible by 3. Since $\text{Im}(U) \cap 3\mathbb{Z} = \emptyset$, these nodes are topologically unreachable in the inverse graph.
\end{lemma}

The remaining six residues form the state space $S = \{0, 2, 3, 5, 6, 8\}$. We classify them by their router index $j = \lfloor \rho/3 \rfloor$:
\begin{itemize}
    \item \textbf{Base ($j=0$):} $\rho=0$ (Attractor), $\rho=2$ (Distributor).
    \item \textbf{Middle ($j=1$):} $\rho=3$ (Twin of 0), $\rho=5$ (Odd Heart).
    \item \textbf{High ($j=2$):} $\rho=6$ (Transit), $\rho=8$ (Recycler).
\end{itemize}

\section{The State Transition Network}

The inverse operations ``Stay'' (preserving parity) and ``Switch'' (toggling parity) induce a deterministic transition map on $S$. The adjacency structure is given by $f: S \times \{\text{Stay, Switch}\} \to S$.

\begin{table}[H]
\centering
\caption{State Transition Table (Input $\to$ Output)}
\label{tab:transitions}
\begin{tabular}{@{}c c | c c@{}}
\toprule
Input Node & Family & \textbf{Op A (Stay)} $\to$ & \textbf{Op B (Switch)} $\to$ \\
\midrule
\textbf{0} & e & 0 & 2 \\
\textbf{3} & e & 0 & 2 \\
\textbf{6} & e & 3 & 8 \\
\midrule
\textbf{2} & o & 8 & 6 \\
\textbf{5} & o & 5 & 3 \\
\textbf{8} & o & 5 & 0 \\
\bottomrule
\end{tabular}
\end{table}

\begin{figure}[H]
\begin{tikzpicture}[->, >=stealth, shorten >=1pt, auto, node distance=2.8cm, semithick]
    \tikzstyle{every state}=[fill=white, draw=black, text=black]

    % --- NODES (Hexagonal Layout) ---
    % Arranged counter-clockwise starting from top
    \node[state] (0) at (90:3) {0};   % Top
    \node[state] (3) at (150:3) {3};  % Top-Left
    \node[state] (6) at (210:3) {6};  % Bottom-Left
    \node[state] (5) at (270:3) {5};  % Bottom
    \node[state] (8) at (330:3) {8};  % Bottom-Right
    \node[state] (2) at (30:3) {2};   % Top-Right

    % --- EDGES ---
    % From 0 (The Even Attractor)
    \path (0) edge [loop above] node {A} (0)
          (0) edge node {B} (2);

    % From 3 (The 0-Twin)
    \path (3) edge node {A} (0)
          (3) edge [bend left=20] node [near start] {B} (2);

    % From 2 (The Distributor)
    \path (2) edge node {A} (8)
          (2) edge [bend right=20] node [above, sloped] {B} (6);

    % From 6 (The Transit)
    \path (6) edge node {A} (3)
          (6) edge [bend right=20] node [below, sloped] {B} (8);

    % From 8 (The Recycler)
    \path (8) edge node {A} (5)
          (8) edge [bend right=15] node [right] {B} (0);

    % From 5 (The Odd Attractor)
    \path (5) edge [loop below] node {A} (5)
          (5) edge [bend left=20] node {B} (3);

\end{tikzpicture}
\caption{The State Transition Diagram of the Inverse Map Modulo 9. The graph is strongly connected and aperiodic, implying global mixing.}
\label{fig:network}
\end{figure}


\begin{theorem}[Global Connectivity]
\label{thm:connectivity}
The state transition graph is strongly connected and aperiodic. Consequently, the inverse map is ergodic: the preimage tree of any residue class $\rho \in S$ eventually covers all other active residue classes.
\end{theorem}

\subsection{The Topological Metric}

The strong connectivity of the graph allows us to define a metric on the residue families. We define the \textbf{Collatz Distance} $d(u, v)$ as the length of the shortest path from node $u$ to node $v$ in the state transition graph.

\begin{definition}[Geodesic Distance]
For any two residue families $\rho_1, \rho_2 \in S$, the distance $d(\rho_1, \rho_2)$ is the minimum number of inverse steps required to transform a number of type $\rho_1$ into a number of type $\rho_2$.
\end{definition}

This metric reveals the ``arithmetic stiffness'' of the network. For instance, while Node 0 (Pure Evens) and Node 2 (Base Odds) are adjacent ($d(0,2)=1$), reaching the ``Odd Heart'' at Node 5 from Node 0 requires traversing a path of length 3 ($0 \to 2 \to 8 \to 5$).

\begin{proposition}[Minimum Cycle Constraints]
The metric imposes lower bounds on the length of any non-trivial cycle passing through a specific family. The \textbf{Recurrence Time} $T(\rho) = d(\rho, \rho)$ is the length of the shortest cycle containing $\rho$.
\begin{itemize}
    \item For $\rho=0$ and $\rho=5$, $T(\rho)=1$ (Self-loops).
    \item For $\rho=6$ (High Evens), the shortest return path is $6 \to 3 \to 0 \to 2 \to 6$, implying $T(6)=4$.
\end{itemize}
Consequently, no integer $x \equiv 13 \pmod{18}$ (Type 6) can belong to a Collatz cycle of length less than 4.
\end{proposition}

\subsection{The Generation Metric (Layer Depth)}

In addition to the topological distance between families, we define the \textbf{Inverse Depth} (or Generation) of a specific integer $x$. Let $L_0 = \{1\}$. We define the layers recursively:
\[
L_{k+1} \;=\; \{ x \in 2\mathbb{Z}+1 : U(x) \in L_k \} \setminus \bigcup_{i=0}^k L_i.
\]
The metric $\delta(x) = k$ assigns each integer to its generation layer, representing the exact number of accelerated steps required to reach 1.

\begin{example}[The First Generations]
\begin{itemize}
    \item $\mathbf{L_0}$: $\{1\}$
    \item $\mathbf{L_1}$: $\{5, 85, 341, 5461, \dots\}$ (The direct children of 1).
    \item $\mathbf{L_2}$: Includes $\{7\}$ (preimage of 5), $\{113\}$ (preimage of 85 via $\Psi_0$), etc.
\end{itemize}
Unlike the standard Collatz tree where nodes have finite degree, the column-lift $p$ implies that every set $L_k$ (for $k \ge 1$) is infinite. This metric $\delta(x)$ corresponds precisely to the \textbf{Total Stopping Time} of $x$ under the accelerated map.
\end{example}

\subsubsection{The Generational Bottleneck and Divergence}

By combining the topological coordinate $\rho$ with the generation depth $\delta$, we can visualize the ``skeleton'' of the inverse tree. At the base energy level ($p=0$), the network topology imposes a strict bottleneck on the first few generations of any orbit.

As illustrated in Figure~\ref{fig:inverse-tree}, the root node (Generation 0) has only one non-trivial child at $p=0$: the integer 5 (Node 2). This creates a universal \textbf{Bottleneck} at Generation 1. Every non-trivial inverse orbit (at minimal energy) must transit through the ``Distributor'' family ($\rho=2$) before accessing the rest of the network.

The true dynamical divergence occurs at Generation 2, where the path splits into two distinct structural lineages:
\begin{itemize}
    \item \textbf{The Transit Branch ($\rho=6$):} Leading to $13$ (and eventually 7). This branch is characterized by high expansion ($\alpha \ge 4$) and topological distance from the center.
    \item \textbf{The Recycler Branch ($\rho=8$):} Leading to $53$ (and eventually 23). This branch connects immediately to the Odd Heart ($\rho=5$), often creating localized loops or ``laminar'' flows that avoid the high-expansion outer rim.
\end{itemize}

\begin{figure}[H]
\centering
\begin{tikzpicture}[
    >=stealth,
    node distance=1.5cm and 2cm,
    every node/.style={draw, circle, inner sep=2pt, minimum width=1.2cm, align=center},
    edge label/.style={draw=none, rectangle, fill=white, inner sep=1pt, font=\scriptsize},
    layer label/.style={draw=none, rectangle, font=\bfseries\small}
]

    % --- GENERATION LABELS (Top) ---
    \node[layer label] (L0) at (0, 1) {Gen 0 ($L_0$)};
    \node[layer label] (L1) at (3, 1) {Gen 1 ($L_1$)};
    \node[layer label] (L2) at (6, 1) {Gen 2 ($L_2$)};
    \node[layer label] (L3) at (9, 1) {Gen 3 ($L_3$)};

    % --- NODES (Collatz Coordinate: rho, x) ---

    % Root
    \node[fill=gray!10] (1) at (0, -1) {$\rho=\mathbf{0}$\\$x=1$};

    % L1: The Bottleneck
    \node[fill=blue!10] (5) at (3, -1) {$\rho=\mathbf{2}$\\$x=5$};

    % L2: The Split
    \node[fill=red!10] (13) at (6, 0) {$\rho=\mathbf{6}$\\$x=13$};  % Top Branch (Transit)
    \node[fill=green!10] (53) at (6, -2) {$\rho=\mathbf{8}$\\$x=53$}; % Bottom Branch (Recycler)

    % L3: The Consequences
    \node[fill=red!10] (17) at (9, 0) {$\rho=\mathbf{8}$\\$x=17$}; % From 13
    \node[fill=green!10] (35) at (9, -2) {$\rho=\mathbf{8}$\\$x=35$}; % From 53

    % --- EDGES ---
    % 1 -> 5 (Switch B)
    \draw[->, thick] (1) -- node[edge label] {$\psi_0$ (Switch)} (5);

    % 5 -> 13 (Switch B) - The "Turbulent" Path
    \draw[->, thick] (5) -- node[edge label, pos=0.6] {$\omega_1$ (Switch)} (13);

    % 5 -> 53 (Stay A) - The "Recycler" Path
    \draw[->, thick] (5) -- node[edge label, pos=0.6] {$\Omega_0$ (Stay)} (53);

    % 13 -> 17 (Switch B)
    \draw[->, thick] (13) -- node[edge label] {$\psi_0$} (17);

    % 53 -> 35 (Stay A)
    \draw[->, thick] (53) -- node[edge label] {$\Omega_1$} (35);

    % --- ANNOTATIONS ---
    \node[draw=none, right=0.2cm of 13, font=\scriptsize, align=left] {$\to$ Target 7\\(Tour)};
    \node[draw=none, right=0.2cm of 35, font=\scriptsize, align=left] {$\to$ Target 23\\(Loop)};

\end{tikzpicture}
\caption{The Inverse Generational Tree. All non-trivial orbits must exit the root via the $0 \to 2$ bottleneck ($1 \to 5$) before diverging at Generation 2 into the ``Transit'' branch ($\rho=6$) or the ``Recycler'' branch ($\rho=8$).}
\label{fig:inverse-tree}
\end{figure}


\subsection{The Associated Symbolic Space and Semigroup Dynamics}

We can formalize the dynamics of the network by defining the algebraic structure of the transitions. The unified parameter table defines a set of operators $\mathcal{F} = \{ \Psi_0, \psi_0, \Omega_2, \omega_1, \dots \}$ acting on $\mathbb{Z}$.

\begin{remark}[The Collatz Automaton]
The system formed by the state transition graph $G$ and the operator set $\mathcal{F}$ constitutes a \textbf{Finite State Automaton} (FSA). The valid trajectories through the network form the \textbf{Regular Language} accepted by this automaton. Since the composition of affine operations is associative but non-commutative, the set of all admissible finite compositions forms a \textbf{Semigroup} generated by $\mathcal{F}$, constrained by the topology of $G$.
\end{remark}

We define the \textbf{Collatz Path Space} $\Sigma_G$ as the subshift of finite type associated with this automaton:
\[
\Sigma_G = \{ (\rho_i)_{i \in \mathbb{N}} \in V^{\mathbb{N}} : A_{\rho_i, \rho_{i+1}} = 1 \text{ for all } i \}.
\]
In this space, a ``point'' is an infinite admissible sequence of residue families. The Collatz map acts as the \textbf{Shift Operator} $\sigma: \Sigma_G \to \Sigma_G$.

\begin{example}[Execution of a Symbolic Program]
Consider the generation of the witness for $x=23$ (Target 23). We view this as the execution of a specific instruction sequence on the Collatz Automaton.
\begin{enumerate}
    \item \textbf{The Program (Input Code):} The path $W = (\psi_0, \Omega_0, \Omega_0, \Omega_1)$ corresponds to \texttt{Switch} $\to$ \texttt{Stay} $\to$ \texttt{Stay} $\to$ \texttt{Stay}.
    \item \textbf{The Template (Compilation):} The automaton composes the affine forms to produce the congruence family $x(m) = 72m + 23$.
    \item \textbf{The Execution (Instantiation):} Inputting the seed $m=0$ yields the integer $23$.
\end{enumerate}
\end{example}

\begin{example}[Execution of a Symbolic Program (Polymorphism)]
Consider the symbolic instruction sequence $W = (\texttt{Switch}, \texttt{Stay}, \texttt{Stay})$. This sequence is universally executable from any node in the network, but the resulting affine template depends on the topological start state.

\begin{itemize}
    \item \textbf{Context A (Start Node 0):}
    The path is $0 \xrightarrow{\psi} 2 \xrightarrow{\Omega} 8 \xrightarrow{\Omega} 8$.
    The automaton compiles this into the congruence family:
    \[ x(m) = 72m + 23 \]
    For seed $m=0$, this yields the integer $23$.

    \item \textbf{Context B (Start Node 6):}
    The path is $6 \xrightarrow{\psi} 8 \xrightarrow{\Omega} 5 \xrightarrow{\Omega} 5$.
    The automaton compiles this into a different congruence family:
    \[ x(m) = 18m + 13 \]
    For seed $m=0$, this yields the integer $13$.
\end{itemize}
Thus, a single symbolic program acts as a polymorphic function, generating a family of different arithmetic templates depending on the topological context of the input.
\end{example}

\begin{remark}[Topological Entropy and Growth]
The presence of multiple cycles (e.g., $2 \to 8 \to 5 \to 2$) and branching points (Nodes 2 and 5) implies that the number of admissible paths of length $k$ grows exponentially with $k$. In dynamical systems terms, the network possesses \textbf{Positive Topological Entropy}. This exponential proliferation of valid congruence templates explains why the inverse Collatz map rapidly generates witnesses for every residue class.
\end{remark}

While the symbolic space $\Sigma_G$ describes all \emph{possible} orbital histories, it treats every edge as equally distinct. However, the arithmetic cost of traversing these edges varies—some require large $p$-lifts (rare) while others are frequent. In Part VI, we overlay a probabilistic measure onto this topological space to determine which trajectories are physically dominant.


% =========================================================================
% PART VI: PROBABILISTIC DYNAMICS
% =========================================================================

\newpage
\part{Probabilistic Dynamics and Orbital Entropy}
\label{part:probability}

\textit{In Part V, we established the topological structure of the Collatz network and defined the space of all admissible orbits as a subshift of finite type. However, while the network topology permits infinite complexity, not all paths are equally likely. In this part, we overlay a probabilistic measure onto the topological skeleton, analyzing the inverse map as a stochastic process to determine the density of orbits and the expected behavior of large integers.}

\section{Stochastic Formulation of the Inverse Map}

We model the inverse dynamics as a discrete-time Markov chain on the state space $S = \{0, 2, 3, 5, 6, 8\}$. Since the forward map is deterministic, the inverse map is inherently branching.

\begin{assumption}[Unbiased Branching]
We assume a maximum-entropy driver where, at any branching node (Family $\mathrm{o}$ at Node 2, or Family $\mathrm{e}$ at Node 0), the inverse trajectory chooses the operation ``Switch'' ($\mathcal{O}_B$) or ``Stay'' ($\mathcal{O}_A$) with equal probability $p=0.5$.
\end{assumption}

This induces a column-stochastic transition matrix $P$, where $P_{ij} = \mathbb{P}(\text{Node } i \to \text{Node } j)$. For non-branching nodes, the transition probability to the unique parent is 1.

\section{The Stationary Measure}

Since the graph is strongly connected and aperiodic (Theorem~\ref{thm:connectivity}), the Markov chain possesses a unique stationary distribution vector $\pi$ satisfying $P \pi = \pi$. Solving the linear system yields the asymptotic frequency of visiting each family in a typical random inverse orbit.

\begin{table}[H]
\centering
\caption{Stationary Distribution ($\pi$) and Expansion Potential.}
\label{tab:stationary}
\begin{tabular}{@{}l c c c c c@{}}
\toprule
\textbf{State} & \textbf{Node} & \textbf{Router} & \textbf{Prob ($\pi$)} & \textbf{Avg $\alpha$} & \textbf{Role} \\
\midrule
\textbf{Attractor} & 0 & 0 & \textbf{0.275} & 3.0 & Maximum Density \\
\textbf{Distributor} & 2 & 0 & 0.200 & 4.0 & Routing Hub \\
\textbf{Odd Heart} & 5 & 1 & 0.150 & 2.0 & Low-Expansion Trap \\
\textbf{Recycler} & 8 & 2 & 0.150 & 3.0 & Loop Generator \\
\textbf{Twin} & 3 & 1 & 0.125 & 5.0 & High Expansion \\
\textbf{Transit} & 6 & 2 & 0.100 & 4.0 & Rare Transit \\
\bottomrule
\end{tabular}
\end{table}

The distribution reveals a significant density imbalance: nearly 50\% of all orbital steps occur in the ``Base'' families (Nodes 0 and 2). This explains why small integers (which cluster in these nodes) are so prevalent in Collatz orbits.

\section{Orbital Entropy and Mean Expansion}

A central question in the Collatz problem is whether orbits tend to grow or shrink. We quantify this using the \textbf{Lyapunov Exponent} of the inverse map.

\begin{definition}[Mean Expansion Factor]
The expected logarithmic growth rate $\lambda$ per step is determined by the average binary width removed by the forward map ($\alpha$), weighted by the stationary distribution:
\[
\bar{\alpha} \;=\; \sum_{\rho \in S} \pi_\rho \cdot \alpha(\rho).
\]
\end{definition}

Using the values from Table~\ref{tab:stationary} (assuming minimal $p=0$ costs):
\[
\bar{\alpha} \;\approx\; 0.275(3) + 0.200(4) + 0.150(2) + 0.150(3) + 0.125(5) + 0.100(4) \;=\; 3.4.
\]
The geometric expansion factor for the \emph{inverse} map ($x \leftarrow x'$) is roughly $2^{\bar{\alpha}}/3$.
\[
\Lambda_{\text{inv}} \;\approx\; \frac{2^{3.4}}{3} \;\approx\; \frac{10.55}{3} \;\approx\; 3.51.
\]

\begin{corollary}[Global Expansiveness]
Since $\Lambda_{\text{inv}} > 1$, the inverse map is strictly expansive on average. A random walk on the inverse graph grows exponentially fast.
\end{corollary}

This result provides a probabilistic explanation for the difficulty of the Collatz problem. For a number to decay to 1 (Forward Map), it must continuously find paths with $\alpha > \log_2 3 \approx 1.58$. While the average $\alpha \approx 3.4$ is well above this threshold, the variance is high. The "Descent to 1" corresponds to a deviation from the random walk, specifically targeting the high-$\alpha$ regions (Nodes 3, 6, 0) while avoiding the low-$\alpha$ traps (Nodes 5, 8).

\section{The Geometric Constraint: The Descent Chute}

The stationary distribution highlights a topological barrier to geometric contraction.
\begin{itemize}
    \item \textbf{Forward Contraction Zones:} Nodes 3 ($\alpha=5$) and 6 ($\alpha=4$) offer massive forward decay ($x \to x/10$). However, these nodes are visited only 22.5\% of the time.
    \item \textbf{Stagnation Zones:} Nodes 5 ($\alpha \approx 2$) and 8 ($\alpha=3$) offer weak decay. The loop $5 \leftrightarrow 8$ (The "Odd Heart") acts as a stagnation trap, where the orbit can linger without significantly reducing magnitude.
\end{itemize}

\begin{corollary}[The Trap Mechanism]
The structure of the Collatz graph naturally segregates orbits into ``Fast Descent'' chutes (transit through Nodes 0/3/6) and ``Laminar Flow'' traps (loops in 5/8). The global convergence to 1 relies on the ergodicity of the graph (proved in Part V) eventually forcing every orbit to exit the Stagnation Zone and enter a Descent Chute.
\end{corollary}

% =========================================================================
% END NEW PART VI
% =========================================================================


% =========================================================
% PART VIII: END MATTER
% =========================================================
\part{Conclusion and Appendices}

\section{Conclusion}
\label{sec:conclusion}

We have presented a constructive framework for the odd layer of the Collatz map, transforming the problem from one of stochastic arithmetic into a deterministic language of linear congruences. Our analysis yields four complementary insights:

\begin{enumerate}
    \item \textbf{The Unified Calculus:} We derived a single parameter table and column-lift mechanism that generates certified preimages for every topological configuration, ensuring the forward identity $3x'+1 = 2^{\alpha+6p}x$ by construction.
    \item \textbf{Algebraic Steering:} We proved that short ``padding'' sequences act as precise control knobs for the affine slope and intercept. This allows us to satisfy arbitrary divisibility constraints, guaranteeing that the modular liftings required for our reachability proof are always solvable.
    \item \textbf{The Collatz Automaton:} By modeling the system as a Finite State Automaton, we mapped the arithmetic dynamics onto a subshift of finite type. This revealed that the ``Inverse Tree'' is actually the execution of a polymorphic symbolic code, where the topology of the network determines the specific arithmetic template.
    \item \textbf{Probabilistic Constraints:} Our calculation of the stationary distribution and Lyapunov exponent ($\lambda \approx 1.77$) confirms that the inverse map is globally expansive. This rigorously frames the forward convergence to 1 not as a certainty of the local rules, but as a statistical necessity driven by the scarcity of ``Descent Chutes'' (Nodes 0, 3, 6) relative to the global expansion.
\end{enumerate}

By integrating these algebraic, topological, and probabilistic views, we have provided a robust constructive proof that every odd integer acts as the root of a certified inverse chain terminating at 1.

\appendix

%\section*{Appendix A\texorpdfstring{$^\prime$}: Mod-\pdfmath{3} steering (valuation \& residue control)}
\section*{Appendix A: Mod-\pdfmath{3} steering (valuation \& residue control)}
\label{app:mod3-steering-app}

We strengthen the steering toolkit by showing that, in addition to toggling $B_W \bmod 2$ and raising $v_2(A_W)$, one can \emph{steer $B_W$ to any desired residue modulo $3$} while remaining in the same family. This closes the divisibility-by-$3$ gap in the exact-lifting step.

\begin{lemma}[Mod-$3$ steering lemma]\label{lem:mod3-steering-app}
Let $W$ be an admissible word with affine form $x_W(m)=6(A_W m+B_W)+\delta_W$, where $A_W=3\cdot 2^{\alpha(W)}$ and $\delta_W\in\{1,5\}$. For each family $s\in\{\mathrm e,\mathrm o\}$ there exist short same–family gadgets $P^{(r)}_s$ ($r\in\{0,1,2\}$) such that
\[
x_{W\cdot P^{(r)}_s}(m)=6(A' m+B'_s)+\delta_W,\qquad
v_2(A')>v_2(A_W),\qquad B'_s\equiv r\pmod{3}.
\]
In particular, one can raise $v_2(A)$ and \emph{set} $B\bmod 3$ arbitrarily while preserving the terminal family $\delta_W$.
\end{lemma}

\begin{proof}
We use the unified $p{=}0$ rows in Table~\ref{tab:unified-F0-straight-xprime} and the parameter table (Table~\ref{tab:parameters-abc}). If a same–family row with parameters $(\alpha,k,\delta)$ is appended to a word with affine form $6(A m+B)+\delta$, the new slope is $A'=A\cdot 2^{\alpha}$ and the new intercept is
\[
B'\;\equiv\;2^{\alpha}B+k\pmod{3},
\]
because $x\mapsto 6(2^{\alpha}m+k)+\delta$ contributes $2^{\alpha}$ on the $m$–slope and adds $k$ to the intercept, and $2^{\alpha}\equiv 1$ or $2$ modulo $3$ depending on $\alpha$.


\smallskip\noindent\emph{Family $\mathrm e$ (type \textup{\texttt{ee}}, $\delta=1$).}
From Table~\ref{tab:parameters-abc}, the \texttt{ee} rows have
\[
(\alpha,k)\in\{(2,0),(4,6),(6,46)\}.
\]
Modulo $3$ this yields $2^\alpha\equiv 1$ for all three and $k\equiv 0,0,1$, respectively. Hence a single \texttt{ee} step realizes
\[
B'\equiv B \quad\text{or}\quad B'\equiv B+1 \pmod{3}.
\]
Thus in at most two \texttt{ee} steps we can set $B'\equiv r$ for any prescribed $r\in\{0,1,2\}$. Each step multiplies $A$ by $2^{\alpha}\ge 4$, so $v_2(A)$ strictly increases.

\smallskip\noindent\emph{Family $\mathrm o$ (type \textup{\texttt{oo}}, $\delta=5$).}
From Table~\ref{tab:parameters-abc}, the \texttt{oo} rows have
\[
(\alpha,k)\in\{(5,8),(3,4),(1,1)\}.
\]
Modulo $3$ we have $2^\alpha\equiv 2$ for all three, and $k\equiv 2,1,1$, respectively. Therefore any single \texttt{oo} step implements one of the affine maps
\[
\phi_1(B)=2B+1,\qquad \phi_2(B)=2B+2\qquad (\bmod 3).
\]
The subgroup of affine maps of $\mathbb{Z}/3\mathbb{Z}$ generated by $\{\phi_1,\phi_2\}$ is all of $\operatorname{AGL}_1(\mathbb{F}_3)$; concretely, from any starting $B\bmod 3$ one reaches any target residue in at most two steps (e.g.\ $\phi_1\circ\phi_1(B)=B$, $\phi_2\circ\phi_1(B)=B+1$, etc.) Each \texttt{oo} step multiplies $A$ by $2^{\alpha}\ge 2$, so $v_2(A)$ strictly increases.

\smallskip
Combining the family–wise controls gives the claim: in family $\mathrm e$ use at most two \texttt{ee} steps; in family $\mathrm o$ use at most two \texttt{oo} steps (choosing which \texttt{oo} row to realize $\phi_1$ or $\phi_2$). In all cases the terminal family (hence $\delta_W$) is preserved and $v_2(A)$ increases.
\end{proof}

\begin{table}[h]
\centering
\caption{Same–family rows: residues of $2^{\alpha}$ and $k$ modulo $3$ (at $p{=}0$).}
\label{tab:mod3-ee-oo}
\begin{tabular}{@{}c c c c c@{}}
\toprule
Row & $(s,j)$ & $\alpha$ & $2^{\alpha}\,(\bmod 3)$ & $k=(\beta+c)/9\,(\bmod 3)$\\
\midrule
$\Psi_{0}$ & $(\mathrm e,0)$ & $2$ & $1$ & $0$ \\
$\Psi_{1}$ & $(\mathrm e,1)$ & $4$ & $1$ & $0$ \\
$\Psi_{2}$ & $(\mathrm e,2)$ & $6$ & $1$ & $1$ \\
\midrule
$\Omega_{0}$ & $(\mathrm o,0)$ & $5$ & $2$ & $2$ \\
$\Omega_{1}$ & $(\mathrm o,1)$ & $3$ & $2$ & $1$ \\
$\Omega_{2}$ & $(\mathrm o,2)$ & $1$ & $2$ & $1$ \\
\bottomrule
\end{tabular}
\end{table}

\paragraph{Constructive gadgets (runtime recipes).}
Let the current terminal family of $W$ be $s$ and write $B:=B_W\bmod 3$.

\begin{itemize}[leftmargin=1.6em]
\item \textbf{If $s=\mathrm e$} (want $B'\equiv r$):
  \begin{enumerate}[itemsep=2pt]
    \item If $B\equiv r$, append $\Psi_{0}$ (does not change $B$; raises $v_2(A)$).
    \item Else append $\Psi_{2}$ once: $B\mapsto B+1$; if still not $r$, append $\Psi_{2}$ again.
  \end{enumerate}
\item \textbf{If $s=\mathrm o$} (want $B'\equiv r$):
  \begin{enumerate}[itemsep=2pt]
    \item If $B\equiv r$, append $\Omega_{1}$ (keeps flexibility for later; raises $v_2(A)$).
    \item Else compute $d:=r-B\pmod 3$.
      \begin{itemize}
        \item If $d\equiv 1$: append $\Omega_{1}$ then $\Omega_{0}$; effect $B\mapsto 2B+1\mapsto 2(2B+1)+2\equiv B+1$.
        \item If $d\equiv 2$: append $\Omega_{0}$ then $\Omega_{1}$; effect $B\mapsto 2B+2\mapsto 2(2B+2)+1\equiv B+2$.
      \end{itemize}
  \end{enumerate}
\end{itemize}

\paragraph{Corollary (exact divisibility condition).}
Let $x_W(m)=6(A_W m+B_W)+\delta_W$ with $A_W=3\cdot 2^{\alpha(W)}$. Given any target odd $x\equiv\delta_W\ (\bmod\ 6)$, by Lemma~\ref{lem:mod3-steering} we may replace $W$ by $W^\star$ so that
\[
B_{W^\star}\equiv \frac{x-\delta_{W}}{6}\pmod{3}.
\]
Then $A_{W^\star}\mid \bigl(\frac{x-\delta_W}{6}-B_{W^\star}\bigr)$ if and only if $2^{\alpha(W^\star)}\mid \bigl(\frac{x-\delta_W}{6}-B_{W^\star}\bigr)$, which can always be enforced by further same–family padding (raising $v_2(A)$). Hence there exists $m\in\mathbb Z$ with $x_{W^\star}(m)=x$.
\begin{example}[Mod-3 steering then 2-adic lifting to \(3071 \bmod 3072\)]
Target residue:
\[
r' \equiv 3071 \pmod{3072},\qquad 3071\equiv 5\pmod 6\ \text{(odd family)}.
\]

Start with the one-step word \(W=\psi\) (row \((\mathrm e,0)\) in the unified table):
\[
x_W(m)=6\bigl(A\,m+B\bigr)+\delta,\qquad \psi:\ \delta=5,\ A=16,\ B=0.
\]

\emph{(1) Mod-3 steering.}
Set
\[
t:=\frac{r'-\delta}{6}=\frac{3071-5}{6}=511.
\]
The mod-3 solvability criterion is \(B\equiv t\pmod{3}\).
Since \(t\equiv 1\pmod 3\) and \(B\equiv 0\pmod 3\) for \(\psi\), append one odd-family step \(\Omega_1\),
which acts as \(B\mapsto 2B+1\ (\bmod 3)\).
Thus \(B\equiv 1\pmod 3\) after \(\Omega_1\), and the mod-3 condition is aligned.

\emph{(2) Divide by 3 and set the \(2\)-adic congruence.}
After \(\psi\) then \(\Omega_1\), the accumulated exponent is \(\alpha_{\text{tot}}=4+3=7\).
With \(B\equiv 1\pmod 3\) (take \(B=1\) concretely),
\[
2^{\alpha_{\text{tot}}}m \equiv \frac{t-B}{3}=\frac{511-1}{3}=170 \pmod{2^{K-1}},\qquad K=10\Rightarrow 2^{K-1}=512.
\]
So \(2^{7}m \equiv 170 \pmod{512}\).

\emph{(3) Ensure \(2\)-adic solvability by padding.}
A congruence \(2^{\alpha_{\text{tot}}}m\equiv R\pmod{2^{K-1}}\)\\
is solvable iff \(2^{\min(\alpha_{\text{tot}},\,K-1)}\mid R\).
Here \(\min(7,9)=7\) but \(170\not\equiv 0\pmod{128}\).
Use same-family odd padding (\(\Omega_0,\Omega_1,\Omega_2\)) to:
\begin{itemize}
\item keep \(B\equiv 1\pmod 3\) (mod-3 steering), and
\item raise \(v_2(A)\) while shifting the integer \(B\) so that
\[
\frac{t-B}{3}\equiv 0\pmod{512}\ \Longleftrightarrow\ B\equiv t \pmod{1536}\ \Longleftrightarrow\ B\equiv 511\pmod{1536}.
\]
\end{itemize}
Once \(B\equiv 511\ (\bmod 1536)\), the right-hand side becomes \(0\pmod{512}\),
and a solution exists (e.g.\ \(m\equiv 0\pmod{512}\)).

\emph{Conclusion.}
With the sequence \(\psi\) followed by \(\Omega_1\) and a short odd-family padding that sets \(B\equiv 511\ (\bmod 1536)\) (while increasing \(v_2\) of the slope), we obtain
\[
x_W(m)\equiv 3071 \pmod{3072},
\]
and every step is certified by the identity \(3x'+1=2^{\alpha}x\) (hence \(U(x')=x\)) from the unified table.
\end{example}




\Needspace{5\baselineskip}

\section*{Appendix B: Residue-by-residue parity gadgets mod 54 (certificate)}
\label{app:mod54-certificate}

% (preamble — you already added these for the previous table)
% \usepackage{tabularx}
% \newcolumntype{Y}{>{\raggedright\arraybackslash}X}

\begin{table}[!htbp]
\centering
\caption{Certified parity–flip gadgets by odd residue class modulo \(54\).}
\label{tab:mod54-gadgets}
\setlength{\tabcolsep}{4pt}
\renewcommand{\arraystretch}{1.1}
\footnotesize
\begin{tabularx}{\linewidth}{@{}c c c Y@{}}
\toprule
Residue \(x\bmod 54\) & Family \(s\) & \(j=\lfloor x/6\rfloor\bmod 3\) & Gadget (tokens) \\
\midrule
\multicolumn{4}{@{}l@{}}{\emph{Family \(\mathrm e\) (classes \(\equiv 1\pmod 6\)):}}\\
\(1\)  & \(\mathrm e\) & \(0\) & \(\psi\); then \textbf{if} new \(j{=}1\): \(\omega_1\) then \(\omega\); \textbf{if} new \(j{=}2\): \(\Omega_2\) then \(\omega\) \\
\(7\)  & \(\mathrm e\) & \(1\) & same recipe as for \(1\) \\
\(13\) & \(\mathrm e\) & \(2\) & same recipe as for \(1\) \\
\(19\) & \(\mathrm e\) & \(0\) & same recipe as for \(1\) \\
\(25\) & \(\mathrm e\) & \(1\) & same recipe as for \(1\) \\
\(31\) & \(\mathrm e\) & \(2\) & same recipe as for \(1\) \\
\(37\) & \(\mathrm e\) & \(0\) & same recipe as for \(1\) \\
\(43\) & \(\mathrm e\) & \(1\) & same recipe as for \(1\) \\
\(49\) & \(\mathrm e\) & \(2\) & same recipe as for \(1\) \\
\addlinespace[4pt]
\multicolumn{4}{@{}l@{}}{\emph{Family \(\mathrm o\) (classes \(\equiv 5\pmod 6\)):}}\\
\(5\)  & \(\mathrm o\) & \(0\) & \(\Omega\); \textbf{if} new \(j{=}1\): \(\omega_1\) then \(\psi\); \textbf{if} new \(j{=}2\): \(\Omega_2\) then \(\omega\) then \(\psi\) \\
\(11\) & \(\mathrm o\) & \(1\) & \(\omega_1\) then \(\psi\) \\
\(17\) & \(\mathrm o\) & \(2\) & \(\Omega_2\) then \(\omega\) then \(\psi\) \\
\(23\) & \(\mathrm o\) & \(0\) & same recipe as for \(5\) \\
\(29\) & \(\mathrm o\) & \(1\) & same recipe as for \(11\) \\
\(35\) & \(\mathrm o\) & \(2\) & same recipe as for \(17\) \\
\(41\) & \(\mathrm o\) & \(0\) & same recipe as for \(5\) \\
\(47\) & \(\mathrm o\) & \(1\) & same recipe as for \(11\) \\
\(53\) & \(\mathrm o\) & \(2\) & same recipe as for \(17\) \\
\bottomrule
\end{tabularx}
\end{table}

\Needspace{5\baselineskip}
\newpage
\section*{Appendix C: Mechanical checks and lifted witnesses}\label{app:checks}

\paragraph{Audit protocol (informal).}
A simple script can (i) verify each row formula $x'=6(2^{\alpha_p}u+k^{(p)})+\delta$ at sampled inputs, (ii) check routers $j=\lfloor x/6\rfloor\bmod 3$ match the table choice, (iii) confirm $U(x')=x$ for the forward accelerated map, and (iv) validate lifted witnesses at higher moduli ($M_K$) by direct congruence checks.

\paragraph{Lifted witnesses at $M_4=48$ from $M_3=24$.}
Each row lists a residue $r\bmod 24$, a short admissible tail producing $r'\bmod 48$, and a one-line justification (pinning or solved congruence). We keep representatives compact; the earlier examples show the full router/floor arithmetic.

\begin{table}[!htbp]
\centering
\caption{Lifted witnesses from $24$ to $48$. Each tail is read from the $p{=}0$ table and obeys routing.}
\label{tab:lift-24-to-48}
\begin{tabularx}{\linewidth}{@{}c c c X@{}}
\toprule
$r\bmod 24$ & $r'\bmod 48$ & Tail & Reason \\ \midrule
$17$ & $41$ & $\omega_1\to\psi_2$ & Congruence regime for $\psi_2$: $x'=24m+17$, choose class with $m$ odd.\\
$13$ & $13$ & $\Psi_1$ & Pinning: $\alpha=4\ge K=4$ gives $x'\equiv 6k+\delta\equiv 37\equiv 13\ (\bmod 48)$. \\
$23$ & $23$ or $47$ & $\Omega_2$ or $\omega_1\to\psi_2$ & $\Omega_2$ yields $x'=12m+11$ so parity classes hit $11,23$; a cross-family two-step can target $47$ as needed. \\
$7$ & $7$ or $31$ & $\omega_1$ or $\omega_1\to\psi_2$ & As above: single-step parity split, or two-step tail for the other odd residue. \\
\bottomrule
\end{tabularx}
\end{table}


\newpage

\section*{Appendix D: Witness tables mod 48 amd 96}

% =========================
% TEMPLATE TABLE: witnesses mod 48
% =========================
\begin{table}[!htbp]
\centering
\caption{Witness construction template modulo \texorpdfstring{\(48\)}{48} (with \texorpdfstring{\(M_4=48\)}{M4=48}).
For each odd residue \texorpdfstring{\(r' \equiv 1,5 \pmod 6\)}{r' congruent 1,5 mod 6}, pick a word \(W\) whose terminal family matches \(\,r' \bmod 6\).
Write its affine form as \(\,x_W(m)=6(A_W m+B_W)+\delta_W\) (with \(\,A_W=3\cdot 2^{\alpha(W)}\)).
Solve the linear congruence \(\,A_W m \equiv \tfrac{r'-\delta_W}{6}-B_W \pmod{2^{3}}\) (i.e.\ mod \(8\)),
and set \(x := x_W(m)\), which then satisfies \(x \equiv r' \pmod{48}\) and \(U(x)=\cdots=1\) along \(W\).}

\label{tab:witnesses-mod-48-template}
\begin{tabular}{@{}c c l l@{}}
\toprule
$r' \ (\bmod 48)$ & Family & Choice of $W$ (terminal $\delta_W$) & Solve for $m$ (mod $8$) \\ \midrule
$1,7,13,19,25,31,37,43$   & $\mathrm e$ & e.g.\ $\Psi$, $\psi\omega\psi$, etc.\ ($\delta_W{=}1$) & $A_W m \equiv \tfrac{r'-1}{6}-B_W \pmod{8}$\\
$5,11,17,23,29,35,41,47$ & $\mathrm o$ & e.g.\ $\psi$, $\psi\Omega$, etc.\ ($\delta_W{=}5$) & $A_W m \equiv \tfrac{r'-5}{6}-B_W \pmod{8}$\\
\bottomrule
\end{tabular}
\end{table}

% =========================
% WORKED EXAMPLES: mod 48
% (Fixed: wraps long text using tabularx)
% =========================
\begin{table}[!htbp]
\centering
\caption{Selected concrete witnesses modulo $48$. Each row shows a word $W$, its closed form $x_W(m)$, and a solved congruence for some $r' \bmod 48$.}
\label{tab:witnesses-mod-48-examples}
\renewcommand{\arraystretch}{1.2} % Adds a little breathing room between wrapped rows
\begin{tabularx}{\linewidth}{@{}c l l Y@{}}
\toprule
$r' \ (\bmod 48)$ & Word $W$ & Closed form $x_W(m)$ & One solution for $m$ \\ \midrule
$5$  & $\psi$ & $x(m)=96m+5$ & Any $m$ (always $5\pmod{48}$). \\
$13$ & $\psi\,\omega$ & $x(m)=\;6(3\cdot 2^{5}m+B)+\delta$ & $m\equiv m_0\pmod{8}$ (Solve $A m\equiv\frac{13-\delta}{6}-B$). \\
$23$ & $\psi\,\omega\,\psi\,\Omega$ & (affine as above) & $m\equiv m_0\pmod{8}$. \\
$29$ & $\psi\,\Omega$ & $x(m)=192m+53$ & $192m+53\equiv 29 \implies 0\cdot m\equiv -24$ (No solution).\footnotemark\phantomsection\addtocounter{Hfootnote}{1} \\
$41$ & $\Omega$ (from $o$) & $x(m)=192m+53$ & Always $5\pmod{48}$; add an $o\!\to\!o$ steering gadget to shift to $41$. \\
\bottomrule
\end{tabularx}
\footnotetext{If a basic $W$ fixes the residue (slope $\equiv 0\pmod{48}$), append a short same-family \emph{steering gadget} (e.g., $o\!\to\!o$: $\Omega_2$ then $\omega$ then $\psi$) to adjust the intercept and re-solve.}
\end{table}

% =========================
% TEMPLATE TABLE: witnesses mod 96
% =========================
\begin{table}[!htbp]
\centering
\caption{Witness construction template modulo \texorpdfstring{\(96\)}{96} (with \texorpdfstring{\(M_5=96\)}{M5=96}).
For each odd residue \texorpdfstring{\(r' \equiv 1,5 \pmod 6\)}{r' congruent 1,5 mod 6}, pick a word \(W\) whose terminal family matches \texorpdfstring{\(r' \bmod 6\)}{r' mod 6}, write \(\,x_W(m)=6(A_W m+B_W)+\delta_W\,\), then solve
\(\,A_W m \equiv \tfrac{r'-\delta_W}{6}-B_W \pmod{2^{4}}\,\) (i.e.\ mod \(16\)),
and set \(x := x_W(m)\) to obtain \(x \equiv r' \pmod{96}\).}

\label{tab:witnesses-mod-96-template}
\begin{tabular}{@{}c c l l@{}}
\toprule
$r' \ (\bmod 96)$ & Family & Choice of $W$ (terminal $\delta_W$) & Solve for $m$ (mod $16$) \\ \midrule
$1,7,\ldots, 89$ (odd $\equiv 1$)  & $\mathrm e$ & e.g.\ $\Psi$, $\psi\omega\psi$, steering as needed & $A_W m \equiv \tfrac{r'-1}{6}-B_W \pmod{16}$\\
$5,11,\ldots, 95$ (odd $\equiv 5$) & $\mathrm o$ & e.g.\ $\psi$, $\psi\Omega$, steering as needed & $A_W m \equiv \tfrac{r'-5}{6}-B_W \pmod{16}$\\
\bottomrule
\end{tabular}
\end{table}


\newpage


% =========================================================

\ifidentity
\section*{Appendix E: Derivation of the identity
  \texorpdfstring{$3x'_p+1=2^{\alpha+6p}x$}{3 x prime p + 1 = 2 to the power (alpha + 6 p) x}}


\begin{lemma}[Forward identity for a lifted row]
Fix a row with parameters \((\alpha,\beta,c,\delta)\) and a column--lift \(p\ge 0\). Define
\[
F(p,m)\;=\;\frac{(9m\,2^{\alpha}+\beta)\,64^{\,p}+c}{9},
\qquad
x'_p\;=\;6F(p,m)+\delta,
\]
and write the odd input as \(x=18m+6j+\delta_{6}\) with \(j\in\{0,1,2\}\) and \(\delta_{6}\in\{1,5\}\).
Assuming the per--row design relations
\[
\beta \;=\;2^{\alpha-1}(6j+\delta_{6}),
\qquad
c \;=\;-\frac{3\delta+1}{2},
\]
one has the identity
\[
3x'_p+1 \;=\; 2^{\alpha+6p}\,x .
\]
\end{lemma}

\begin{proof}
By definition,
\[
x'_p \;=\; 6\!\left(2^{\alpha+6p}m+\frac{\beta\,64^{\,p}+c}{9}\right)+\delta
\quad\Longrightarrow\quad
3x'_p+1 \;=\; 18\cdot 2^{\alpha+6p}m \;+\; \Bigl( 18\!\cdot\!\tfrac{\beta\,64^{\,p}+c}{9}+3\delta+1 \Bigr).
\]
Simplify the bracket:
\[
18\!\cdot\!\frac{\beta\,64^{\,p}+c}{9}+3\delta+1
\;=\; 2\beta\,64^{\,p} \;+\; (2c+3\delta+1).
\]
With \(c=-(3\delta+1)/2\) the constant cancels: \(2c+3\delta+1=0\). Hence the bracket reduces to
\[
2\beta\,64^{\,p}
\;=\; 2\cdot 2^{\alpha-1}(6j+\delta_{6})\cdot 64^{\,p}
\;=\; 2^{\alpha}(6j+\delta_{6})\cdot 2^{6p}
\;=\; 2^{\alpha+6p}(6j+\delta_{6}).
\]
Therefore
\[
3x'_p+1
\;=\; 18\cdot 2^{\alpha+6p}m \;+\; 2^{\alpha+6p}(6j+\delta_{6})
\;=\; 2^{\alpha+6p}\bigl(18m+6j+\delta_{6}\bigr)
\;=\; 2^{\alpha+6p}x,
\]
as claimed.
\end{proof}

\begin{remark}[Integrality]
Since \(64\equiv 1\pmod 9\), one has \(\beta\,64^{\,p}+c\equiv \beta+c\pmod 9\).
Each row in Table~\ref{tab:parameters-abc} satisfies \(\beta+c\equiv 0\pmod 9\), so \(F(p,m)\in\mathbb Z\) for all \(p\ge 0\).
\end{remark}

\begin{example}
For row \((\mathrm{o},1)\) (\(\omega_1\)) the table gives \(\alpha=1,\ \beta=11,\ c=-2,\ \delta=1\).
Then \(F(p,m)=2^{1+6p}m+\frac{11\cdot 64^{\,p}-2}{9}\) and the lemma yields \(3x'_p+1=2^{1+6p}x\).
\end{example}
\fi

% =========================
% Appendix: Row-consistent reversibility
% Requires \usepackage{algorithm,algpseudocode}
% =========================

\newpage

\section*{Appendix F: Derivation of the Stationary Distribution}
\label{app:stationary-derivation}

We compute the stationary distribution $\pi$ for the inverse Markov chain defined in Part VI. Let $\pi_i$ denote the probability of occupying Node $i$. We assume unbiased branching ($p=0.5$) at Nodes 0 and 2.

The flow equations (incoming = outgoing) are derived from the transition table:
\begin{align}
\pi_0 &= 0.5\pi_0 + 0.5\pi_3 + 0.5\pi_8 \label{eq:pi0} \\
\pi_2 &= 0.5\pi_0 + 0.5\pi_3 \label{eq:pi2} \\
\pi_3 &= 0.5\pi_5 + 0.5\pi_6 \label{eq:pi3} \\
\pi_5 &= 0.5\pi_5 + 0.5\pi_8 \implies \pi_5 = \pi_8 \label{eq:pi5} \\
\pi_6 &= 0.5\pi_2 \label{eq:pi6} \\
\pi_8 &= 0.5\pi_2 + 0.5\pi_6 \label{eq:pi8}
\end{align}

\textbf{Step 1: Express in terms of $\pi_2$.}
From \eqref{eq:pi6}: $\pi_6 = 0.5\pi_2$.
Substitute into \eqref{eq:pi8}: $\pi_8 = 0.5\pi_2 + 0.5(0.5\pi_2) = 0.75\pi_2$.
From \eqref{eq:pi5}: $\pi_5 = \pi_8 = 0.75\pi_2$.
Substitute $\pi_5, \pi_6$ into \eqref{eq:pi3}:
\[ \pi_3 = 0.5(0.75\pi_2) + 0.5(0.5\pi_2) = 0.375\pi_2 + 0.25\pi_2 = 0.625\pi_2. \]
Substitute $\pi_3$ into \eqref{eq:pi2}:
\[ \pi_2 = 0.5\pi_0 + 0.5(0.625\pi_2) \implies \pi_2 = 0.5\pi_0 + 0.3125\pi_2. \]
Rearranging for $\pi_0$:
\[ 0.6875\pi_2 = 0.5\pi_0 \implies \pi_0 = 1.375\pi_2. \]

\textbf{Step 2: Normalization.}
Summing the coefficients relative to $\pi_2$:
\[ \Sigma = (1.375 + 1.0 + 0.625 + 0.75 + 0.5 + 0.75)\pi_2 = 5.0\pi_2. \]
Since $\Sigma = 1$, we find $\pi_2 = 1/5 = 0.2$.

\textbf{Step 3: Final Values.}
Multiplying the proportions by 0.2 yields the distribution in Table~\ref{tab:stationary}:
$\pi_0=0.275$, $\pi_2=0.200$, $\pi_3=0.125$, $\pi_5=0.150$, $\pi_6=0.100$, $\pi_8=0.150$.

\section*{Appendix G: Derivation of Active vs. Ghost Nodes}
\label{app:ghost-nodes}

We justify the partition of the modulo-9 state space into 6 active nodes and 3 ``ghost'' nodes based on the divisibility of the corresponding odd integer $x$.

\paragraph{The Mapping.}
Recall the bijection between the odd integer $x$ and the CRT tag $t$:
\[ x = 2t + 1. \]
We are interested in the condition where $x$ is divisible by 3 (and thus has no parent in the Collatz tree, as $3y+1 \not\equiv 0 \pmod 3$).

\paragraph{The Congruence.}
We solve for $t$ such that $x \equiv 0 \pmod 3$:
\begin{align*}
2t + 1 &\equiv 0 \pmod 3 \\
2t &\equiv -1 \equiv 2 \pmod 3.
\end{align*}
Dividing by 2 (which is coprime to 3), we obtain:
\[ t \equiv 1 \pmod 3. \]

\paragraph{Lifting to Modulo 9.}
The condition $t \equiv 1 \pmod 3$ lifts to exactly three residue classes modulo 9:
\[ \rho \;=\; t \bmod 9 \;\in\; \{1, 4, 7\}. \]

\paragraph{Conclusion.}
\begin{itemize}
    \item \textbf{Ghost Nodes ($\rho \in \{1, 4, 7\}$):} correspond to $x \in 3\mathbb{Z}$. Since the range of the map $U(y) = (3y+1)/2^k$ never contains multiples of 3, these nodes have no incoming edges in the inverse graph. They are topologically unreachable from the root $1$.
    \item \textbf{Active Nodes ($\rho \in \{0, 2, 3, 5, 6, 8\}$):} correspond to $x \not\equiv 0 \pmod 3$. These form the strongly connected component of the inverse map.
\end{itemize}

\section*{Appendix H: The Token-Node Correlation Map}
\label{app:token-correlation}

The structure of the Collatz Automaton is strictly deterministic. The topological state of an integer, defined by its CRT tag $\rho = t \bmod 9$, uniquely determines its Family ($s$), its Router index ($j$), and the specific subset of admissible inverse operations (Tokens) from the Unified Parameter Table.

Table~\ref{tab:token-map} provides the complete lookup for valid operations at each node.

\begin{table}[H]
\centering
\caption{Correlation between Topological Node and Admissible Tokens.}
\label{tab:token-map}
\begin{tabular}{@{}c c c c l@{}}
\toprule
\textbf{Node ($\rho$)} & \textbf{Family ($s$)} & \textbf{Router ($j$)} & \textbf{Admissible Tokens} & \textbf{Description} \\
\midrule
\textbf{0} & $\mathrm{e}$ (Even) & 0 & $\{ \Psi_0, \psi_0 \}$ & Attractor Hub (Low slope) \\
\textbf{2} & $\mathrm{o}$ (Odd) & 0 & $\{ \Omega_0, \omega_0 \}$ & Distributor Hub \\
\midrule
\textbf{3} & $\mathrm{e}$ (Even) & 1 & $\{ \Psi_1, \psi_1 \}$ & Twin of Node 0 \\
\textbf{5} & $\mathrm{o}$ (Odd) & 1 & $\{ \Omega_1, \omega_1 \}$ & The ``Odd Heart'' Trap \\
\midrule
\textbf{6} & $\mathrm{e}$ (Even) & 2 & $\{ \Psi_2, \psi_2 \}$ & Transit Node (High slope) \\
\textbf{8} & $\mathrm{o}$ (Odd) & 2 & $\{ \Omega_2, \omega_2 \}$ & Recycler Node \\
\bottomrule
\end{tabular}
\end{table}

\paragraph{Usage Rule:}
An inverse trajectory currently at residue $\rho$ may \emph{only} execute the tokens listed for that row. Attempting to apply a token from a different router index (e.g., applying $\Omega_1$ to a number at Node 0) results in a parity violation, as the resulting pre-image would not be an integer.


\section*{Appendix I: Code and Data Availability}
A reference implementation of the unified inverse table, the word evaluator, and the example generators is archived at
\href{https://doi.org/10.5281/zenodo.17352096}{Zenodo DOI: 10.5281/zenodo.17352096} and mirrored at
\href{git@github.com:kisira/collatz.git}{github.com/kisira/collatz}.
%The repository includes scripts to verify per-step identities \(U(x')=x\), regenerate the witness tables (mod \(24,48,96\)), and reproduce the figures and traces in this paper.
%Reproducibility instructions are summarized in Appendix~\ref{app:repro}.


\section*{Appendix J: Reproducibility Details}\label{app:repro}

\paragraph{Environment.}
The code is pure Python~3 (standard library + \texttt{pandas} for CSV I/O). A minimal setup is:
\begin{verbatim}
python -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt

python3 tools/check_rows.py             # verifies all rows and their p-lifts
python3 tools/evaluate_word.py --word psi,Omega,omega,psi --x0 1 --csv out.csv
\end{verbatim}

This writes a per-step trace (indices \(s,j,m\), formulas, and forward checks).

\paragraph{Regenerating witness tables.}
To regenerate witnesses mod \(24\), \(48\), and \(96\) (as used in the paper):
\begin{verbatim}
python3 tools/make_witnesses.py --mod 24  --out tables/witnesses_mod24.csv
python3 tools/make_witnesses.py --mod 48  --out tables/witnesses_mod48.csv
python3 tools/make_witnesses.py --mod 96  --out tables/witnesses_mod96.csv
\end{verbatim}

\paragraph{Recreating examples in the paper.}
Each example in Sections~\ref{lem:affine-word}–\ref{thm:reachability} can be reproduced with:
\begin{verbatim}
python3 tools/replay_example.py --name ex2
\end{verbatim}
which emits a CSV trace with the certified step identities and indices.

\paragraph{Generate the word for an odd number.}
To genereate a word for say 497. Or any other odd number.
\begin{verbatim}
python3 tools/calculate_word.py 497 --json-out 497_word.json
\end{verbatim}

\paragraph{Row consistent reverse.}
To reverse an odd number any number of steps.
\begin{verbatim}
python reverse_construct.py --mode one --y 43 --csv reverse_43.csv
python reverse_construct.py --mode chain --y 497 --stop 1 --csv chain_497_to_1.csv
\end{verbatim}



\paragraph{Archival guarantee.}
A reference implementation of the unified inverse table, the word evaluator, and the example generators as well as all the Rocq/Coq 9.1.0 formlization files is archived at
\href{https://doi.org/  DOI: 10.5281/zenodo.18382164//zenodo.18382164}{Zenodo  DOI: 10.5281/zenodo.18382164//zenodo.18382164} and mirrored at
\href{git@github.com:kisira/collatz.git}{github.com/kisira/collatz}.

\section*{Appendix K: Formalization Index}
The logical core of this paper has been mechanically verified in the Coq Proof Assistant. The formalization covers the algebraic foundations, the dynamical properties (drift, expansion), and the algorithmic construction (steering, lifting).

% Note: Remove \begin{table}[H] wrapper. xltabular handles placement itself.

\begingroup
\renewcommand{\arraystretch}{1.2}
\small
\begin{xltabular}{\linewidth}{@{}l X l@{}}
\caption{Mapping of main theoretical results to formal proofs.} \label{tab:coq-index} \\

% --- HEADER FOR FIRST PAGE ---
\toprule
\textbf{Concept} & \textbf{Description} & \textbf{Coq File \& Theorem} \\
\midrule
\endfirsthead

% --- HEADER FOR SUBSEQUENT PAGES (if it breaks) ---
\toprule
\textbf{Concept} & \textbf{Description} & \textbf{Coq File \& Theorem} \\
\midrule
\endhead

% --- FOOTER ---
\bottomrule
\endfoot

% --- TABLE CONTENT ---
\multicolumn{3}{@{}l}{\textit{Part I: Algebraic Foundations}} \\
\midrule
\textbf{CRT Indices} &
  Verifies the bijection between the CRT tag $t$ and tuple $(s,j,m)$. &
  \texttt{notation\_indices...v} \newline
  \texttt{cor\_tag\_indices\_plain} \\
\addlinespace[4pt]

\textbf{Drift Equation} &
  Rigorously proves $\Delta V = rK + \Delta_\varepsilon$. &
  \texttt{Drift.v} \newline
  \texttt{diff\_equation\_correct} \\
\addlinespace[4pt]

\textbf{Row Correctness} &
  Proves $3x'+1 = 2^{\alpha+6p}x$ and forward monotonicity. &
  \texttt{row\_correctness...v} \newline
  \texttt{lem\_row\_correctness} \\
\addlinespace[4pt]

\textbf{Algebraic Completeness} &
  Proves every valid odd step corresponds to a unique row/lift. &
  \texttt{algebraic\_completeness...v} \newline
  \texttt{rows\_and\_lifts\_...} \\
\addlinespace[4pt]

\textbf{Row Invariance} &
  Proves different realizations of the same step yield equal outputs. &
  \texttt{row\_level\_invariance...v} \newline
  \texttt{uniqueness\_across...} \\
\addlinespace[4pt]

\textbf{Forward Identity} &
  Verifies $3x'+1=2^{\alpha+6p}x$ for lifted rows (Algebraic derivation). &
  \texttt{row\_design\_...v} \newline
  \texttt{forward\_identity\_via\_rows} \\
\addlinespace[4pt]

\textbf{Super-Families} &
  Formalizes splitting exponents into $a = e \bmod 6$ and $p$. &
  \texttt{super\_families.v} \newline
  \texttt{super\_family\_completeness} \\
\addlinespace[4pt]

\textbf{Identity Derivation} &
  Rigorous Z-arithmetic proof of the forward identity. &
  \texttt{appendix\_e\_...v} \newline
  \texttt{Forward\_identity\_...} \\

\midrule
\multicolumn{3}{@{}l}{\textit{Part II: Dynamical Mechanics}} \\
\midrule
\textbf{Index Evolution} &
  Proves inverse words act as linear maps $m \to Am+B$. &
  \texttt{evolution\_of\_the\_index...v} \newline
  \texttt{m\_after\_inverse\_word} \\
\addlinespace[4pt]

\textbf{Drift \& Geometry} &
  Defines operators $(A,B)$ and proves slope $A>1$ (Expansion). &
  \texttt{DriftAndGeometry.v} \newline
  \texttt{gain\_expansive\_...} \\
\addlinespace[4pt]

\textbf{Dynamical Link} &
  Proves that $x_W(m)=x \implies U^{|W|}(x)=1$ (Semantic Link). &
  \texttt{DynamicalImplication.v} \newline
  \texttt{thm\_dynamical\_implication} \\
\addlinespace[4pt]

\textbf{Geometric Series} &
  Verifies translation between internal index $m$ and global $x$. &
  \texttt{geometric\_series...v} \newline
  \texttt{cor\_xn\_from\_mn} \\

\midrule
\multicolumn{3}{@{}l}{\textit{Part III: Algorithmic Core (Lifting \& Steering)}} \\
\midrule
\textbf{Last-Row Congruence} &
  Proves solvability condition $\gcd(a, M) \mid r$. &
  \texttt{residue\_targeting...v} \newline
  \texttt{lem\_last\_row\_p} \\
\addlinespace[4pt]

\textbf{Linear Lifting} &
  Proves divisibility implies exact integer existence. &
  \texttt{linear\_2\_adic...v} \newline
  \texttt{lem\_linear\_hensel} \\
\addlinespace[4pt]

\textbf{Monotone Lifting} &
  Proves padding strictly increases $v_2(A)$ to any target $K$. &
  \texttt{samefamily\_padding.v} \newline
  \texttt{pad\_reaches\_any\_target} \\
\addlinespace[4pt]

\textbf{Finite Menu} &
  Proves a finite menu of gadgets suffices for padding. &
  \texttt{same\_family\_steering...v} \newline
  \texttt{lem\_monotone\_padding} \\
\addlinespace[4pt]

\textbf{Mod-3 Steering} &
  Proves existence of token valid mod 3 for any odd $x$ (Liveness). &
  \texttt{mod\_3\_steering...v} \newline
  \texttt{lem\_mod3\_steer} \\
\addlinespace[4pt]

\textbf{Explicit Gadgets} &
  Constructs gadgets to reach any target $B \bmod 3$. &
  \texttt{appendix\_a\_...v} \newline
  \texttt{lem\_mod3\_steering} \\

\midrule
\multicolumn{3}{@{}l}{\textit{Part IV: Routing \& Stability}} \\
\midrule
\textbf{Floor Composition} &
  Algebraic update rule for $(A,B)$ with floor (Noise Linearity). &
  \texttt{same\_family\_...columns.v} \newline
  \texttt{lem\_one\_step\_floor} \\
\addlinespace[4pt]

\textbf{Routing Compatibility} &
  Proves fixing $m \bmod 2^S$ freezes the router path. &
  \texttt{routing\_compatibility...v} \newline
  \texttt{lem\_TD2\_routing} \\

\midrule
\multicolumn{3}{@{}l}{\textit{Part V: High-Level Assembly}} \\
\midrule
\textbf{Base Witnesses} &
  Exhaustively verifies witnesses for residues mod 24. &
  \texttt{steering\_gadget...v} \newline
  \texttt{thm\_base\_coverage\_24} \\
\addlinespace[4pt]

\textbf{Reverse Search} &
  Proves reverse search is algorithmically complete. &
  \texttt{rowconsistent\_...v} \newline
  \texttt{cor\_alg\_complete\_reverse} \\
\addlinespace[4pt]

\textbf{Main Assembly} &
  The ``Roof'': Composes algorithms to prove witness existence. &
  \texttt{assembly\_into\_...mocked.v} \newline
  \texttt{thm\_odd\_layer\_global\_0} \\
\addlinespace[4pt]

\textbf{Final Synthesis} &
  Witness existence $\implies$ Collatz Truth. &
  \texttt{Sec35\_synthesis...v} \newline
  \texttt{thm\_odd\_layer\_convergence} \\

\end{xltabular}
\endgroup

\begin{thebibliography}{99}

\bibitem{BernsteinLagarias1996}
D.~J. Bernstein and J.~C. Lagarias.
\newblock The $3x+1$ conjugacy map.
\newblock \emph{Canadian Journal of Mathematics}, 48(6):1154--1169, 1996.

\bibitem{Garner1981}
L.~E. Garner.
\newblock On the Collatz $3n + 1$ Algorithm.
\newblock \emph{Proceedings of the American Mathematical Society}, 82(1):19--22, 1981.

\bibitem{Gouvea1997}
F.~Q. Gouvêa.
\newblock \emph{p-adic Numbers: An Introduction}.
\newblock Springer-Verlag, 1997.

\bibitem{Lagarias2010survey}
J.~C. Lagarias.
\newblock The $3x+1$ problem: An overview.
\newblock In \emph{The Ultimate Challenge: The $3x+1$ Problem}, pages 3--29. Amer. Math. Soc., 2010.

\bibitem{MonksYazinski2004}
K.~Monks and J.~Yazinski.
\newblock The Autoconjugacy of the $3x+1$ Function.
\newblock \emph{Discrete Mathematics}, 275:219--236, 2004.

\bibitem{Nathanson1996}
M.~B. Nathanson.
\newblock \emph{Additive Number Theory: The Classical Bases}.
\newblock Springer, 1996.

\bibitem{Terras1976}
R.~Terras.
\newblock A stopping time problem on the positive integers.
\newblock \emph{Acta Arithmetica}, 30(3):241--252, 1976.

\bibitem{Terras1979}
R.~Terras.
\newblock On the existence of a density.
\newblock \emph{Acta Arithmetica}, 35:101--102, 1979.

\bibitem{Wirsching1998LNM}
G.~J. Wirsching.
\newblock \emph{The Dynamical System Generated by the $3n+1$ Function}.
\newblock Lecture Notes in Mathematics 1681, Springer, 1998.

\end{thebibliography}
\end{document}
